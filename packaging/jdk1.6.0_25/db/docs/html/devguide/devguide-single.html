<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><META http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Java DB Developer's Guide</title><META content="text/css" http-equiv="Content-Style-Type"><style type="text/css">
        a { color: black; border: none; text-decoration: none; }
        img { border: none; }
      </style></head><body topmargin="6" leftmargin="6" marginheight="6" marginwidth="6" bgcolor="white"><br><div valign="top"><div style="padding: 6pt; border-width: thin; border-color: black; font-family: Helvetica; margin-top: 2pc;"><div style="text-align: right; margin-bottom: 12pc; margin-top: 12pc; line-height: 100%; font-size: 12pt;"></div></div><a name="cover"></a><div style="font-family: Helvetica; text-align: left;"><div style="line-height: 140%; font-weight: bold; font-size: 22pt;">Java DB Developer's Guide</div><div style="font-style: italic; margin-bottom: 1in; line-height: 140%; font-size: 8pt;">
          Version 10.6</div></div><div style="line-height: normal; font-size: 8pt; text-align: right; margin-top: 3pc;">
          Derby Document build: <div>September 27, 2010, 11:44:42 AM (EDT)</div></div></div><br><br><div valign="top"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; text-align: center; color: purple;"></div></div><br><br><div valign="top"><div style="font-style: italic; margin-bottom: 1in; line-height: 140%; font-size: 8pt;">
          Version 10.6
         &nbsp;
	Java DB Developer's Guide</div></div><div valign="top"><a name="page1-1"></a><div style="font-family: Helvetica; font-size: 10pt; line-height: 12pt;"><div style="font-family: Helvetica; text-align: left;"><div> &nbsp;&nbsp;&nbsp; </div><a name="contents"></a><div style="line-height: 140%; font-weight: bold; font-size: 20pt;">
              Contents </div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#rdevcopyright"><span style="font-weight: bold;">Copyright</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#rdevlicense"><span style="font-weight: bold;">License</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevjavadb"><span style="font-weight: bold;">Relationship between Java DB and 
Derby</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevdgpref29520"><span style="font-weight: bold;">About this guide</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdgpref11181"><span style="font-weight: bold;">Purpose of this guide</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdgpref24290"><span style="font-weight: bold;">Audience</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdgpref23947"><span style="font-weight: bold;">How this guide is organized</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevstart19524"><span style="font-weight: bold;">After installing</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevstart16043"><span style="font-weight: bold;">The installation directory</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevstart813142">Batch files and shell scripts &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevstart18978"><span style="font-weight: bold;">Derby and JVMs</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevstart98282"><span style="font-weight: bold;">Derby libraries and classpath</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevstart41260"><span style="font-weight: bold;">UNIX-specific issues</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevstart39409">Configuring file descriptors &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevstart813545">Scripts &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevupgrades"><span style="font-weight: bold;">Upgrades</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#tdevpreupgrade"><span style="font-weight: bold;">Preparing to upgrade</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#tdevupgradedb"><span style="font-weight: bold;">Upgrading a database</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#tdevupgradesoft"><span style="font-weight: bold;">Soft upgrade limitations</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevdvlp19524"><span style="font-weight: bold;">JDBC applications and Derby basics</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdvlp14839"><span style="font-weight: bold;">Application development overview</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdvlp39409"><span style="font-weight: bold;">Derby embedded basics</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp40653">Derby JDBC driver &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp17453">Derby JDBC database connection URL &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp27610">Derby system &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp21955">A Derby database &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp34964">Connecting to databases &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdvlp51654">Working with the database connection URL attributes &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdvlpinmemdb"><span style="font-weight: bold;">Using in-memory databases</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevsetprop34818"><span style="font-weight: bold;">Working with Derby properties</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevsetprop11108">Properties overview &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevsetprop24222">Setting Derby properties &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevsetprop32443">Properties case study &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevdeploy32171"><span style="font-weight: bold;">Deploying Derby applications</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdeploy38918"><span style="font-weight: bold;">Deployment issues</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy855368">Embedded deployment application overview &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy855655">Deploying Derby in an embedded environment &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdeploy15325"><span style="font-weight: bold;">Creating Derby databases for read-only use</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevdeploy26887">Creating and preparing the database for read-only use &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevdeploy19136">Deploying the database on the read-only media &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevdeploy33704">Transferring read-only databases to archive (jar or zip) files &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevdeploy39856">Accessing databases within a jar file using the classpath &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy82529">Databases on read-only media and DatabaseMetaData &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdeploy30736"><span style="font-weight: bold;">Loading classes from a database</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy856753">Class loading overview &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevdeploy17604">Dynamic changes to jar files or to the database jar classpath &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevspecial"><span style="font-weight: bold;">Derby server-side programming</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevspecial42117"><span style="font-weight: bold;">Programming database-side JDBC routines</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial29620">Database-side JDBC routines and nested connections &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial16181">Database-side JDBC routines using non-nested connections &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial41728">Database-side JDBC routines and SQLExceptions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial45786">User-defined SQLExceptions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevspecial27163"><span style="font-weight: bold;">Programming trigger actions</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial53165">Trigger action overview &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial76763">Performing referential actions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial67260">Accessing before and after rows &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial13670">Examples of trigger actions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecial49460">Triggers and exceptions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevspecialtabfuncs"><span style="font-weight: bold;">Programming
Derby-style table
functions</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecialtfbasic">Overview of
Derby-style table
functions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecialtfexample">Example Derby-style
table function &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecialtfrestr">Writing restricted table functions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevspecialtfoptimizer">Optimizer support for
Derby-style table
functions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevspecialudt"><span style="font-weight: bold;">Programming user-defined types</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevconcepts19524"><span style="font-weight: bold;">Controlling Derby application behavior</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts38375"><span style="font-weight: bold;">The JDBC connection and transaction model</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts36881">Connections &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts19173">Transactions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts41275"><span style="font-weight: bold;">Result set and cursor mechanisms</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevconcepts88082">Simple non-updatable result sets &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts28351">Updatable result sets &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts23987">Result sets and auto-commit &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts22641">Scrollable result sets &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevconceptsholdablecursors">Holdable result sets &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts30291"><span style="font-weight: bold;">Locking, concurrency, and isolation</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts15366">Isolation levels and concurrency &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts22300">Configuring isolation levels &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts23810">Lock granularity &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts36402">Types and scope of locks in Derby systems &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts28436">Deadlocks &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts34828"><span style="font-weight: bold;">Working with multiple connections to a single database</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevconcepts713">Deployment options and threading and connection modes &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts10914">Multi-user database access &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts24019">Multiple connections from a single application &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts23499"><span style="font-weight: bold;">Working with multiple threads sharing a single connection</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts89498">Pitfalls of sharing a connection among threads &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts65864">Multi-thread programming tips &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevconcepts600">Example of threads sharing a statement &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevdvlp22619"><span style="font-weight: bold;">Working with database threads in an embedded environment</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevconcepts24927"><span style="font-weight: bold;">Working with Derby SQLExceptions in an application</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevconcepts844813">Information provided in SQL Exceptions &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevresman19524"><span style="font-weight: bold;">Using Derby as a J2EE resource manager</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#rdevresman79556"><span style="font-weight: bold;">Classes that pertain to resource managers</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevresman89722"><span style="font-weight: bold;">Getting a DataSource</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevresman92946"><span style="font-weight: bold;">Shutting down or creating a database</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevcsecuree"><span style="font-weight: bold;">Derby and Security</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure12392"><span style="font-weight: bold;">Configuring security for your environment</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevcsecure82556">Configuring security in a client/server environment &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#tdevcsecure81850">Configuring security in an embedded environment &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure42374"><span style="font-weight: bold;">Working with user authentication</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure36127">Enabling user authentication &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure37817">Defining users &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure38522">External directory service &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure21547">Built-in Derby users &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevcsecure557">List of user authentication properties &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure79358">Programming applications for Derby user authentication &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure37241"><span style="font-weight: bold;">Users and authorization identifiers</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure24458">Authorization identifiers, user authentication, and user authorization &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecureDbOwner">Database owner
 &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure865580">User names and schemas &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevcsecure622">Exceptions when using authorization identifiers &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure36595"><span style="font-weight: bold;">User authorizations</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure865818">Setting the default connection access mode &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure865880">Setting access for individual users &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure866060">Setting the SQL standard authorization mode &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure24366"><span style="font-weight: bold;">Encrypting databases on disk</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure96815">Requirements for Derby encryption &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure97760">Working with encryption &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure90988"><span style="font-weight: bold;">Signed jar files</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure10983"><span style="font-weight: bold;">Notes on the Derby security features</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcsecure51876"><span style="font-weight: bold;">User authentication and authorization examples</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevcsecure125">User authentication example in a client/server environment &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevcsecure13713">User authentication example in a single-user, embedded environment &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevcsecuresqlauthexs">User authentication examples using SQL authorization &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcbabejdfj"><span style="font-weight: bold;">Running Derby under a security manager</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevbabejgjd">Granting permissions to Derby &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevcsecure871387">Examples of Java 2 security policy files for embedded Derby &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevadvjdbc35053"><span style="font-weight: bold;">Developing tools and using Derby with an IDE</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevadvjdbc41138"><span style="font-weight: bold;">Offering connection choices to the user</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#rdevadvjdbc034">The DriverPropertyInfo Array &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevadvjdbc32436"><span style="font-weight: bold;">Using Derby with IDEs</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevadvjdbc18939">IDEs and multiple JVMs &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevtricks32436"><span style="font-weight: bold;">SQL tips</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevtricks19707"><span style="font-weight: bold;">Retrieving the database connection URL</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevtricks39584"><span style="font-weight: bold;">Supplying a parameter only once</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevtricks21248"><span style="font-weight: bold;">Defining an identity column</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevtricks23426"><span style="font-weight: bold;">Using third-party tools</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevtricks13019"><span style="font-weight: bold;">Tricks of the VALUES clause</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevtricks807337">Multiple rows &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevtricks807365">Mapping column values to return values &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 9pc;"><a href="#cdevtricks807400">Creating empty queries &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevin10613"><span style="font-weight: bold;">Localizing Derby</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevin71274"><span style="font-weight: bold;">SQL parser support for Unicode</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevcollation"><span style="font-weight: bold;">Character-based collation in Derby</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevin55108"><span style="font-weight: bold;">Other components with locale support</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevin38113"><span style="font-weight: bold;">Messages libraries</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#cdevstandards806118"><span style="font-weight: bold;">Derby and standards</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 7.5pc;"><a href="#cdevstandardsxml"><span style="font-weight: bold;">XML data types and operators</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div><div style="margin-left: 4.9pc; margin-top: 6pt;"><a href="#rdevtrademderby"><span style="font-weight: bold;">Trademarks</span> &nbsp;&nbsp;&nbsp; <span>&bull;</span></a></div></div></div></div><div valign="top"><div style="font-family: Helvetica; font-weight: bold; font-size: 10pt; text-align: center;"><span>&bull;</span></div></div><br><br><div valign="top"><div style="line-height: 8pt; font-size: 8pt;">Java DB Developer's Guide</div></div><div valign="top"><div style="font-family: Helvetica; font-size: 10pt; text-align: left;">Apache Software FoundationJava DB Developer's GuideApache Derby<div><a name="N1003D"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="rdevcopyright"></a><div></div>Copyright</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N10046"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><img src="../images/logowithtext.jpg" alt="Logo for Apache Derby"></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Copyright 2004-2010 The Apache Software Foundation</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Copyright 2010 Oracle and/or its affiliates. All rights reserved.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> Licensed
under the Apache License, Version 2.0 (the "License"); you may not use this
file except in compliance with the License. You may obtain a copy of the License
at <span style="color: blue;"><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N10071"></a><span></span><div style="font-weight: bold;">Related information</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="color: blue;"><a href="#rdevlicense">License</a></span></div></div></div></div><div><a name="N10099"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="rdevlicense"></a><div></div>License</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N100BC"></a><span></span><div style="font-weight: bold;">The Apache License, Version 2.0</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
                               Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      "License" shall mean the terms and conditions for use,
      reproduction, and distribution as defined by Sections 1 through
      9 of this document.

      "Licensor" shall mean the copyright owner or entity authorized
      by the copyright owner that is granting the License.

      "Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under
      common control with that entity. For the purposes of this
      definition, "control" means (i) the power, direct or indirect,
      to cause the direction or management of such entity, whether by
      contract or otherwise, or (ii) ownership of fifty percent (50%)
      or more of the outstanding shares, or (iii) beneficial ownership
      of such entity.

      "You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      "Source" form shall mean the preferred form for making
      modifications, including but not limited to software source code,
      documentation source, and configuration files.

      "Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      "Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      "Derivative Works" shall mean any work, whether in Source or
      Object form, that is based on (or derived from) the Work and
      for which the editorial revisions, annotations, elaborations,
      or other modifications represent, as a whole, an original work
      of authorship.  For the purposes of this License, Derivative
      Works shall not include works that remain separable from, or
      merely link (or bind by name) to the interfaces of, the Work
      and Derivative Works thereof.

      "Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or
      additions to that Work or Derivative Works thereof, that is
      intentionally submitted to Licensor for inclusion in the Work
      by the copyright owner or by an individual or Legal Entity
      authorized to submit on behalf of the copyright owner. For the
      purposes of this definition,
      "submitted" means any form of electronic, verbal, or written
      communication sent to the Licensor or its representatives,
      including but not limited to communication on electronic mailing
      lists, source code control systems, and issue tracking systems
      that are managed by, or on behalf of, the Licensor for the
      purpose of discussing and improving the Work, but excluding
      communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a
      Contribution."

      "Contributor" shall mean Licensor and any individual or Legal
      Entity on behalf of whom a Contribution has been received by
      Licensor and subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions
      of this License, each Contributor hereby grants to You a
      perpetual, worldwide, non-exclusive, no-charge, royalty-free,
      irrevocable copyright license to reproduce, prepare Derivative
      Works of, publicly display, publicly perform, sublicense, and
      distribute the Work and such Derivative Works in Source or
      Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have
      made, use, offer to sell, sell, import, and otherwise transfer
      the Work, where such license applies only to those patent claims
      licensable by such Contributor that are necessarily infringed by
      their Contribution(s) alone or by combination of their
      Contribution(s) with the Work to which such Contribution(s) was
      submitted. If You institute patent litigation against any entity
      (including a cross-claim or counterclaim in a lawsuit) alleging
      that the Work or a Contribution incorporated within the Work
      constitutes direct or contributory patent infringement, then any
      patent licenses granted to You under this License for that Work
      shall terminate as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

      (d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute
          must include a readable copy of the attribution notices
          contained within such NOTICE file, excluding those notices
          that do not pertain to any part of the Derivative Works, in
          at least one of the following places: within a NOTICE text
          file distributed as part of the Derivative Works; within the
          Source form or documentation, if provided along with the
          Derivative Works; or, within a display generated by the
          Derivative Works, if and wherever such third-party notices
          normally appear. The contents of the NOTICE file are for
          informational purposes only and do not modify the License.
          You may add Your own attribution notices within Derivative
          Works that You distribute, alongside or as an addendum to
          the NOTICE text from the Work, provided that such additional
          attribution notices cannot be construed as modifying the
          License.

      You may add Your own copyright statement to Your modifications
      and may provide additional or different license terms and
      conditions for use, reproduction, or distribution of Your
      modifications, or for any such Derivative Works as a whole,
      provided Your use, reproduction, and distribution of the Work
      otherwise complies with the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state
      otherwise, any Contribution intentionally submitted for
      inclusion in the Work by You to the Licensor shall be under the
      terms and conditions of this License, without any additional
      terms or conditions.  Notwithstanding the above, nothing herein
      shall supersede or modify the terms of any separate license
      agreement you may have executed with Licensor regarding such
      Contributions.

   6. Trademarks. This License does not grant permission to use the
      trade names, trademarks, service marks, or product names of the
      Licensor, except as required for reasonable and customary use
      in describing the origin of the Work and reproducing the content
      of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or
      conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or
      FITNESS FOR A PARTICULAR PURPOSE. You are solely responsible for
      determining the appropriateness of using or redistributing the
      Work and assume any risks associated with Your exercise of
      permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and
      grossly negligent acts) or agreed to in writing, shall any
      Contributor be liable to You for damages, including any direct,
      indirect, special, incidental, or consequential damages of any
      character arising as a result of this License or out of the use
      or inability to use the Work (including but not limited to
      damages for loss of goodwill, work stoppage, computer failure or
      malfunction, or any and all other commercial damages or losses),
      even if such Contributor has been advised of the possibility of
      such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by
      reason of your accepting any such warranty or additional
      liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   Copyright [yyyy] [name of copyright owner]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
   implied.  See the License for the specific language governing
   permissions and limitations under the License.
</div></pre></div></div></div><div><a name="N100D5"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevjavadb"></a><div></div>Relationship between Java DB and 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span></div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Java DB is a relational database management 
system that is based on the Java programming language and SQL. Java DB is a 
commercial release of the Apache Software Foundation's (ASF) open source 
relational database project. The Apache project is called 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The Java DB product includes 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> without any 
modification whatsoever to the underlying source code.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Java DB technical support is available for purchase through the Java For
Business product at Oracle.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Because Java DB and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 
have the same functionality, the Java DB documentation refers to the core 
functionality as <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Java DB <span style="border-right-width: 0pt; border-left-width: 0pt;">Version 10.6</span> is based 
on the <span style="border-right-width: 0pt; border-left-width: 0pt;">Version 10.6</span> release of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. References to
"<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>" in the 
Java DB documentation refer to the 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Version 10.6</span> release of  
<span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span>.</div></div></div><div><a name="N10162"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevdgpref29520"></a><div></div>About this guide</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For general information about the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> documentation,
such as a complete list of books, conventions, and further reading, see <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span></span>.</div></div><div><a name="N101C3"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdgpref11181"></a><div></div>Purpose of this guide</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This guide explains how to use the core <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> technology
and is for developers building <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It describes basic <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> concepts,
such as how you create and access <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
through JDBC routines and how you can deploy <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.</div></div></div><div><a name="N10216"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdgpref24290"></a><div></div>Audience</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This guide is intended for software developers who already know
some SQL and Java.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> users who are
not familiar with the SQL standard or the Java programming language will benefit
from consulting books on those subjects.</div></div></div><div><a name="N10250"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdgpref23947"></a><div></div>How this guide is organized</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This document includes the following sections.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevstart19524">After installing</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Explains
the installation layout.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevupgrades">Upgrades</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Explains
how to upgrade a database created with a previous version of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevdvlp19524">JDBC applications and Derby basics</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Basic
details for using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
including loading the JDBC driver, specifying a database URL, starting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, and working with
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevdeploy32171">Deploying Derby applications</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An
overview of different deployment scenarios, and tips for getting the details
right when deploying applications.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevspecial">Derby server-side programming</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Describes
how to program database-side JDBC routines, triggers, and table functions.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevconcepts19524">Controlling Derby application behavior</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC, cursors, locking and isolation levels, and multiple connections.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevresman19524">Using Derby as a J2EE resource manager</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Information
for programmers developing back-end components in a J2EE system.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevcsecuree">Derby and Security</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Describes
how to use the security features of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevadvjdbc35053">Developing tools and using Derby with an IDE</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Tips
for tool designers.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevtricks32436">SQL tips</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Insiders'
tricks of the trade for using SQL.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevin10613">Localizing Derby</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An overview
of database localization.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="color: blue;"><a href="#cdevstandards806118">Derby and standards</a></span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Describes those parts of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that are non-standard
or not typical for a database system.</div></div></td></tr></table></div></div></div></div><div><a name="N10398"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevstart19524"></a><div></div>After installing</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section provides reference information about the installation
directory, JVMs, classpath, upgrades, and platform-specific issues.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Review the <span style="font-family: Courier;">index.html</span> file at the top level of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> distribution
for pointers to reference and tutorial information about
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
See the Release Notes for information on platform support, changes that may
affect your existing applications, defect information, and recent documentation
updates. See <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span></span> for
basic product descriptions, information on getting started, and directions
for setting the path and the classpath. </div></div><div><a name="N10417"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevstart16043"></a><div></div>The installation directory</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You may install the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software
in a directory of your choice.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="font-family: Courier;">index.html</span> file for pointers to information on <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The distribution includes setup scripts that use an environment
variable called <span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_HOME</span>.
The variable's value is set to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> base
directory.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">C:&gt;echo %<span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_HOME</span>%
C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">DERBY_HOME</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you want to set your own environment, <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span></span> instructs
you on setting its value to the directory in which you installed the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The distribution for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> contains
all the files you need, including the documentation set, some example applications,
and a sample database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Details about the installation:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">index.html </span>in the top-level directory is the top page for the on-line
documentation.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">RELEASE-NOTES.html</span>, in the top-level <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> base
directory, contains important last-minute information. <span style="font-style: italic;">Read it first</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/bin</span> contains utilities and scripts for running <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/demo</span> contains some sample applications, useful scripts, and prebuilt
databases.   <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/databases</span> includes prebuilt sample databases.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/programs</span> includes sample applications.</div></td></tr></table></div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/docs</span> contains the on-line documentation (including this document).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/javadoc</span> contains the documented APIs for the public classes and
interfaces. Typically, you use the JDBC interface to interact with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>;
however, you can use some of these additional classes in certain situations.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">/lib</span> contains the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries.</div></td></tr></table></div></div><div><a name="N1057D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevstart813142"></a><div></div>Batch files and shell scripts</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The <span style="font-style: italic;">/bin</span> directory contains scripts
for running some of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools
and utilities. To customize your environment, put the directory first in your
path.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These scripts serve as examples to help you get started with these tools
and utilities on any platform. However, they may require modification in order
to run properly on certain platforms.</div></div></div></div><div><a name="N105CF"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevstart18978"></a><div></div>Derby and JVMs</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is a database
engine written completely in Java; it will run in any JVM, version 1.4 or
higher.</div></div></div><div><a name="N10626"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevstart98282"></a><div></div>Derby libraries and classpath</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries
are located in the /<span style="font-style: italic;">lib</span> subdirectory of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> base
directory. You must set the classpath on your development machine to include
the appropriate libraries.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span></span><span style="font-style: italic;"></span> explains
how to set the classpath in a development environment.</div></div></div><div><a name="N106AB"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevstart41260"></a><div></div>UNIX-specific issues</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues
specifically related to UNIX platforms.</div></div><div><a name="N10720"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevstart39409"></a><div></div>Configuring file descriptors</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
create one file per table or index. Some operating systems limit the number
of files an application can open at one time.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the default is a low number, such as 64, you might run into unexpected <span style="font-style: italic;">IOExceptions</span> (wrapped
in <span style="font-family: Courier;"><span style="font-style: italic;">SQLExceptions</span></span>). If your operating system lets you
configure the number of file descriptors, set this number to a higher value.</div></div></div><div><a name="N10796"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevstart813545"></a><div></div>Scripts</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Your installation contains executable script files that simplify
invoking the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools.
On UNIX systems, these files might need to have their default protections
set to include execute privilege.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A typical way to do this is with the command <span style="font-style: italic;">chmod +x *.ksh</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Consult the documentation for your operating system for system-specific
details.</div></div></div></div></div><div><a name="N107EC"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevupgrades"></a><div></div>Upgrades</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To connect to a database created with a previous version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, you must first upgrade
that database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Upgrading involves writing changes to the system tables, so it is not possible
for databases on read-only media. The upgrade process:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>marks the database as upgraded to the current release (Version <span style="border-right-width: 0pt; border-left-width: 0pt;">10.6</span>).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>allows use of new features.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the release notes for more information on upgrading your databases
to this version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div><div><a name="N10870"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="tdevpreupgrade"></a><div></div>Preparing to upgrade</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Upgrading your database occurs the first time the new <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software
connects to the old database.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1089A"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before you connect to the database using the new software:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Back up your database to a safe location using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> online/offline
backup procedures.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information on backup, see the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Update your CLASSPATH with the latest jar files.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Make sure that there are no older versions of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
files in your CLASSPATH. You can determine if you have multiple versions of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in your CLASSPATH by using the sysinfo tool.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use the <span style="font-family: Courier;">sysinfo</span> tool,
execute the following command:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">java org.apache.derby.tools.sysinfo</div></pre>The <span style="font-family: Courier;">sysinfo</span> tool
uses information found in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
files to determine the version of any <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar in your CLASSPATH. Be sure that you have only one version of
the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar files specified
in your CLASSPATH.</div></div></td></tr></table></div></div></div><div><a name="N10948"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="tdevupgradedb"></a><div></div>Upgrading a database</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To upgrade a database, you must explicitly request an upgrade the
first time you connect to the database with the new version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N10990"></a><span></span>Ensure that you <span style="color: blue;"><a href="#tdevpreupgrade">complete the prerequisite
steps</a></span> before you upgrade:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Back up your database before you upgrade.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Ensure that only the new <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
files are in your CLASSPATH.</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N109B0"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">When you upgrade the database, you can perform a full upgrade
or soft upgrade:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>A full upgrade is a complete upgrade of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.
When you perform a full upgrade, you cannot connect to the database with an
older version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and
you cannot revert back to the previous version. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>A soft upgrade allows you to run a newer version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
an existing database without having to fully upgrade the database. This means
that you can continue to run an older version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
the database. However, if you perform a soft upgrade, certain features will
not be available to you until you perform a full upgrade.</div></td></tr></table></div></div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">To upgrade the database, select the type of upgrade that you want
to perform:</span><div style="margin-top: 12pt;"><table style="margin-top: 10pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div style="font-size: 10pt;">Type of upgrade</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div style="font-size: 10pt;">Action</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #fafafa; margin-left: 2pt;" valign="top"><div style="font-weight: bold; font-size: 9pt;">Full upgrade</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #fafafa; margin-left: 2pt;" valign="top"><div style="font-weight: bold; font-size: 9pt;">Connect to the database using
the <span style="font-family: Courier;">upgrade=true</span> database connection URL attribute. For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:sample;upgrade=true</div></pre></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #fafafa; margin-left: 2pt;" valign="top"><div style="font-weight: bold; font-size: 9pt;">Soft upgrade</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #fafafa; margin-left: 2pt;" valign="top"><div style="font-weight: bold; font-size: 9pt;">Connect to the database. For
example: <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">connect 'jdbc:derby:sample'</div></pre>In this example, <span style="font-family: Courier;">sample</span> is
a database from a previous version of Derby.</div></td></tr></tbody></table></div></div></td></tr></table></div></div></div><div><a name="N10A73"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="tdevupgradesoft"></a><div></div>Soft upgrade limitations</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Soft upgrade allows you to run a newer version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
an existing database without having to fully upgrade the database. This means
that you can continue to run an older version of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> against
the database.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N10AAD"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you perform a soft upgrade, you will not be able to perform
certain functions that are not available in older versions of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. Specifically, new
features that affect the structure of a database are not available with a soft
upgrade. For a list of the new features in a release, see the Release Notes for
that release.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N10ABC"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To perform a soft upgrade on a database created using an earlier version of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, simply connect to the
database, as shown in the following example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">connect 'jdbc:derby:sample'</div></pre></div></div></div></div><div><a name="N10B10"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevdvlp19524"></a><div></div>JDBC applications and Derby basics</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section describes the core <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> functionality.
In addition, it details the most basic <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> deployment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded in a Java application.</div></div><div><a name="N10B7D"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdvlp14839"></a><div></div>Application development overview</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application
developers use the Java Database Connectivity (JDBC) API, the application
programming interface that makes it possible
to access relational databases from Java programs.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The JDBC API is part of the Java Platform, Standard Edition and is
not specific to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
It consists of the <span style="font-style: italic;">java.sql</span> and <span style="font-style: italic;">javax.sql</span> packages, which is
a set of classes and interfaces that make it possible to access databases
(from a number of different vendors, not just <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>)
from a Java application.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To develop <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications
successfully, you will need to learn the JDBC API. This section does not teach you
how to program with the JDBC API.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section covers the details of application programming that are specific
to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.
For example, all JDBC applications typically start their DBMS's JDBC driver
and use a connection URL to connect to a database. This chapter gives you
the details of how to start <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
JDBC driver and how to work with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
connection URL to accomplish various tasks. It also covers essential <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> concepts
such as the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You will find reference information about the particulars of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
implementation of the JDBC API in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application developers
will need to learn SQL. <span style="font-style: italic;">SQL</span> is the standard query language used with
relational databases and is not tied to a particular programming language.
No matter how a particular RDBMS has been implemented, the user can design
databases and insert, modify, and retrieve data using the standard SQL statements
and well-defined data types. SQL-92 is the version of SQL standardized by
ANSI and ISO in 1992; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
entry-level SQL-92 as well as some higher-level features. Entry-level SQL-92
is a subset of full SQL-92 specified by ANSI and ISO that is supported by
nearly all major DBMSs today. This chapter does not teach you SQL. You will
find reference information about the particulars of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
implementation of SQL in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> implements the JDBC
API so as to allow <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
serve as a resource manager in a Java EE compliant system.</div></div></div><div><a name="N10C64"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdvlp39409"></a><div></div>Derby embedded basics</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section explains how to use and configure <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
an embedded environment.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Included in the installation is a sample application program, <span style="font-style: italic;">/demo/programs/simple</span>,
which illustrates how to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded
in the calling program.</div></div><div><a name="N10D0D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp40653"></a><div></div>Derby JDBC driver</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> consists
of both the database engine and an embedded JDBC driver. Applications use
JDBC to interact with a database. Applications running on JDK 5 or earlier
must load the driver in order to work with the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, loading the driver also starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver
class name for the embedded environment is <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a Java application, you typically load the driver with the static <span style="font-style: italic;">Class.forName</span> method
or with the <span style="font-style: italic;">jdbc.drivers</span> system property. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
Class.forName("org.apache.derby.jdbc.EmbeddedDriver");
</div></pre><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">java -Djdbc.drivers=org.apache.derby.jdbc.EmbeddedDriver<span style="font-style: italic;"> applicationClass</span>
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For detailed information about loading the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC
driver, see "java.sql.Driver interface" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If your application runs on JDK 6 or higher, you do not need to
explicitly load the <span style="font-family: Courier;">EmbeddedDriver</span>. In that environment, the
driver loads automatically.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If your application shuts down Derby or calls the <span style="font-style: italic;">DriverManager.unload</span>
method, and you then want to reload the driver, call the
<span style="font-style: italic;">Class.forName().newInstance()</span> method.</div></div></div><div><a name="N10E1D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp17453"></a><div></div>Derby JDBC database connection URL</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A Java application using the JDBC API establishes a connection
to a database by obtaining a <span style="font-style: italic;">Connection</span> object.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The standard way to obtain a <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> object
is to call the method <span style="font-family: Courier;"><span style="font-style: italic;">DriverManager.getConnection</span></span>,
which takes a String containing a connection URL (uniform resource locator).
A JDBC connection URL provides a way of identifying a database. It also allows
you to perform a number of high-level tasks, such as creating a database or
shutting down the system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application in an embedded environment uses a different connection URL
from that used by applications using the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network
Server in a client/server environment. See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span> for
more information on the Network Server. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, all versions of the connection URL (which you can use for tasks
besides connecting to a database) have common features:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>you can specify the name of the database you want to connect to</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>you can specify a number of attributes and values that allow you to accomplish
tasks. For more information about what you can specify with the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection
URL, see <span style="color: blue;"><a href="#rdevdvlp22102">Database connection examples</a></span>.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The connection URL syntax is as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:[subsubprotocol:][<span style="font-style: italic;">databaseName</span>][;<span style="font-style: italic;">attribute</span>=<span style="font-style: italic;">value</span>]*</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">Subsubprotocol</span>, which is not typically specified, determines
how <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> looks for a database:
in a directory, in memory, in a class path, or in a jar file. <span style="font-style: italic;">Subsubprotocol</span> is one of
the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">directory</span>: The default. Specify this explicitly only to distinguish
a database that might be ambiguous with one on the class path.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">memory</span>: Databases exist only in main memory and are not written to
disk. An in-memory database may be useful when there is no need to persist the
database -- for example, in some testing situations.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">classpath</span>: Databases are treated as read-only databases, and all <span style="font-style: italic;">databaseNames</span> must
begin with at least a slash, because you specify them "relative" to the classpath
directory. See <span style="color: blue;"><a href="#cdevdvlp91854">Accessing databases from the classpath</a></span> for details.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jar</span>: Databases are treated as read-only databases. <span style="font-style: italic;">DatabaseNames</span> might
require a leading slash, because you specify them "relative" to the jar file.
See <span style="color: blue;"><a href="#cdevdvlp24155">Accessing databases from a jar or zip file</a></span> for details.
<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">jar</span> requires an additional element immediately before the
database name:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">(<span style="font-style: italic;">pathToArchive</span>)</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">pathToArchive</span> is the path to the jar or zip file that holds
the database.</div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For detailed reference about connection URL attributes and values, see 
"Setting attributes for the database connection URL" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following example shows the use of the connection URL:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection("jdbc:derby:sample");</div></pre></div></div><div><a name="N10FF2"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp27610"></a><div></div>Derby system</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
exists within a <span style="font-style: italic;">system</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is a
single instance of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
engine and the environment in which it runs. It consists of a system directory,
zero or more databases, and a system-wide configuration. The system directory
contains any persistent system-wide configuration parameters, or properties,
specific to that system in a properties file called <span style="color: blue;"><a href="#cdevdvlp39943">derby.properties</a></span>.
This file is not automatically created; you must create it yourself.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is
not persistent; you must specify the location of the system directory at every
startup.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
and the system directory is an essential part of a running database or databases.
Understanding the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
is essential to successful development and deployment of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications.
Derby databases live in a system, which includes system-wide properties, an
error log, and one or more databases.</div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 1. </span>Derby databases live in a
system, which includes system-wide properties, an error log, and one or more
databases.</div><div>&nbsp;</div><div><img src="system_os.jpg" alt="This figure shows a Derby system that includes a database called Accounting and a database called Sales. The figure shows the derby.system.home system variable pointing to the databases and explains that this system variable tells Derby the name of your system directory. Additionally, this figure shows that the derby.properties file and the derby.log file are part of the Derby system."></div><div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The system directory can also contain an error log file called <span style="font-style: italic;">derby.log </span>(see <span style="color: blue;"><a href="#cdevdvlp25889">The error log</a></span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Each database within that system is contained in a subdirectory, which
has the same name as the database (see <span style="color: blue;"><a href="#cdevdvlp21955">A Derby database</a></span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, if you connect to a database outside the current system, it
automatically becomes part of the current system.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  In-memory databases do not appear in the system directory.</div></div><div><a name="N111A6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp96597"></a><div></div>One Derby instance for each Java Virtual Machine (JVM)</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You could potentially have two instances of a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
running on the same machine at the same time. Each instance must run
in a different Java Virtual Machine (JVM).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you use the embedded driver, two
separate instances of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
cannot access the same database. If
a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> instance attempts 
to access a running database, an error message appears, and a stack trace
appears in the <span style="font-style: italic;">derby.log</span> file. If you want more than one
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> instance to be able
to access the same database, you can use the Network Server.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> instance
uses the in-memory database capability for its database connection, the database
exists only within the JVM of that
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> instance. Another
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> instance could refer to
the same database name, but it would not be referring to the same actual
database, and no error would result.</div></div></div><div><a name="N1123C"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp27715"></a><div></div>Booting databases</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The default configuration for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
to <span style="font-style: italic;">boot</span> (or start) a database when an application first makes a connection
to it. When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> boots
a database, it checks to see if recovery needs to be run on the database,
so in some unusual cases booting can take some time.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also configure your system to automatically boot all databases
in the system when it starts up; see "<span style="font-style: italic;">derby.system.bootAll</span>" in the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>. Because of the time needed
to boot a database, the number of databases in the system directory affects
startup performance if you use that configuration. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once a database has been booted within a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
it remains active until the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
has been shut down or until you shut down the database individually.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> boots a database,
a message is added to the log file. The message includes the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> version
that the database was booted with, for example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">2010-02-11 22:17:36.174 GMT:
 Booting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> version The Apache Software Foundation - <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span> 
-  10.6.0.0 - (908506): instance a816c00e-0121-2140-ffd9-fffff0cfee85
on database directory C:\sampledb</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The number of databases running in a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
is limited only by the amount of memory available in the JVM.</div></div></div><div><a name="N11335"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp20349"></a><div></div>Shutting down the system</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In an embedded environment, when an application shuts down, it
should first shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1135A"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the application that started the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> quits
but leaves the Java Virtual Machine (JVM) running, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> continues
to run and is available for database connections.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded system,
the application shuts down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
by issuing the following JDBC call:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">DriverManager.getConnection("jdbc:derby:;shutdown=true");</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Shutdown
commands always raise <span style="font-style: italic;">SQLExceptions</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
shuts down, a message goes to the log file:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">2010-02-11 22:19:13.372 GMT:
Shutting down instance a816c00e-0121-2140-ffd9-fffff0cfee85</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically,
an application using an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
shuts down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> just before
shutting itself down. However, an application can shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and
later restart it in the same JVM session. To restart <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> successfully,
the application needs to reload <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span> as
follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Class.forName(org.apache.derby.jdbc.EmbeddedDriver).newInstance();</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Loading the embedded driver starts Derby.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The JDBC specification does not recommend calling
<span style="font-family: Courier;">newInstance()</span>, but adding a <span style="font-family: Courier;">newInstance()</span> call
guarantees that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will be
booted on any JVM.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is also possible to shut down a single database instead of the entire <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system. See <span style="color: blue;"><a href="#tdevdvlp40464">Shutting down Derby or an individual database</a></span>.
You can reboot a database in the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> session
after shutting it down.</div></div></div></div><div><a name="N11428"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp13018"></a><div></div>Defining the system directory</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You define the system directory when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> starts
up by specifying a Java <span style="font-style: italic;">system property</span> called <span style="font-style: italic;">derby.system.home</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you do not specify the system directory when starting up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
the current directory becomes the system directory.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses the <span style="font-style: italic;">derby.system.home</span> property
to determine which directory is its system directory - and thus what databases
are in its system, where to create new databases, and what configuration parameters
to use. See the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for
more information on this property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you specify a system directory at startup that does not exist, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> creates
this new directory - and thus a new system with no databases-automatically.</div></div></div><div><a name="N114AA"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp25889"></a><div></div>The error log</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Once you create or connect to a database within a system, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> begins
outputting information and error messages to the error log.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> writes
this information to a log called <span style="font-style: italic;">derby.log</span> in the system directory,
although you can also have <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> send
messages to a stream, using the <span style="font-style: italic;">derby.stream.error.method</span> property.
By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> overwrites <span style="font-style: italic;">derby.log</span> when
you start the system. You can configure <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
append to the log with the <span style="font-style: italic;">derby.infolog.append</span> property.
For information on setting this and other properties, see the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div></div></div><div><a name="N11552"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp39943"></a><div></div>derby.properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The text file <span style="font-style: italic;">derby.properties</span> contains the definition of
properties, or configuration parameters that are valid for the entire system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">derby.properties</span> file is not automatically created. If you want
to set <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties
with this file, you need to create the file yourself. The <span style="font-style: italic;">derby.properties</span> file
should be in the format created by the <span style="font-style: italic;">java.util.Properties.save</span> method.
For more information about properties and the <span style="font-style: italic;">derby.properties</span> file,
see <span style="color: blue;"><a href="#cdevsetprop34818">Working with Derby properties</a></span> and the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div></div></div><div><a name="N115F8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp20458"></a><div></div>Double-booting system behavior</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> prevents
two instances of itself from booting the same database by using a file called
<span style="font-style: italic;">db.lck</span> inside the database directory.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a second instance of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> attempts to boot an
already running database, the following error messages appear:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
ERROR XJ040: Failed to start database 'firstdb', see the next exception
for details.
ERROR XSDB6: Another instance of Derby may have already booted the
database /home/myself/DERBYTUTOR/firstdb.
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, a stack trace appears in the <span style="font-style: italic;">derby.log</span> file.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you need to access a single database from more than one
Java Virtual Machine (JVM), you will need to put a server solution in place. You
can allow applications from multiple JVMs that need to access that database to
connect to the server. The
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network Server is
provided as a server solution. For basic information on starting and using the
Network Server, see <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span>. See the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span> for more information on the
Network Server.</div></div></div><div><a name="N116B1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp19297"></a><div></div>Recommended practices</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When developing <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications,
create a single directory to hold your database or databases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">Give this directory a unique name, to help you remember that: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>All databases exist within a system.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>System-wide properties affect the entire system, and persistent system-wide
properties live in the system directory.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You can boot all the databases in the system, and the boot-up times of
all databases affect the performance of the system.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You can preboot databases only if they are within the system. (Databases
do not necessarily have to live inside the system <span style="font-style: italic;">directory</span>, but keeping
your databases there is the recommended practice.)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Once you connect to a database, it is part of the current system and thus
inherits all system-wide properties.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Only one instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
run in a JVM at a single time.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The error log is located inside the system directory.</div></td></tr></table></div></div></div></div></div><div><a name="N11796"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp21955"></a><div></div>A Derby database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
contains dictionary objects such as tables, columns, indexes, and jar files.
A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database can also
store its own configuration information.</div></div><div><a name="N118A0"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp40724"></a><div></div>The database directory</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is stored in files that live in a directory of the same name as the database.
Database directories typically live in <span style="font-style: italic;">system</span> directories.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  An in-memory database does not use the file system, but the size limits
listed in the table
<span style="color: blue;"><a href="#cdevdvlp85623">Size limits for Derby database objects</a></span> still
apply. For some limits, the maximum value is determined by the available main
memory instead of the available disk space and file system limitations.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database directory contains the following, as shown in the following
figure.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">log</span> directory <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Contains files that make up the database transaction
log, used internally for data recovery (not the same thing as the error log).</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">seg0</span> directory <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Contains one file for each user table, system
table, and index (known as conglomerates).</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">service.properties</span> file <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A text file with internal configuration
information.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">tmp</span> directory  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(might not exist.) A temporary directory used
by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for large sorts
and deferred updates and deletes. Sorts are used by a variety of SQL statements.
For databases on read-only media, you might need to set a property to change
the location of this directory. See "Creating <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Databases
for Read-Only Use".</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jar</span> directory  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(might not exist.) A directory in which jar files
are stored when you use database class loading.</div></div></td></tr></table></div><a name="cdevdvlpaccessingareadonlydatabaseinazip"></a><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Read-only database directories
can be archived (and compressed, if desired) into jar or zip files. For more
information, see <span style="color: blue;"><a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following figure shows the files and directories in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
directories that are used by the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software.</div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 2. </span>An example of a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
directory and file structure.</div><div>&nbsp;</div><div><img src="dbcont.jpg" alt="This figure shows the files and directories that might be found in the main directory of a Derby database called Sales: the service.properties file, and the log, seg0, tmp, and jar directories."></div><div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> imposes relatively
few limitations on the number and size of databases and database objects.
The following table shows some size limitations of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
and database objects:</div><div><div style="font-weight: bold;"><span style="color: red;">Table 1. </span>Size limits for Derby
database objects</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Type of Object</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Limit</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>tables in each database</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">java.lang.Long.MAX_VALUE</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some operating systems
impose a limit to the number of files allowed in a single directory.</div></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>indexes in each table</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>32,767 or storage</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>columns in each table</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>1,012</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>number of columns on an index key</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>16</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>rows in each table</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>No limit.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>size of table</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>No limit. Some operating systems impose a limit on the
size of a single file.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>size of row</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>No limit. Rows can span pages. Rows cannot span tables
so some operating systems impose a limit on the size of a single file, which
results in limiting the size of a table and size of a row in that table.</div></td></tr></tbody></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a complete list of restrictions on <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
and database objects, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div><div><a name="N11AF2"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp42173"></a><div></div>Creating, dropping, and backing up databases</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You create new databases and access existing ones by specifying
attributes to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection
URL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you use an in-memory database, you can use a connection URL attribute
to drop it. For a file system database, however, there is no drop attribute. To
drop a database on the file system, delete the database
directory with operating system commands. The database must not be booted
when you remove a database. You can get a list of booted databases with <span style="font-style: italic;">getPropertyInfo</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To back up a database, you can use the online backup utility. For information
on this utility, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also use <span style="font-style: italic;">roll-forward recovery</span> to recover a damaged database. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> accomplishes roll-forward
recovery by using a full backup copy of the database, archived logs, and active
logs from the most recent time before a failure. For more information on roll-forward
recovery see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</div></div></div><div><a name="N11C03"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp845973"></a><div></div>Single database shutdown</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">An application can shut down a single database within a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
and leave the rest of the system running.</div></div></div><div><a name="N11C67"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp18166"></a><div></div>Storage and recovery</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
(unless it is an in-memory database)
provides persistent storage and recovery. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> ensures
that all committed transactions are durable, even if the system fails, through
the use of a database transaction log.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Whereas inserts, updates, and deletes may be cached before being written
to disk, log entries tracking all those changes are never cached but always
forced to disk when a transaction commits. If the system or operating system
fails unexpectedly, when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> next
starts up it can use the log to perform recovery, recovering the "lost" transactions
from the log and rolling back uncommitted transactions. <span style="font-style: italic;">Recovery</span> ensures
that all committed transactions at the time the system failed are applied
to the database, and all transactions that were active are rolled back. Thus
the databases are left in a consistent, valid state.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In normal operation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> keeps
the log small through periodic checkpoints. Checkpointing marks the portions
of the log that are no longer useful, writes changed pages to disk, then truncates
the log.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checkpoints the
log file as it fills. It also checkpoints the log when a shutdown command
is issued. Shutting down the JVM in which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running without issuing the proper shutdown command is equivalent to a system
failure from <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s point
of view.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Booting a database means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checks
to see if recovery needs to be run on a database. Recovery can be costly,
so using the proper shutdown command improves connection or startup performance.</div></div></div><div><a name="N11D11"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp84026"></a><div></div>Log on separate device</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can put a database's log on a separate device when you create
it.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</div></div></div><div><a name="N11D64"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp25820"></a><div></div>Database pages</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tables
and indexes, known as conglomerates, consist of two or more pages.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A page is a unit of storage whose size is configurable on a system-wide,
database-wide, or conglomerate-specific basis. By default, a conglomerate
grows one page at a time until eight pages of user data (or nine pages of
total disk use, which includes one page of internal information) have been
allocated. (You can configure this behavior; see
"<span style="font-style: italic;">derby.storage.initialPages</span>" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.) After that, it grows
eight pages at a time.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The size of a row or column is not limited by the page size. Rows or columns
that are longer than the table's page size are automatically wrapped to overflow
pages. </div></div></div><div><a name="N11DD5"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp846110"></a><div></div>Database-wide properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can set many <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties
as database-level properties. When set in this way, they are stored in the
database and "travel" with the database unless overridden by a system property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see
<span style="color: blue;"><a href="#cdevsetprop824451">Scope of properties</a></span> and 
<span style="color: blue;"><a href="#cdevsetprop12821">Setting database-wide properties</a></span>.</div></div></div><div><a name="N11E64"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp30653"></a><div></div><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database limitations</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
have a few limitations.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N11E9C"></a><span></span><div style="font-weight: bold;">Indexes</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Indexes are not supported for columns defined
on CLOB, BLOB, LONG VARCHAR, and XML data types.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the length of the
key columns in an index is larger than half the page size of the index, creating
an index on those key columns for the table fails. For existing indexes, an
insert of new rows for which the key columns are larger than half of the index
page size causes the insert to fail.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Avoid creating indexes on long
columns. Create indexes on small columns that provide a quick look-up to larger,
unwieldy data in the row. You might not see performance improvements if you
index long columns. For information about indexes, see <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span></span>. </div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N11EC2"></a><span></span><div style="font-weight: bold;">System shutdowns</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The system shuts down if the database
log cannot allocate more disk space.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A "LogFull" error or some sort
of <span style="font-family: Courier;">IOException</span> occurs in the <span style="font-family: Courier;">derby.log</span> file
when the system runs out of space. If the system has no more disk space to
append to the <span style="font-family: Courier;">derby.log</span> file, you might not see the error
messages.</div></div></div></div></div><div><a name="N11F37"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp34964"></a><div></div>Connecting to databases</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You connect to a database using a form of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection
URL as an argument to the <span style="font-style: italic;">DriverManager.getConnection</span> call.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You specify a path to the database within this connection URL.</div></div><div><a name="N12022"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp846369"></a><div></div>Connecting to databases within the system</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The standard way to access databases in the file system is by specifying
the path to the database, either absolute or relative to the system directory.
In a client/server environment, this path is always on the <span style="font-style: italic;">server</span> machine.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, you can connect to databases within the current system directory
(see <span style="color: blue;"><a href="#cdevdvlp13018">Defining the system directory</a></span>). To connect to
databases within the current system, just specify the database name on the
connection URL. For example, if your system directory contains a database
called <span style="font-style: italic;">myDB</span>, you can connect to that database with the following connection
URL:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:myDB</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The full call within a Java program would be:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn =DriverManager.getConnection("jdbc:derby:myDB");</div></pre></div></div><div><a name="N120C9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp846402"></a><div></div>Connecting to databases outside the system directory</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can also connect to databases in other directories (including
subdirectories of the system directory) by specifying a relative or absolute
path name to identify the database. The way you specify an absolute path is
defined by the host operating system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Using the connection URL as described here, you can connect to databases
in more than one directory at a time.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Two examples:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:../otherDirectory/myDB

jdbc:<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>:c:/otherDirectory/myDB</div></pre><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Once connected, such a database becomes a part of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
even though it is not in the system directory. This means that it takes on
the system-wide properties of the system and no other instance of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> should
access that database. It is recommended that you connect to databases only
in the system directory.</div></div></div><div><a name="N1217A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp40350"></a><div></div>Conventions for specifying the database path</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When accessing databases from the file system (instead of from
memory, the classpath, or a jar file), any path that is not absolute is interpreted as
relative to the system directory.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The path must do one of the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>refer to a previously created <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>specify the <span style="font-style: italic;">create=true</span> attribute</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The path separator in the connection URL is / (forward slash), as in the
standard <span style="font-style: italic;">file:// </span>URL protocol.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify only databases that are local to the machine on which the
JVM is running. NFS file systems on UNIX and remote shared files on Windows
(//<span style="font-style: italic;">machine/directory</span>) are not guaranteed to work. Using <span style="font-style: italic;">derby.system.home</span> and
forward slashes is recommended practice for platform independent applications.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If two different database name values, relative or absolute, refer to the
same actual directory, they are considered equivalent. This means that connections
to a database through its absolute path and its relative path are connections
to the same database. Within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
the name of the database is defined by the canonical path of its directory
from <span style="font-style: italic;">java.io.File.getCanonicalPath</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> automatically
creates any intermediate directory that does not already exist when creating
a new database. If it cannot create the intermediate directory, the database
creation fails.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the path to the database is ambiguous, i.e., potentially the same as
that to a database that is available on the classpath (see "Special Database
Access"), use the <span style="font-style: italic;">directory:</span> subsubprotocol to specify the one in the
file system. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:myDB</div></pre></div></div><div><a name="N12263"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp19700"></a><div></div>Special database access</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can also access databases from the classpath or from a jar
file (in the classpath or not) as read-only databases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can create in-memory databases for use in testing and development and for
processing temporary or reproducible data. See
<span style="color: blue;"><a href="#cdevdvlpinmemdb">Using in-memory databases</a></span> for details.</div></div><div><a name="N122FD"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp91854"></a><div></div>Accessing databases from the classpath: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In most cases, you access databases from the file system. However,
it is also possible to access databases from the classpath. The databases
can be archived into a jar or zip file or left as is.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All such databases are read-only.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access an unarchived database from the classpath, specify the name of
the database relative to the directory in the classpath. You can use the classpath
subprotocol if such a database is ambiguous within the directory system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, for a database called <span style="font-style: italic;">sample</span> in <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span>,
you can put the <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span> directory
in the classpath and access <span style="font-style: italic;">sample</span> like this:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:/sample
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The forward slash is required before <span style="font-style: italic;">sample</span> to indicate that it
is relative to <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>\demo\databases</span> directory.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If only <span style="font-style: italic;">C:\<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span></span> were
in the class path, you could access <span style="font-style: italic;">sample</span> (read-only) like this:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:/demo/databases/sample
</div></pre></div></div><div><a name="N123BB"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdvlp24155"></a><div></div>Accessing databases from a jar or zip file: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">It is possible to access databases from a jar file. The jar file
does not have to be on the classpath.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  All such databases are read-only.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose you have archived the database <span style="font-style: italic;">jarDB1</span> into
a file called <span style="font-style: italic;">jar1.jar</span>. This archive is in the classpath before you
start up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. You can
access <span style="font-style: italic;">jarDB1</span> with the following connection URL</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:/jarDB1</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access a database in a jar file that is not on the classpath, use the
jar subprotocol. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose you have archived the database <span style="font-style: italic;">jarDB2</span> into
a file called <span style="font-style: italic;">jar2.jar</span>. This archive is not in the classpath. You can
access <span style="font-style: italic;">jarDB2</span> by specifying the path to the jar file along with the
jar subsubprotocol, like this:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:jar:(c:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/jar2.jar)jarDB2
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For complete instructions and examples of accessing databases in jar files,
see <span style="color: blue;"><a href="#cdevdeploy11201">Accessing a read-only database in a zip/jar file</a></span>.</div></div></div></div><div><a name="N12458"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevdvlp22102"></a><div></div>Database connection examples</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The examples in this section use the syntax of the connection URL
for use in an embedded environment.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12477"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This information also applies to the client connection URL in
a client/server environment. For reference information about client connection
URLs, see "java.sql.Connection interface" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1248E"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:db1</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to the database <span style="font-style: italic;">db1</span>. <span style="font-style: italic;">db1</span> is
a directory located in the system directory.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:london/sales</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to the database <span style="font-style: italic;">london/sales</span>. <span style="font-style: italic;">london</span> is
a subdirectory of the system directory, and <span style="font-style: italic;">sales</span> is a subdirectory
of the directory <span style="font-style: italic;">london</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:/reference/phrases/french</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to
the database <span style="font-style: italic;">/reference/phrases/french</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">On a UNIX system, this
would be the path of the directory. On a Windows system, the path would be <span style="font-style: italic;">C:\reference\phrases\french</span> if
the current drive were <span style="font-style: italic;">C. </span>If a jar file storing databases were in the
user's classpath, this could also be a path within the jar file.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:a:/demo/sample</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Open a connection to the database
stored in the directory <span style="font-style: italic;">\demo\sample</span> on drive <span style="font-style: italic;">A</span> (usually the
floppy drive) on a Windows system.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>:c:/databases/salesdb
jdbc:derby:salesdb</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These two connection URLs connect to the same
database, <span style="font-style: italic;">salesdb</span>, on a Windows platform if the system directory of
the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system is <span style="font-style: italic;">C:\databases</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:support/bugsdb;create=true</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Create the database <span style="font-style: italic;">support/bugsdb</span> in
the system directory, automatically creating the intermediate directory <span style="font-style: italic;">support</span> if
it does not exist.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:sample;shutdown=true</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Shut down the <span style="font-style: italic;">sample</span> database.
(Authentication is not enabled, so no user credentials are required.)
</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:/myDB</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span> (which is directly in
a directory in the classpath) as a read-only database.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:memory:myDB</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access the in-memory database named
<span style="font-style: italic;">myDB</span>. The syntax for a client connection URL is different; see
<span style="color: blue;"><a href="#cdevdvlpinmemdb">Using in-memory databases</a></span> for details.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:classpath:/myDB</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span> (which is directly
in a directory in the classpath) as a read-only database. The reason for using
the subsubprotocol is that it might  have the same path as a database in the
directory structure.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:jar:(C:/dbs.jar)products/boiledfood</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access the
read-only database <span style="font-style: italic;">boiledfood</span> in the <span style="font-style: italic;">products</span> directory from
the jar file <span style="font-style: italic;">C:/dbs.jar</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">jdbc:derby:directory:myDB</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Access <span style="font-style: italic;">myDB</span>, which is in
the system directory. The reason for using the <span style="font-family: Courier;"><span style="font-style: italic;">directory:</span></span> subsubprotocol
is that it might happen to have the same path as a database in the classpath.</div></div></td></tr></table></div></div></div></div></div><div><a name="N1266A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdvlp51654"></a><div></div>Working with the database connection URL attributes</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You specify attributes on the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connection
URL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The examples in this section use the syntax of the connection URL for use
in an embedded environment. You can also specify these same attributes and
values on the client connection URL if you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as
a database server. For more information, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also set these attributes by passing a <span style="font-style: italic;">Properties</span> object
along with a connection URL to <span style="font-family: Courier;"><span style="font-style: italic;">DriverManager.getConnection</span></span> when
obtaining a connection; see <span style="color: blue;"><a href="#tdevdvlp36289">Specifying attributes in a properties object</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All attributes are optional. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For complete information about the attributes, see "Setting attributes for
the database connection URL" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For detailed information about the connection URL syntax,
see <span style="color: blue;"><a href="#cdevdvlp17453">Derby JDBC database connection URL</a></span>.</div></div><div><a name="N127DB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevdvlp847152"></a><div></div>Using the databaseName attribute</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can use a databaseName attribute on a database connection URL
to specify the name of the database to which you want to connect.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12813"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:;databaseName=<span style="font-style: italic;">databaseName</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12822"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can access read-only databases in jar or zip files by specifying <span style="font-family: Courier;">jar</span> as
the subsubprotocol, like this:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12831"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(<span style="font-style: italic;">pathToArchive</span>)<span style="font-style: italic;">databasePathWithinArchive</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12846"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Or, if the jar or zip file has been included in the classpath,
like this:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1284F"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:/<span style="font-style: italic;">databasePathWithinArchive</span></div></pre></div></div></div><div><a name="N128CD"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp40464"></a><div></div>Shutting down Derby or an individual database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Applications in an embedded environment shut down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
by specifying the <span style="font-style: italic;">shutdown=true</span> attribute in the connection URL. To
shut down the system, you do not specify a database name, and you do not
ordinarily specify any other attribute.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1290C"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:;<span style="border-right-width: 0pt; border-left-width: 0pt;">shutdown=true</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A successful
shutdown always results in an <span style="font-style: italic;">SQLException</span> to indicate that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> has
shut down and that there is no other exception.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you have enabled <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
BUILTIN user authentication at the system level (for example, by setting the
property <span style="font-style: italic;">derby.connection.requireAuthentication=true</span> in the
<span style="font-style: italic;">derby.properties</span> file), you will need to specify credentials
(that is, username and password) in order to shut down a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, and the
supplied username and password must also be defined at the system level.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
BUILTIN authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also shut down
an individual database if you specify the <span style="font-style: italic;">databaseName</span>. You can shut
down the database of the current connection if you specify the default connection
instead of a database name<span style="font-style: italic;"></span>(within an SQL statement).</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">// shutting down a database from your application</span>
DriverManager.getConnection(
    "jdbc:derby:sample;shutdown=true");</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If user
<span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
and
<span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
are both enabled, only the
<span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
can shut down the database.
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">// shutting down an authenticated database as database owner</span>
DriverManager.getConnection(
    "jdbc:derby:securesample;user=joeowner;password=secret;shutdown=true");</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Attention: </span>   
It is good practice to close existing connections before shutting down 
the system or database. Connections created before the shutdown will not 
be usable after shutdown is performed.  Attempting to access  connections 
after shutdown may cause errors including instances of 
<span style="font-family: Courier;">NullPointerException</span> or protocol violations. 
</div></div></div></div></div><div><a name="N129F4"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp39090"></a><div></div>Creating and accessing a database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You create a database by supplying a new database name in the connection
URL and specifying <span style="font-style: italic;">create=true</span>.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12A28"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> creates
a new database inside a new subdirectory in the system directory. This system
directory has the same name as the new database. If you specify a partial
path, it is relative to the system directory. You can also specify an absolute
path.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:<span style="font-style: italic;">databaseName</span>;<span style="border-right-width: 0pt; border-left-width: 0pt;">create=true</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For
more details about <span style="font-style: italic;">create=true</span>, see <span style="font-style: italic;">"create=true"</span> in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div></div><div><a name="N12ACC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp12233"></a><div></div>Providing a user name and password</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When user authentication is enabled, an application must provide
a user name and password. One way to do this is to use the <span style="font-style: italic;">user=userName</span> and <span style="font-style: italic;">password=userPassword</span> connection
URL attributes.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12AFC"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:sample;user=jill;password=toFetchAPail</div></pre></div></div></div><div><a name="N12B56"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlpcollation"></a><div></div>Creating a database with territory-based collation</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
Unicode codepoint collation. However, you can specify territory-based collation
when you create the database.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12B8A"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can use the <span style="font-family: Courier;">collation</span> and <span style="font-family: Courier;">territory</span> attributes
to specify territory-based collation. This type of collation applies only
to user-defined tables. The system tables use the Unicode codepoint collation. </div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Restriction: </span>  The <span style="font-family: Courier;">collation</span> attribute can be specified
only when you create a database. You cannot specify this attribute on an existing
database or when you upgrade a database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To create a database with
territory-based collation:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Specify the language and country codes for the <span style="font-family: Courier;">territory</span> attribute,
and the TERRITORY_BASED value for the <span style="font-family: Courier;">collation</span> attribute
when you create the database.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:MexicanDB;create=true;territory=es_MX;collation=TERRITORY_BASED </div></pre></div></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12BD8"></a><span></span><div style="font-weight: bold;">Creating a case-insensitive database</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">collation</span> value TERRITORY_BASED uses the default
collation strength for the locale, usually TERTIARY, which will consider
character case significant in searches and comparisons. To make the database
use case-insensitive searches, specify an explicit strength with the
<span style="font-family: Courier;">collation</span> attribute. The strength name is appended to
TERRITORY_BASED with a colon to separate them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:SwedishDB;create=true;territory=sv_SE;collation=TERRITORY_BASED:PRIMARY</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With strength PRIMARY, the characters 'A' and 'a' will be considered equal,
as well as '&agrave;' ('a' with a grave accent). (This behavior is
commonly the default with many other databases.) To make searches
respect differences in accent, use strength SECONDARY.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The exact interpretation of the strength part of the attribute depends upon
the locale.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see
<span style="color: blue;"><a href="#cdevcollation">Character-based collation in Derby</a></span> and the documentation of
the <span style="font-family: Courier;">collation</span> attribute in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div></div></div></div><div><a name="N12C41"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp14496"></a><div></div>Encrypting a database when you create it</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If your environment is configured properly, you can create your
database as an encrypted database (one in which the database is encrypted
on disk). To do this, you use the <span style="font-style: italic;">dataEncryption=true</span> attribute to
turn on encryption and the <span style="font-family: Courier;"><span style="font-style: italic;">bootPassword=key</span></span> attribute
or the encryptionKey attribute to specify a key for the encryption.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12C7F"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also specify an encryption provider and encryption algorithm
other than the defaults with the <span style="font-family: Courier;"><span style="font-style: italic;">encryptionProvider=providerName</span></span> and <span style="font-family: Courier;"><span style="font-style: italic;">encryptionAlgorithm=algorithm </span></span>attributes.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:encryptedDB;create=true;dataEncryption=true;
bootPassword=DBpassword</div></pre></div></div></div><div><a name="N12D10"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlpcreateencryptdbextkey"></a><div></div>Creating an encrypted database with an external key</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can create a database and encrypt the database with an external
key.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12D3E"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To create an encrypted database using an external key:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Use the <span style="font-style: italic;">encryptionKey</span> attribute in the connection URL.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example to create the database and encrypt the database <span style="font-family: Courier;">encDB</span> using
an external key, specify this URL:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:encDB;create=true;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=6162636465666768 </div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Attention: </span>   If you lose the encryption key you
will not be able to boot the database.</div></div></div></td></tr></table></div></div></div><div><a name="N12DB0"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp40140"></a><div></div>Booting an encrypted database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You must specify several attributes in the URL when you boot an
encrypted database. You must specify these attributes the first time that
you connect to the database within a JVM session, or after you shut the database
down within the same JVM session.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12DD4"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To boot an existing encrypted database: </div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">The attribute that you specify depends on how the database was
originally encrypted: </span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database was encrypted using the bootPassword mechanism, specify
the <span style="font-style: italic;">bootPassword</span> attribute. For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:wombat;bootPassword=clo760uds2caPe </div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database was encrypted using an external key, specify the <span style="font-style: italic;">encryptionKey</span> attribute.
For example: <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:flintstone;encryptionAlgorithm=AES/CBC/NoPadding;
encryptionKey=c566bab9ee8b62a5ddb4d9229224c678 </div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the algorithm
that was used when the database was created is not the default algorithm,
you must also specify the <span style="font-style: italic;">encryptionAlgorithm</span> attribute. The default
encryption algorithm used by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
DES/CBC/NoPadding.</div></div></td></tr></table></div></div></td></tr></table></div></div></div><div><a name="N12E93"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevdvlp36289"></a><div></div>Specifying attributes in a properties object</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Instead of specifying attributes on the connection URL, you can
specify attributes as properties in a <span style="font-family: Courier;">Properties</span> object that you pass
as a second argument to the <span style="font-family: Courier;">DriverManager.getConnection</span> method.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12EC8"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, to set the user name and password:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Class.forName("org.apache.derby.jdbc.EmbeddedDriver");

Properties p = new Properties();

p.setProperty("user", "sa");
p.setProperty("password", "manager");
p.setProperty("create", "true");

Connection conn = DriverManager.getConnection(
    "jdbc:derby:mynewDB", p);</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you are running on JDK 6 or higher, you do not normally need to invoke
<span style="font-family: Courier;">Class.forName()</span>. In that environment, the
<span style="font-family: Courier;">EmbeddedDriver</span> loads automatically. The only exception to this
rule is when you need to shut down
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in the middle of your
application and then restart it. To restart
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, create a new instance
of the driver as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Class.forName("org.apache.derby.jdbc.EmbeddedDriver").newInstance();</div></pre></div></div></div></div></div><div><a name="N12F39"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdvlpinmemdb"></a><div></div>Using in-memory databases</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">For testing and developing applications, or for processing transient
or reproducible data, you can use
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s in-memory database
facility.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An in-memory database resides completely in main memory, not in the file
system. It is useful for testing and developing applications, when you may want
to create and discard databases that will never be used again. It is also 
useful when you need to process only temporary or reproducible data.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you have the required memory available, you may also benefit from faster
processing (no disk I/O) and from the simplicity of not having to explicitly
delete databases you have finished with.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12F72"></a><span></span><div style="font-weight: bold;">Creating an in-memory database</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To create an in-memory database, specify <span style="font-family: Courier;">memory</span> as the JDBC
subsubprotocol. For example, to create an in-memory database named
<span style="font-family: Courier;">myDB</span> using the embedded driver, use the following connection
URL:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:memory:myDB;create=true</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For the network client driver, use the following connection URL. Because
the client driver does not understand the <span style="font-family: Courier;">memory</span>
subsubprotocol, you must include it in the database name:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby://<span style="font-style: italic;">myhost</span>:1527/memory:myDB;create=true</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Be careful to specify a colon (<span style="font-family: Courier;">:</span>) after
<span style="font-family: Courier;">memory</span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12FBA"></a><span></span><div style="font-weight: bold;">Using in-memory databases</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you use an in-memory database, you need to make sure to configure the
heap and the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> page
cache size. See "Configure
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to use an in-memory
database" in <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span> for details.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For examples of how to use an in-memory database, see some of the
<span style="font-family: Courier;">ij</span> command examples in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Tools and Utilities Guide</span></span> (<span style="font-family: Courier;">execute</span>
and <span style="font-family: Courier;">async</span>, for example).</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N12FFF"></a><span></span><div style="font-weight: bold;">Removing an in-memory database</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To remove an in-memory database, use the connection URL attribute <span style="font-style: italic;">drop</span>
as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:memory:myDB;drop=true</div></pre><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby://<span style="font-style: italic;">myhost</span>:1527/memory:myDB;drop=true</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can shut down an in-memory database using the <span style="font-style: italic;">shutdown=true</span>
attribute before you drop the database, but this is optional. Dropping the
database also performs the shutdown.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you drop the database,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues what appears to
be an error but is actually an indication of success. You need to catch error
08006, as described in "The WwdEmbedded program" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If user
<span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
and
<span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
are both enabled, only the
<span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
can drop the database.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An in-memory database is automatically removed if any of the following
happens:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The Java Virtual Machine (JVM) is shut down normally (for example, if you
exit the <span style="font-family: Courier;">ij</span> tool)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The JVM crashes</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The machine you are running on crashes or shuts down</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1307D"></a><span></span><div style="font-weight: bold;">Persisting an in-memory database</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you create an in-memory database and then decided that you want to keep it
after all, you can use one of the backup system procedures
(SYSCS_UTIL.SYSCS_BACKUP_DATABASE, for example) to persist it. You can then boot
it as an in-memory database at a later time, or use it as a normal file system
database. See "Backing up and restoring databases" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span> for information on using the
backup procedures.</div></div></div></div><div><a name="N130B2"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevsetprop34818"></a><div></div>Working with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section describes how to use
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties. For
details on specific properties, see the
"<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties" section of
the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div></div><div><a name="N1312B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevsetprop11108"></a><div></div>Properties overview</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> lets you
configure behavior or attributes of a system, a specific database, or a specific <span style="font-style: italic;">conglomerate</span> (a
table or index) through the use of properties.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">Examples of behavior or attributes that you can configure are:   <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Whether to authorize users</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Page size of tables and indexes</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Where and whether to create an error log</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Which databases in the system to boot</div></td></tr></table></div></div></div><div><a name="N131DC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop824451"></a><div></div>Scope of properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You use properties to configure a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, database, or
conglomerate.
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">system-wide</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Most properties can be set on a <span style="font-style: italic;">system-wide</span> basis; that is, you set a
property for the entire system and all its databases and conglomerates, if this
is applicable. Some properties, such as error handling and automatic booting,
can be configured only in this way, since they apply to the entire system. (For
information about the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
system, see <span style="color: blue;"><a href="#cdevdvlp27610">Derby system</a></span>.)</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">database-wide</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some properties can also be set on a <span style="font-style: italic;">database-wide</span> basis. That is, the
property is true for the selected database only and not for the other databases
in the system unless it is set individually within each of them.</div></div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For properties that affect conglomerates, changing the value of such
properties affects only conglomerates that are created after the change.
Conglomerates created earlier are unaffected.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Database-wide properties are stored in the database and are simpler for
deployment, in the sense that they follow the database. Database-wide properties
are also recommended for security reasons when you use
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> built-in user
authentication (see <span style="color: blue;"><a href="#cdevcsecuree">Derby and Security</a></span>).
System-wide properties can be more practical during the development
process.</div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div></div></div></div><div><a name="N132C6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop824500"></a><div></div>Persistence of properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database-wide property always has persistence. That is, its value is
stored in the database. Typically, it is in effect until you explicitly change
the property or until you set a system-wide property with precedence over
database-wide properties (see <span style="color: blue;"><a href="#cdevsetprop23308">Precedence of properties</a></span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To disable or turn off a database-wide property setting, set its value to
null. This has the effect of removing the property from the list of database
properties and restoring the system property setting, if there is one (and if
<span style="font-style: italic;">derby.database.propertiesOnly</span> has not been set; see
<span style="color: blue;"><a href="#cdevsetprop824533">Protection of database-wide properties</a></span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A system-wide property might have persistence, depending on how you set
it. If you set it programmatically, it persists only for the duration of the
JVM of the application that set it. If you set it in the
<span style="font-style: italic;">derby.properties</span> file, a property persists until:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>That value is changed and the system is rebooted</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The file is removed from the system and the system is rebooted</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The database is booted outside of that system</div></td></tr></table></div></div></div><div><a name="N1336A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop23308"></a><div></div>Precedence of properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The search order for properties is:  
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>System-wide properties set programmatically (as a command-line option
to the JVM when starting the application or within application code)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Database-wide properties</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>System-wide properties set in the <span style="font-style: italic;">derby.properties</span> file</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This means, for example, that system-wide properties set programmatically
override database-wide properties and system-wide properties set in the <span style="font-style: italic;">derby.properties</span> file, and that database-wide properties
override system-wide properties set in the <span style="font-style: italic;">derby.properties</span> file.</div></div><div><a name="N13412"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop824533"></a><div></div>Protection of database-wide properties: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There is one important exception to the search order for properties described
above: When you set the <span style="font-style: italic;">derby.database.propertiesOnly</span> property
to <span style="font-style: italic;">true</span>, database-wide properties cannot be overridden
by system-wide properties.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This property ensures that a database's environment cannot be modified
by the environment in which it is booted. Any application running in an embedded
environment can set this property to <span style="font-family: Courier;">true</span> for security reasons.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties"
section of the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for details on the
<span style="font-style: italic;">derby.database.propertiesOnly</span> property.</div></div></div></div><div><a name="N1348B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop824615"></a><div></div>Dynamic versus static properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Most properties are dynamic; that means you can set them while <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running, and their values change without requiring a reboot of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
In some cases, this change takes place immediately; in some cases, it takes
place at the next connection.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some properties are static, which means changes to their values will not
take effect while <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running. You must restart or set them before
(or while) starting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see <span style="color: blue;"><a href="#cdevsetprop44147">Making dynamic or static changes to properties</a></span>.</div></div></div></div><div><a name="N1352A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevsetprop24222"></a><div></div>Setting Derby properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section covers the different ways of setting properties.</div></div><div><a name="N135C9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop16827"></a><div></div>Setting system-wide properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set system-wide properties programmatically (as a command-line
option to the JVM when starting the application or within application code)
or in the text file <span style="font-style: italic;">derby.properties</span>.</div></div><div><a name="N1366F"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop11561"></a><div></div>Changing the system-wide properties programmatically: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set properties programmatically -- either in application code before
booting the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver or
as a command-line option to the Java Virtual
Machine (JVM) when booting the application that starts up
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. When you set
properties programmatically, these properties persist only for the duration of
the application. Properties set programmatically are not written to the
<span style="font-style: italic;">derby.properties</span> file or made persistent in any other way by
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Setting properties programmatically works only for the application that
starts up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>; for example,
for an application in an embedded environment or for the application server that
starts up a server product. It does not work for client applications connecting
to a server that is running.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set properties programmatically in the following ways:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="color: blue;"><a href="#comparam">As a parameter to the JVM command line</a></span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="color: blue;"><a href="#propobj">Using a Properties object within an application or statement</a></span></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N136E9"></a><span></span><div style="font-weight: bold;">As a parameter to the JVM command line</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set system-wide properties as parameters to the JVM command line when
you start up the application or framework in which
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is embedded. To do so,
you typically use the <span style="font-style: italic;">-D</span> option. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">java -Dderby.system.home=C:\home\<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>\ 
    -Dderby.storage.pageSize=8192 JDBCTest</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N13714"></a><span></span><div style="font-weight: bold;">Using a Properties object within an application or statement</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In embedded mode, your application runs in the same JVM as
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, so you can also set
system properties within an application using a <span style="font-style: italic;">Properties</span> object before
loading the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC
driver. The following example sets <span style="font-style: italic;">derby.system.home</span> on Windows.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">Properties p = System.getProperties();
p.setProperty("derby.system.home", "C:\databases\sample");</span></div></pre><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you pass in a <span style="font-style: italic;">Properties</span> object as an argument to the
<span style="font-style: italic;">DriverManager.getConnection</span> call when connecting to a database, those
properties are used as database connection URL attributes, not as properties of
the type discussed in this section. For more information, see
<span style="color: blue;"><a href="#cdevdvlp34964">Connecting to databases</a></span> and
<span style="color: blue;"><a href="#cdevdvlp51654">Working with the database connection URL attributes</a></span> as well as the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div></div></div></div><div><a name="N137AA"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop13074"></a><div></div>Changing the system-wide properties by using the derby.properties file: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set persistent system-wide properties in a text file called
<span style="font-style: italic;">derby.properties</span>, which must be placed in the directory specified by the
<span style="font-style: italic;">derby.system.home</span> property. There is one <span style="font-style: italic;">derby.properties</span>
file per system, not one per database. The file must be created in the system
directory. In a client/server environment, that directory is on the server.
(For more information about a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system and the system
directory, see <span style="color: blue;"><a href="#cdevdvlp27610">Derby system</a></span>.)</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does <span style="font-style: italic;">not</span>:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Provide this file</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Automatically create this file for you</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Automatically write any properties or values to this file</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Instead, you must create, write, and edit this file yourself.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The file should be in the format created by the
<span style="font-style: italic;">java.util.Properties.save</span> method.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The following is the text of a sample properties file:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">derby.infolog.append=true 
derby.storage.pageSize=8192
derby.storage.pageReservedSpace=60</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Properties set this way are persistent for the system until changed, until
the file is removed from the system, or until the system is booted in some
other directory (in which case
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> would be looking for
<span style="font-style: italic;">derby.properties</span> in that new directory). If a database is removed from a
system, system-wide properties do not "travel" with the database unless
explicitly set again.</div></div></div><div><a name="N1388A"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop824983"></a><div></div>Verifying system properties: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can find out the value of a system property if you set it
programmatically. You cannot find out the value of a system property if you set
it in the <span style="font-style: italic;">derby.properties</span> file.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For example, if you set the value of the
<span style="font-family: Courier;">derby.storage.pageSize</span> system-wide property in your program or
on the command line, the following code will retrieve its value from the System
Properties object:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">Properties sprops = System.getProperties();
System.out.println("derby.storage.pageSize value: "
+ sprops.getProperty("derby.storage.pageSize"));
</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also use Java Management Extensions (JMX) technology to obtain
system information, including some settings that correspond to system
properties. For details, visit the wiki page
<span style="color: blue;"><a href="http://wiki.apache.org/db-derby/DerbyJMX">http://wiki.apache.org/db-derby/DerbyJMX</a></span>
and refer to the API documentation for the packages
<span style="font-family: Courier;">org.apache.derby.mbeans</span> and
<span style="font-family: Courier;">org.apache.derby.mbeans.drda</span>. For information on JMX
technology, see 
<span style="color: blue;"><a href="http://java.sun.com/javase/technologies/core/mntr-mgmt/javamanagement/">http://java.sun.com/javase/technologies/core/mntr-mgmt/javamanagement/</a></span>.
</div></div></div></div><div><a name="N13914"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop12821"></a><div></div>Setting database-wide properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Database-wide properties, which affect a single database, are stored within
the database itself. This allows different databases within a single <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
to have different properties and ensures that the properties are correctly
retained when a database is moved away from its original system or copied.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You should use database-wide properties wherever possible for ease
of deployment and for security.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You set and verify database-wide properties using system procedures within SQL statements.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To set a property, you connect to the database, create a statement, and
then use the <span style="font-family: Courier;">SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY</span> procedure,
passing the name of the property and the value.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To check the current value of a property, you connect to the database,
create a statement, and then use the <span style="font-family: Courier;">SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY</span> function, passing in the name of the property.  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you specify an invalid value, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses the default value for
the property. (If you call the
<span style="font-family: Courier;">SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY</span> function, however, it
displays the invalid value.)</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for more information on how to use these system
functions and procedures.</div></div></div><div><a name="N139DE"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop24843"></a><div></div>Setting properties in a client/server environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a client/server environment, you must set the system properties for
the <span style="font-style: italic;">server</span>'s system. That means that when you are using
the <span style="font-style: italic;">derby.properties</span> file, the file exists in the <span style="font-style: italic;">server</span>'s
<span style="font-style: italic;">derby.system.home</span> directory.
Client applications can set database-wide properties because they are set via
SQL statements.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 2. </span>Summary of ways to set properties</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>Type of property</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>How you set it</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>System-wide</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>In <span style="font-style: italic;">derby.properties</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>As a command-line option when starting the JVM that holds the server or, if
the server is started from within a program, programmatically by the program
that hosts the server</div></td></tr></table></div></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Database-wide</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Using system procedures and functions in an SQL statement</div></td></tr></tbody></table></div></div></div><div><a name="N13ACB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevsetprop44147"></a><div></div>Making dynamic or static changes to properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Properties set in the <span style="font-style: italic;">derby.properties</span> file and on the command line of the application that boots <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are <span style="font-style: italic;">always</span> static, because <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> reads this file and
those parameters only at startup.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">Only properties set in the following ways have the potential to be dynamic:
 
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>As database-wide properties</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>As system-wide properties via a <span style="font-style: italic;">Properties</span> object
in the application in which the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine is embedded</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties"
section of the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for information
about specific properties.</div></div></div></div><div><a name="N13B71"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevsetprop32443"></a><div></div>Properties case study</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows you a lot of
freedom in configuring your system. This freedom can be confusing if you do not
understand how properties work. You also have the option of not setting any
properties and instead using the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> defaults, which are
tuned for a single-user embedded system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Imagine the following scenario of an embedded environment:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Your system has a <span style="font-style: italic;">derby.properties</span> file, a text file in the system
directory, which you have created and named <span style="font-style: italic;">system_directory</span>. Your
databases have also been created in this directory. The properties file sets
the following property:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">derby.storage.pageSize=8192</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You start up your application, being sure to set the <span style="font-style: italic;">derby.system.home</span>
property appropriately:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">java -Dderby.system.home=c:\system_directory MyApp</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The command lines in this example assume that you are using a Windows
system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You then create a new table:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CREATE TABLE table1 (a INT, b VARCHAR(10))</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> takes the page size
of 8192 from the system-wide properties set in the <span style="font-style: italic;">derby.properties</span> file,
since the property has not been set any other way.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You shut down and then restart your application, setting the value of
<span style="font-style: italic;">derby.storage.pageSize</span> to 4096 programmatically, as a parameter to the
JVM command line:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">java -Dderby.system.home=c:\system_directory 
    -Dderby.storage.pageSize=4096 MyApp

CREATE TABLE anothertable (a INT, b VARCHAR(10))</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The page size for the <span style="font-style: italic;">anothertable</span> table will be 4096 bytes.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You establish a connection to the database and set the value of the page
size for all new tables to 32768 as a database-wide property:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CallableStatement cs = 
  conn.prepareCall("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(?, ?)"); 
cs.setString(1, "derby.storage.pageSize"); 
cs.setString(2, "32768"); 
cs.execute(); 
cs.close(); 
</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You then create a new table that automatically inherits the page size set
by the property:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CREATE TABLE table2 (a INT, b VARCHAR(10))</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The page size for the <span style="font-style: italic;">table2</span> table is 32768 bytes.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You shut down the application, then restart, this time forgetting to set
the system-wide property programmatically (as a command-line option to the
JVM):
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">java -Dderby.system.home=c:\system_directory MyApp</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You then create another table:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CREATE TABLE table4 (a INT, b VARCHAR(10))</span></div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses the persistent
database-wide property of 32768 for this table, since the database-wide property
set in the previous session is persistent and overrides the system-wide property
set in the <span style="font-style: italic;">derby.properties</span> file.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">What you have is a situation in which three different tables each get a
different page size, even though the <span style="font-style: italic;">derby.properties</span> file remained
constant.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you remove the <span style="font-style: italic;">derby.properties</span> file from the system or remove the
database from its current location (forgetting to move the file with it), you
could get yet another value for a new table.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To avoid this situation, be consistent in the way you set properties.</div></div></div></div></div><div><a name="N13CC4"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevdeploy32171"></a><div></div>Deploying Derby applications</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Typically, once you have developed a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application
and database, you package up the application, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> libraries,
and the database in some means for distribution to your users. This process
is called <span style="font-style: italic;">deployment</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section discusses issues for deploying <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> applications
and databases.</div></div><div><a name="N13D2E"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdeploy38918"></a><div></div>Deployment issues</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses deployment options and details.</div></div><div><a name="N13D7B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy855368"></a><div></div>Embedded deployment application overview</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In an embedded environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> runs
in the same JVM as the application.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The application can be a single-user application or a multi-user application
server. In the latter case, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> runs
embedded in the user-provided server framework, and any client applications
use user-provided connectivity or allow the application server to handle all
database interaction.</div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 3. </span><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> embedded
in a single-user Java application</div><div>&nbsp;</div><div><img src="embed_os.jpg" alt="This figure shows the single-user application and the Derby database engine inside the Java Virtual Machine. The single-user application connects to the Derby database engine by using the JDBC API. The Derby database engine connects to the Derby database."></div><div></div></div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 4. </span>Derby embedded in a multi-user Java application
server</div><div>&nbsp;</div><div><img src="itserv_os.jpg" alt="This figure shows multiple users connecting to the application server, which contains the application and the Derby database engine. The application connects to the Derby database engine. The Derby database engine connects to the Derby database."></div><div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is embedded in a Java application, the database is dedicated to that single
application. If you deploy more than one copy of the application, <span style="font-style: italic;">each
application has its own copy of the database and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software</span>.
A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> server framework
can work in multi-threaded, multi-connection mode and can even connect to
more than one database at a time. A server framework, such as the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network
Server, can be used to manage multiple connections and handle network capabilities.
Some server framework solutions, such as WebSphere Application Server, provide
additional features such as web services and connection pooling. However,
only one server framework at a time can operate against a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application
accesses an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
through the JDBC API. To connect, an application makes a call to the local <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver. Accessing
the JDBC driver automatically starts the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> software.
The calling application is responsible for shutting down the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database software. </div></div></div><div><a name="N13E84"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy855655"></a><div></div>Deploying Derby in an embedded environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can embed <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
any Java application (single- or multi-user) by deploying the following packages.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> library (<span style="font-style: italic;">derby.jar</span>).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The libraries for the application. You have the option of storing these
libraries in the database.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The database or databases used by the application, in the context of their
system directory.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In the following figure, the top graphic shows the deployment of an application,
where the application, the Derby software for embedded use, the derby.properties
file and the database are four objects. The bottom graphic shows a simplified
deployment by reducing the number of objects to two by storing the application
and the properties file in the database. </div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 5. </span>Two approaches to deploying
a Derby application in an embedded environment.</div><div>&nbsp;</div><div><img src="edeploy_os.jpg" alt="This figure shows two graphics. The top graphic displays a slightly more complicated deployment of a Derby system involving four objects: the derby.jar file, your application jar file, the derby.properties file and the database. The bottom graphic displays a simplified deployment of a Derby system involving two objects. The application jar file and the derby properties are stored in the database. Only the derby.jar file is outside the database."></div><div></div></div></div><div><a name="N13F4A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy18639"></a><div></div>Embedded systems and properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Database-wide properties are stored in the database and are simpler
for deployment, while system-wide parameters might be easier for development.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If you are setting any system-wide properties, see if they can be set
as database-wide properties instead.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Are any properties being set in the <span style="font-style: italic;">derby.properties</span> file? Some
properties can only be set on a system-wide basis. If so, deploy the entire
system directory along with the properties file. Deploy only those databases
that you wish to include. Setting properties programmatically can simplify
this step- you will not have to worry about deploying the system directory/properties
file.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Extra steps are required for deploying an application and an embedded database
on read-only media.</div></div></div></div></div><div><a name="N13FE3"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdeploy15325"></a><div></div>Creating Derby databases for read-only use</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can create <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases for use on read-only media such as
CD-ROMs.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases in zip or jar files are also read-only databases.
Typically, read-only databases are deployed with an application in an embedded
environment.</div></div><div><a name="N140A8"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevdeploy26887"></a><div></div>Creating and preparing the database for read-only use</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To create databases for use on read-only media, perform these steps.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Create and populate the database on read-write media.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Commit all transactions and shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the prescribed manner. If you do not shut down <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the prescribed manner, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
need to perform recovery the next time the system boots. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> cannot
perform recovery on read-only media.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Delete the <span style="font-style: italic;">tmp</span> directory if one was created within your
database directory. If you include this directory, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
attempt to delete it and will return errors when attempting to boot a database
on read-only media.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">For the read-only database, set the property <span style="font-style: italic;">derby.storage.tempDirectory</span> to
a writable location.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> needs
to write to temporary files for large sorts required by such SQL statements
as ORDER BY, UNION, DISTINCT, and GROUP BY. For more information about this
property, see the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.storage.tempDirectory=c:/temp/mytemp</div></pre></div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Configure the database to send error messages to a writable file
or to an output stream.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information on the
<span style="font-style: italic;">derby.stream.error.file</span> property, see the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.stream.error.file=c:/temp/mylog.LOG</div></pre></div></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1415C"></a><span></span>Be sure to set these properties so that they are deployed with the
database.</div></div></div><div><a name="N141D0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevdeploy19136"></a><div></div>Deploying the database on the read-only media</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To deploy the database on read-only media, perform the following
steps.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Move the database directory to the read-only media, including the
necessary subdirectory directories (<span style="font-style: italic;">log</span> and <span style="font-style: italic;">seg0</span>) and the file <span style="font-family: Courier;"><span style="font-style: italic;">service.properties</span></span>.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Use the database as usual, except that you will not be able to
insert or update any data in the database or create or drop dictionary objects.</span></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N14220"></a><span></span></div></div></div><div><a name="N1427D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevdeploy33704"></a><div></div>Transferring read-only databases to archive (jar or zip) files</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Once a database has been created in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
it can be stored in a jar or zip file and continue to be accessed by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
read-only mode.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N142C6"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This allows a read-only database to be distributed as a single
file instead of as multiple files within a directory and to be compressed.
In fact, a jar or zip file can contain any number of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
and can also contain other information not related to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
such as application data or code.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot store the <span style="font-style: italic;">derby.properties</span> file
in a jar or zip file.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To create a jar or zip file containing one or
more <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Create a database for use on read-only media.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>From the directory that contains the database folder, archive the database
directory and its contents. For example, for the database<span style="font-style: italic;"> sales</span> that
lives in the system directory<span style="font-style: italic;"> C:\london</span>, issue the command from <span style="font-style: italic;">london</span>.
Do not issue the command from inside the database directory itself.</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, archive the database folder and its contents using
the JAR program from the JDK. You can use any zip or jar tool to generate
the archive.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">This command archives the database directory <span style="font-style: italic;">sales</span> and
its contents into a compressed jar file called <span style="font-style: italic;">dbs.jar</span>.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cd C:\london
jar cMf C:\dbs.jar sales</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You can add multiple databases
with jar. For example, this command puts the <span style="font-style: italic;">sales</span> databases and the <span style="font-style: italic;">boiledfood</span> database
(in the subdirectory products) into the archive.<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cd C:\london
jar cMf C:\dbs.jar sales products\boiledfood</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The relative
paths of the database in the jar need not match their original relative paths.
You can do this by allowing your archive tool to change the path, or by moving
the original databases before archiving them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The archive can be compressed
or uncompressed, or individual databases can be uncompressed or compressed
if your archive tool allows it. Compressed databases take up a smaller amount
of space on disk, depending on the data loaded, but are slower to access.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once
the database is archived into the jar or zip file, it has no relationship
to the original database. The original database can continue to be modified
if desired.</div></div></div></div><div><a name="N143B0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy11201"></a><div></div>Accessing a read-only database in a zip/jar file</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To access a database in a zip/jar, you specify the jar in the subsubprotocol.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(<span style="font-style: italic;">pathToArchive</span>)<span style="font-style: italic;">databasePathWithinArchive</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">pathToArchive</span> is the absolute path to the archive file. The <span style="font-style: italic;">databasePathWithinArchive</span> is
the relative path to the database within the archive. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(C:/dbs.jar)products/boiledfood
jdbc:derby:jar:(C:/dbs.jar)sales</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you have trouble finding a database within an archive, check the contents
of the archive using your archive tool. The <span style="font-style: italic;">databasePathWithinArchive</span> must
match the one in the archive. You might find that the path in the archive
has a leading slash, and thus the URL would be:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:jar:(C:/dbs.jar)/products/boiledfood</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases in a jar or zip file are always opened read-only and there is
currently no support to allow updates of any type.</div></div></div><div><a name="N14473"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevdeploy39856"></a><div></div>Accessing databases within a jar file using the classpath</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Once an archive containing one or more <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
has been created it can be placed in the classpath. This allows access to
a database from within an application without the application's knowing the
path of the archive.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N144A2"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When jar or zip files are part of the classpath, you do not have
to specify the jar subsubprotocol to connect to them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To access a database
in a zip or jar file in the classpath:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Set the classpath to include the jar or zip file before starting
up <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>:</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CLASSPATH="C:\dbs.jar;%CLASSPATH%"</div></pre></div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Connect to a database within the jar or zip file with one of the
following connection URLs:</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">Standard syntax:</span>
jdbc:derby:/<span style="font-style: italic;">databasePathWithinArchive</span></div></pre><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">Syntax with subsubprotocol:</span>
jdbc:derby:classpath:/<span style="font-style: italic;">databasePathWithinArchive</span></div></pre></div></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N144FA"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:/products/boiledfood
jdbc:derby:classpath:/products/boiledfood</div></pre></div></div></div><div><a name="N14544"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy18716"></a><div></div>Connecting to databases with ambiguous paths to databases in the file
system</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Use the basic connection URL syntax only if the database path specified
does not also point to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
in the file system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If this is the case, the connection attempt might fail or connect to the
wrong database. Use the form of the syntax with the subsubprotocol to distinguish
between the databases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:classpath:/products/boiledfood</div></pre></div></div></div><div><a name="N145AC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy856333"></a><div></div>Connecting to databases when the path is ambiguous because of databases
in the classpath</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To connect to a database in the file system when the connection
URL that you would use would be ambiguous with a database in the classpath,
use the following form of the connection URL.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:<span style="font-style: italic;">databasePathInFileSystem</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For example,<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:directory:/products/boiledfood</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Apart from the connection URL, databases in archives in the classpath behave
just like databases in archives accessed through the file system. However,
databases in archives are read-only.</div></div></div></div><div><a name="N14619"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy82529"></a><div></div>Databases on read-only media and DatabaseMetaData</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Databases on read-only media return true for <span style="font-style: italic;">DatabaseMetaData.isReadOnly</span>.</div></div></div></div><div><a name="N14692"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdeploy30736"></a><div></div>Loading classes from a database</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can store application logic in a database and then load classes
from the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Application logic, which can be used by SQL functions and procedures, includes
Java class files and other resources. Storing application code simplifies
application deployment, since it reduces the potential for problems with a
user's classpath.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In an embedded environment, when application logic is stored in the database, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can access classes loaded
by the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loader
from stored jar files. </div></div><div><a name="N14742"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy856753"></a><div></div>Class loading overview</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You store application classes and resources by storing one or more
jar files in the database. Then your application can access classes loaded
by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> from the jar file
and does not need to be coded in a particular way. The only difference is
the way in which you invoke the application.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here are the basic steps.</div></div><div><a name="N147D3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy15818"></a><div></div>Create jar files for your application</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Include any Java classes in a jar file that are intended for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loading, except
the following classes:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The standard Java packages (<span style="font-style: italic;">java.*</span>, <span style="font-family: Courier;"><span style="font-style: italic;">javax.*</span></span>)
  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not prevent
you from storing such a jar file in the database, but these classes <span style="font-style: italic;">are
never loaded</span> from the jar file.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The classes that are supplied with your Java environment (for example, <span style="font-style: italic;">sun.*</span>)</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A running <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
can load classes from any number of jar files from any number of schemas and
databases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Create jar files intended for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
class loading the same way you create a jar file for inclusion in a user's
classpath. For example, consider an application targeted at travel agencies: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">jar cf travelagent.jar travelagent/*.class.</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Various IDEs have tools to generate a list of contents for a jar file based
on your application. If your application requires classes from other jar files,
you have a choice:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Extract the required third-party classes from their jar file and include
only those classes in your jar file.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use this option when you need
only a small subset of the classes in the third-party jar file.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Store the third-party jar file in the database.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use this option
when you need most or all of the classes in the third-party jar file, since
your application and third-party logic can be upgraded separately.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Deploy the third-party jar file in the user's class path.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use
this option when the classes are already installed on a user's machine (for
example, Objectspace's JGL classes).</div></div></td></tr></table></div></div></div><div><a name="N148BA"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy23812"></a><div></div>Add the jar file or files to the database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Use a set of procedures to install, replace, and remove jar files
in a database. When you install a jar file in a database, you give it a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar name, which is an <span style="font-family: Courier;">SQL92Identifier</span>.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Once a jar file has been installed, you cannot modify any of the individual
classes or resources within the jar file. Instead, you must replace the entire
jar file.</div></div><div><a name="N14956"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="rdevdeploy856948"></a><div></div>Jar file examples: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N14963"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Tools and Utilities Guide</span></span></span> for reference information about
the utility and complete syntax.</div></div></div><div><a name="N149C5"></a><div style="font-size: 11pt; font-style: italic; margin-left: 72pt;"><a name="rdevdeploy856845"></a><div></div>Installing jar files: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N149D2"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.install_jar(
    'tours.jar', 'APP.Sample1', 0)

<span style="font-weight: bold;">-- SQL  statement
-- using a quoted identifier for the 
-- Derby jar name</span>
CALL sqlj.install_jar(
    'tours.jar', 'APP."Sample2"', 0)</div></pre></div></div></div><div><a name="N14A25"></a><div style="font-size: 11pt; font-style: italic; margin-left: 72pt;"><a name="rdevdeploy856880"></a><div></div>Removing jar files: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N14A32"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.remove_jar(
    'APP.Sample1', 0)</div></pre></div></div></div><div><a name="N14A83"></a><div style="font-size: 11pt; font-style: italic; margin-left: 72pt;"><a name="rdevdeploy856912"></a><div></div>Replacing jar files: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N14A90"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- SQL  statement</span>
CALL sqlj.replace_jar(
    'c:\myjarfiles\newtours.jar', 'APP.Sample1')</div></pre></div></div></div></div></div><div><a name="N14AE1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy21645"></a><div></div>Enable database class loading with a property</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Once you have added one or more jar files to a database, you must
set the database jar "classpath" by including the jar file or files in the <span style="font-style: italic;">derby.database.classpath</span> property
to enable <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to load
classes from the jar files.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This property, which behaves like a class path, specifies the jar files
to be searched for classes and resources and the order in which they are searched.
If <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not find
a needed class stored in the database, it can retrieve the class from the
user's classpath. (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> first
looks in the user's classpath before looking in the database.)</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Separate jar files with a colon (:).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use two-part names for the jar files (schema name and jar name). Set the
property as a database-level property for the database. The <span style="font-style: italic;">first time</span> you
set the property, you must reboot to load the classes.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.classpath',
    'APP.ToursLogic:APP.ACCOUNTINGLOGIC')</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See "<span style="font-style: italic;">derby.database.classpath</span>" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for
more information about the property.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s class loader
looks first in the user's classpath for any needed classes, and then in the
database. To ensure class loading with the database class loader, remove classes
from the classpath.</div></div></div><div><a name="N14BA7"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy12748"></a><div></div>Code your applications</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In your applications, you load the classes either by indirectly
referencing them in the code or by directly using <span style="font-style: italic;">java.lang.Class.forName</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You load resources the way you normally would, using the standard <span style="font-style: italic;">java.lang.Class.getResourceAsStream</span>,
a mechanism that allows an application to access resources defined in the
classpath without knowing where or how they are stored.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You do not need to make any changes to the way code interacts with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and its JDBC driver.
An application can safely attempt to boot <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
even though it is already running, without any errors. Applications connect
to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in the usual manner.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The method <span style="font-style: italic;">getResource</span> is not supported.</div></div></div></div><div><a name="N14C34"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevdeploy17604"></a><div></div>Dynamic changes to jar files or to the database jar classpath</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you store jar files in a single database and make those jar
files available to that database, it is possible to make changes to jar files
or to change the database jar "classpath" dynamically (without having to reboot).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">That is, when you install or replace a jar file within an SQL statement
or change the database jar "classpath" (the <span style="font-style: italic;">derby.database.classpath</span> property<span style="font-family: Courier;"><span style="font-style: italic;">),</span></span><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is able to load the new
classes right away without your having to reboot.</div></div><div><a name="N14CE1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy857611"></a><div></div>Requirements for dynamic changes</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Certain conditions must be met for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
be able to load the new classes right away without you having to reboot.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You <span style="font-style: italic;">originally configured</span> database-level class loading for the
database correctly. Turning on the database-level class loading property requires
setting the <span style="font-family: Courier;"><span style="font-style: italic;">derby.database.classpath</span></span> property with
valid two-part names, then rebooting.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If changes to the <span style="font-style: italic;">derby.database.classpath</span> property are needed
to reflect new jar files, you change the property to a valid value.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If these requirements are not met, you will have to reboot to see the changes.</div></div></div><div><a name="N14D51"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevdeploy857648"></a><div></div>Notes on dynamic changes</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you are changing the <span style="font-style: italic;">derby.database.classpath</span> property, all
classes loaded from database jar files are reloaded, even for a jar file that
has not changed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Remember that the user's classpath is searched first.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Any existing prepared statements will use the previously loaded classes
unless they require class loading, in which case they will fail with a <span style="font-style: italic;">ClassNotFound</span> error.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cached objects do not match objects created with newly loaded classes.
For example, an in-memory <span style="font-style: italic;">Customer</span> object will not match a new <span style="font-family: Courier;"><span style="font-style: italic;">Customer</span></span> object
if the <span style="font-family: Courier;"><span style="font-style: italic;">Customer</span></span> class has been reloaded, and it will
raise a <span style="font-family: Courier;"><span style="font-style: italic;">ClassCastException.</span></span></div></div></div></div></div></div><div><a name="N14DCF"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevspecial"></a><div></div>Derby server-side programming</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses special programming for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In particular, this section discusses how to program database-side JDBC routines,
triggers, and table functions.</div></div><div><a name="N14E30"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevspecial42117"></a><div></div>Programming database-side JDBC routines</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Methods invoked within an application are called application-side
methods. Methods invoked within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are
called database-side routines.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application-side method can be exactly the same as a database-side routine.
The only difference is where you invoke them. You write the method only once.
Where you invoke the method--within the application or within an SQL statement--determines
whether it is an "application-side" or a "database-side" method. </div></div><div><a name="N14ED1"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial29620"></a><div></div>Database-side JDBC routines and nested connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Most database-side JDBC routines need to share the same transaction
space as the statements that called them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The reasons for this are:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>to avoid blocking and deadlocks</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>to ensure that any updates done from within the routine are atomic with
the outer transaction</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to use the same transaction, the routine must use the same connection
as the parent SQL statement in which the routine was executed. Connections
re-used in this way are called <span style="font-style: italic;">nested connections</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Use the connection URL <span style="font-style: italic;">jdbc:default:connection</span> to re-use the current <span style="font-style: italic;">Connection</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database donnection URL <span style="font-style: italic;">jdbc:default:connection</span> allows a Java method
to get the <span style="font-style: italic;">Connection</span> of the SQL statement that called it. This is
the standard (SQL standard, Part 13, SQL Routines and Java) mechanism to obtain
the nested connection object. The method would get a <span style="font-style: italic;">Connection</span>
as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:default:connection");</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">URL attributes are not supported as part of this connection URL. Any URL
attributes specified in a Properties object, user name, or password that are
passed to a <span style="font-style: italic;">java.sql.DriverManager.getConnection()</span> call will be ignored.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Loading a JDBC driver in a database-side routine is not required.</div></div><div><a name="N14FB4"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecial28907"></a><div></div>Requirements for database-side JDBC routines using nested connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In order to preserve transactional atomicity, database-side JDBC
routines that use nested connections have the following limitations.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Can issue a commit or rollback only within a procedure (not a function).
  </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Cannot change the auto-commit connection attribute.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Cannot modify the data in a table used by the parent statement that called
the routine, using INSERT, UPDATE, or DELETE. For example, if a SELECT statement
using the <span style="font-style: italic;">T</span> table calls the <span style="font-family: Courier;"><span style="font-style: italic;">changeTables</span></span> procedure, <span style="font-family: Courier;"><span style="font-style: italic;">changeTables</span></span> cannot
modify data in the <span style="font-style: italic;">T</span> table. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Cannot drop a table used by the statement that called the routine.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Cannot be in a class whose static initializer executes DDL statements.</div></td></tr></table></div>In addition, the Connection object that represents the nested connection
always has its auto-commit mode set to false.</div></div></div></div><div><a name="N15037"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial16181"></a><div></div>Database-side JDBC routines using non-nested connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A database-side JDBC routine can create a new connection instead
of using a nested connection. Statements executed in the routine will be
part of a different transaction, and so can issue commits and rollbacks.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Such a routine can connect to a database different from the one to which
the parent SQL statement that called it is connected. The routine does not
use the same transaction or <span style="font-style: italic;">Connection</span>. It establishes a new <span style="font-style: italic;">Connection</span> and
transaction.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If database-side JDBC routines do not use nested connections, this
means that they are operating outside of the normal DBMS transaction control,
so it is not good practice to use them indiscriminately.</div></div><div><a name="N150CE"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecial847513"></a><div></div>Invoking a procedure using the CALL command</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If a procedure uses only IN parameters, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
execute the procedure by using the SQL CALL command. A stored procedure with
IN, OUT, or INOUT parameters can be invoked from a client application by using
a <span style="font-style: italic;">CallableStatement</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can invoke the procedure in an SQL statement such as the following:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CALL MYPROC()</span></div></pre><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  You can roll back a CALL statement only if no commits or rollbacks
occur within the specified procedure.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can also use the CALL command to execute a routine that returns
a value, but you will not be able to access the value.</div></div></div></div><div><a name="N15134"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial41728"></a><div></div>Database-side JDBC routines and SQLExceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">It is possible to code database-side routines, like application-side
methods, to catch <span style="font-style: italic;">SQLExceptions</span>. SQLExceptions that are caught within
a routine are hidden from the calling application code.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When such <span style="font-style: italic;">SQLExceptions</span> are of transaction severity
(such as deadlocks), this "hiding" of the exception causes unexpected problems.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This is because errors of transaction severity roll back work already done
by a transaction (not just the piece executed by the called method) and silently
begin a new transaction. When the method execution is complete, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> detects
that the outer statement was invalidated by a deadlock and rolls back any
work done<span style="font-style: italic;"> in the new transaction</span> as well. This is the expected behavior,
because all the statements in between explicit commits should be treated atomically;
the new transaction implicitly begun by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
rollback was not intended by the application designer.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, this is not the same behavior that would happen if the method
were invoked in the application. In that situation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> would
roll back the work done by the transaction and silently begin a new transaction.
Work in the new transaction would not be rolled back when the method returned.
However, coding the application in that way means that the transaction did
not end where you expected it to and is probably a programming mistake. Coding
in this manner is not recommended.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A method that catches a deadlock exception and then continues is probably
making a mistake. Errors of transaction severity should be caught not by nested
code, but only by the outermost application code. That is the only way to
ensure that transactions begin and end where you expect them to.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Not all database vendors handle nested deadlocks the same way. For this
and other reasons, it is not possible to write portable SQL-invoking methods.
However, it is possible to write SQL-invoking methods that behave identically <span style="font-style: italic;">regardless
of whether you invoke them in the application or as a routine in the database</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to ensure identical application- and database-side handling of
nested errors, code try-catch blocks to check for the severity of exceptions
as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">try {
    preparedStatement.execute();
} catch (SQLException se ) {
        String SQLState = se.getSQLState();
    if ( SQLState.equals( "23505" ) ) 
        { correctDuplicateKey(); }
    else if ( SQLState.equals( "22003" ) ) {    
        correctArithmeticOverflow(); }
    else { throw se; }
}</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Of course, users also have the choice of not wrapping SQL statements in
try-catch blocks within methods. In that case, <span style="font-style: italic;">SQLExceptions</span> are caught
higher up in their applications, which is the desired behavior.</div></div></div><div><a name="N1520B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial45786"></a><div></div>User-defined SQLExceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When the execution of a database-side method raises an error, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> wraps that exception
in an <span style="font-style: italic;">SQLException</span> with an <span style="font-family: Courier;"><span style="font-style: italic;">SQLState</span></span> of 38000.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can avoid having <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> wrap
the exception if:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The exception is an <span style="font-style: italic;">SQLException</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The range of the <span style="font-style: italic;">SQLState</span> is 38001-38999</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">(This conforms to the SQL99 standard.)</div></div></div></div><div><a name="N152BE"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevspecial27163"></a><div></div>Programming trigger actions</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows
you to create triggers. When you create a trigger, you define an action or
set of actions that are executed when a database event occurs on a specified
table. A <span style="font-style: italic;">database event</span> is a delete, insert, or update operation.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, if you define a trigger for a delete on a particular table,
the trigger action is executed whenever someone deletes a row or rows from
the table.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">CREATE TRIGGER</span> statement in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> goes
into detail of the complete <span style="font-family: Courier;">CREATE TRIGGER</span> syntax. This section
provides information on defining the trigger action itself, which is only
one aspect of creating triggers.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section refers to the <span style="font-family: Courier;">CREATE TRIGGER</span> statement as
the <span style="font-style: italic;">trigger actions</span>.</div></div><div><a name="N15396"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial53165"></a><div></div>Trigger action overview</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A trigger action is a simple SQL statement.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CREATE TRIGGER . . .
DELETE FROM flightavailability 
	WHERE flight_id IN (SELECT flight_id FROM flightavailability 
		WHERE YEAR(flight_date) &lt; 2005);) </div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A trigger action does have some limitations, though; for example, it cannot
contain dynamic parameters or alter the table on which the trigger is defined.
See "TriggerAction" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for
details. </div></div></div><div><a name="N15438"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial76763"></a><div></div>Performing referential actions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
referential actions. Examples in this section are included to illustrate how
to write triggers.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can choose to use standard SQL referential integrity to obtain this
functionality, rather than writing triggers. See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for
more information on referential integrity.</div></div></div><div><a name="N15500"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial67260"></a><div></div>Accessing before and after rows</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Many trigger actions need to access the values of the rows being
changed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Such trigger actions need to know one or both of the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>the "before" values of the rows being changed (their values before the
database event that caused the trigger to fire)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>the "after" values of the rows being changed (the values to which the
database event is setting them)</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides transition
variables and transition tables for a trigger action to access these values.
See "Referencing Old and New Values: The Referencing Clause" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div><div><a name="N155AD"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial13670"></a><div></div>Examples of trigger actions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N155CC"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following trigger action copies a row from the <span style="font-style: italic;">flights</span> table
into the <span style="font-style: italic;">flight_history</span> table whenever any row gets inserted into <span style="font-style: italic;">flights</span> and
adds the comment "inserted from trig1" in the <span style="font-style: italic;">status</span> column of
the <span style="font-style: italic;">flight_history</span> table.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N155F3"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CREATE TRIGGER trig1 
AFTER UPDATE ON flights 
REFERENCING OLD AS UPDATEDROW 
FOR EACH ROW MODE DB2SQL 
INSERT INTO flights_history 
VALUES (UPDATEDROW.FLIGHT_ID, UPDATEDROW.SEGMENT_NUMBER,
UPDATEDROW.ORIG_AIRPORT, UPDATEDROW.DEPART_TIME,
UPDATED ROW.DEST_AIRPORT, UPDATEDROW.ARRIVE_TIME,
UPDATEDROW.MEAL, UPDATEDROW.FLYING_TIME, UPDATEDROW.MILES,
UPDATEDROW.AIRCRAFT,'INSERTED FROM trig1');</span></div></pre></div></div></div><div><a name="N15662"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecial49460"></a><div></div>Triggers and exceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Exceptions raised by triggers have a statement severity; they roll
back the statement that caused the trigger to fire.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This rule applies to nested triggers (triggers that are fired by other
triggers). If a trigger action raises an exception (and it is not caught),
the transaction on the current connection is rolled back to the point before
the triggering event. For example, suppose Trigger A causes Trigger B to fire.
If Trigger B throws an exception, the current connection is rolled back to
the point before the statement in Trigger A that caused Trigger B to fire.
Trigger A is then free to catch the exception thrown by Trigger B and continue
with its work. If Trigger A does not throw an exception, the statement that
caused Trigger A, as well as any work done in Trigger A, continues until the
transaction in the current connection is either committed or rolled back.
However, if Trigger A does not catch the exception from Trigger B, it is as
if Trigger A had thrown the exception. In that case, the statement that caused
Trigger A to fire is rolled back, along with any work done by both of the
triggers.</div></div><div><a name="N15708"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecial93497"></a><div></div>Aborting statements and transactions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You might want a trigger action to be able to abort the triggering
statement or even the entire transaction.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Triggers that use the current connection are not permitted to commit or
roll back the connection, so how do you do that? The answer is: have the trigger
throw an exception, which is by default a statement-level exception (which
rolls back the statement). The application-side code that contains the statement
that caused the trigger to fire can then roll back the entire connection if
desired. Programming triggers in this respect is no different from programming
any database-side JDBC method.</div></div></div></div></div><div><a name="N1573C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevspecialtabfuncs"></a><div></div>Programming
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> lets
you create table functions. Table functions are functions which package up external
data to look like <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
tables. The external data can be an XML
file, a table in a foreign database, a live data feed--in short, any
information source that can be presented as a JDBC <span style="font-style: italic;">ResultSet</span>.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions let you efficiently import foreign data into
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tables.
Table functions let you join
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tables with any of
the following data sources:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>XML-formatted reports and logs</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Queries that run in foreign databases</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Streaming data from sensors</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>RSS feeds</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See "CREATE FUNCTION statement" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for the complete syntax needed to
declare <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions. The following topics
provide information on how to write Java methods which wrap
foreign data sources inside <span style="font-style: italic;">ResultSet</span>s.</div></div><div><a name="N15815"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecialtfbasic"></a><div></div>Overview of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style
table function is a method which returns a JDBC <span style="font-style: italic;">ResultSet</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Most of the <span style="font-style: italic;">ResultSet</span> methods can be
written as stubs which simply raise exceptions. However, the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table function
must implement the following <span style="font-style: italic;">ResultSet</span> methods:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">next()</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">close()</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">wasNull()</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">getXXX()</span> - When invoking a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
function at runtime, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
calls a <span style="font-style: italic;">getXXX()</span>
        method on each referenced column. The particular <span style="font-style: italic;">getXXX()</span>
        method is based on the column's data type
        as declared in the <span style="font-family: Courier;">CREATE FUNCTION</span> statement.
<span style="color: blue;"><a href="#cdevspecialtfgetxxx">Preferred getXXX() methods for Derby-style table functions</a></span>
explains how <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> selects an
appropriate <span style="font-style: italic;">getXXX()</span> method.
However, nothing prevents application code from calling other <span style="font-style: italic;">getXXX()</span>
        methods on the <span style="font-style: italic;">ResultSet</span>. The returned <span style="font-style: italic;">ResultSet</span>
needs to implement the <span style="font-style: italic;">getXXX()</span> methods which
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will call as well
        as all <span style="font-style: italic;">getXXX()</span> methods which the application will call.
</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
A <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table function
is materialized by a public static method which returns a <span style="font-style: italic;">ResultSet</span>:
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
public static ResultSet read() {...}
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
The public static method is then bound to a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> function name:
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
CREATE FUNCTION externalEmployees
()
RETURNS TABLE
(
  employeeId    INT,
  lastName      VARCHAR( 50 ),
  firstName     VARCHAR( 50 ),
  birthday      DATE
)
LANGUAGE JAVA
PARAMETER STYLE DERBY_JDBC_RESULT_SET
READS SQL DATA
EXTERNAL NAME 'com.acme.hrSchema.EmployeeTable.read'
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
To invoke a table function, wrap it in a TABLE constructor in the FROM list of a
query. Note that the table alias (in this example "s") is a required part of the
syntax:
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
INSERT INTO employees
  SELECT s.*
    FROM TABLE (externalEmployees() ) s;
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
With a normal table function, you must select its entire contents. You can,
however, write a restricted table function that lets you limit the rows and
columns you select. A restricted table function can improve performance greatly.
See <span style="color: blue;"><a href="#cdevspecialtfrestr">Writing restricted table functions</a></span> for details.
</div></div><div><a name="N1594F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecialtfgetxxx"></a><div></div>Preferred <span style="font-style: italic;">getXXX()</span> methods for
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">While scanning a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table function,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls a preferred
<span style="font-style: italic;">getXXX()</span> method for each column, based on the column's data type. If
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running on a small
device platform and presenting the JSR 169 interface to clients, then the
methods which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls are
slightly different. This is because JSR 169 does not support BigDecimal.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following table lists the preferred <span style="font-style: italic;">getXXX()</span> method for each
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> data type.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 3. </span><span style="font-weight: bold;"><span style="font-style: italic;">getXXX()</span> Methods Called for Declared SQL Types</span></div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Column Type Declared by CREATE FUNCTION</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div><span style="font-style: italic;">getXXX()</span> Method Called by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for JDBC 3.0 and 4.0</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div><span style="font-style: italic;">getXXX()</span> Method Called by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for JSR 169</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>BIGINT</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getLong()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>BLOB</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBlob()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>CHAR</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getString()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>CHAR FOR BIT DATA</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBytes()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>CLOB</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getClob()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>DATE</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getDate()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>DECIMAL</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBigDecimal()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getString()</span></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>DOUBLE</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getDouble()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>DOUBLE PRECISION</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getDouble()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>FLOAT</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getDouble()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>INTEGER</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getInt()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>LONG VARCHAR</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getString()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>LONG VARCHAR FOR BIT DATA</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBytes()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>NUMERIC</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBigDecimal()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getString()</span></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>REAL</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getFloat()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SMALLINT</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getShort()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TIME</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getTime()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TIMESTAMP</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getTimestamp()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>VARCHAR</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getString()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>VARCHAR FOR BIT DATA</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">getBytes()</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>XML</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-weight: bold;">Not supported</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-weight: bold;">Not supported</span></div></td></tr></tbody></table></div></div></div></div><div><a name="N15C63"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecialtfexample"></a><div></div>Example <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style
table function</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The following simple table function selects rows from a foreign
database.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
package com.acme.hrSchema;

import java.sql.*;

/**
 * Sample Table Function for reading the employee table in an
 * external database.
 */
public class EmployeeTable
{
    public static ResultSet read()
        throws SQLException
    {
        Connection conn = getConnection();
        PreparedStatement ps = conn.prepareStatement(
            "select * from hrSchema.EmployeeTable" );

        return ps.executeQuery();
    }

    protected static Connection getConnection()
        throws SQLException
    {
        String EXTERNAL_DRIVER = "com.mysql.jdbc.Driver";

        try { 
            Class.forName( EXTERNAL_DRIVER ); 
        }
        catch (ClassNotFoundException e) {
            throw new SQLException( "Could not find class " 
                + EXTERNAL_DRIVER );
        }

        Connection conn = DriverManager.getConnection( 
            "jdbc:mysql://localhost/hr?user=root&amp;password=mysql-passwd" );

        return conn;
    }
}
</div></pre></div></div><div><a name="N15CB0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecialtfrestr"></a><div></div>Writing restricted table functions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Restricted table functions are
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table functions
which perform more efficiently because they can be told in advance which columns
they will be asked to fetch along with simple limits on those columns. This
feature exploits the expressiveness of the Java programming language and does
not require any extensions to SQL.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A table function returns a rectangular chunk of data. If you use a restricted
table function, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
tell the table function to return a shorter and  narrower rectangle.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Consider the following scan of a table in a foreign database:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">    select id, firstName, lastName
    from table( foreignDatabaseEmployeeTable() ) s
    where lastName = 'Stone'
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If <span style="font-style: italic;">foreignDatabaseEmployeeTable</span> is a restricted table function,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can tell the table
function to fetch only the <span style="font-style: italic;">id</span>, <span style="font-style: italic;">firstName</span>, and <span style="font-style: italic;">lastName</span>
columns. In addition, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
can tell the table function that it does not need to scan the entire
foreign table; instead, the table function only needs to retrieve information
for employees whose last name is "Stone".</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Depending on the table function and query, this feature can support 1000X, 
1000000X, or even greater performance improvements.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N15D1E"></a><span></span><div style="font-weight: bold;">How to use restricted table functions</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Creating and using a restricted table function involves the following steps:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Implement</span> - You must write a class which implements both
<span style="font-style: italic;">java.sql.ResultSet</span> and the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-specific interface
<span style="font-style: italic;">org.apache.derby.vti.RestrictedVTI</span>. This interface defines an
<span style="font-style: italic;">initScan()</span> method. When executing a query,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses that method to
tell the table function what columns it will have to fetch and what bounds
should be applied to those columns in order to reduce the number of rows
returned. For the rest of this discussion, this user-written class will be
referred to as <span style="font-style: italic;">MyVTIClass</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Publish</span> - You must publish the table function by creating a public
static method which returns a <span style="font-style: italic;">MyVTIClass</span>. This is important. The
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> compiler must be able
to see that the table function returns an object which implements both
<span style="font-style: italic;">java.sql.ResultSet</span> and <span style="font-style: italic;">org.apache.derby.vti.RestrictedVTI</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Declare</span> - You declare the table function to
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> using the same CREATE
FUNCTION syntax you are already familiar with. This syntax does not change.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Invoke</span> - You then use the table function in a query. When
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> compiles the query, it
sees that the return type of the table function implements
<span style="font-style: italic;">org.apache.derby.vti.RestrictedVTI</span>. Armed with this information, at
runtime <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls the
<span style="font-style: italic;">initScan()</span> method once before calling any of the <span style="font-style: italic;">ResultSet</span> methods.
</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, you would declare the function as follows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
public class MyVTIClass implements ResultSet, RestrictedVTI
{
    ...

    public void initScan(java.lang.String[] columnNames, 
        org.apache.derby.vti.Restriction restriction ) 
        throws SQLException {
         ... 
    }
}
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Then you publish the table function method:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
public static MyVTIClass foreignDatabaseEmployeeTable() 
    throws SQLException {
    ... 
}
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Then you declare the table function to
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
create function foreignDatabaseEmployeeTable()
returns table
(
    id int,
    birthday date,
    taxPayerID varchar( 50 ),
    firstName varchar( 50 ),
    lastName varchar( 50 )
)
language java
parameter style DERBY_JDBC_RESULT_SET
no sql
external name 'com.acme.portal.ForeignQueries.foreignDatabaseEmployeeTable'
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Finally, you invoke the table function in a query:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
select id, firstName, lastName
from table( foreignDatabaseEmployeeTable() ) s
where lastName = 'Stone'
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you invoke this query,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Prepare</span> - When
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> prepares the query,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> sees that the
<span style="font-style: italic;">foreignDatabaseEmployeeTable()</span> method returns an object which implements
<span style="font-style: italic;">org.apache.derby.vti.RestrictedVTI</span>. This is all that
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> needs to know in order
to compile a plan which takes advantage of this feature.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Execute</span> - When
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> executes the query,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls
<span style="font-style: italic;">initScan()</span>. In this example,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls
<span style="font-style: italic;">initScan()</span> with the following arguments:
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
initScan( new String[] { "ID", null, null, "FIRSTNAME", "LASTNAME" }, 
    new Restriction.ColumnQualifier(
        "LASTNAME", ORDER_OP_EQUALS, "Stone" ) )
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This, in turn, causes the following to happen:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Width</span> - The call to <span style="font-style: italic;">initScan()</span> told the table function what
   columns should be fetched.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Length</span> - The call to <span style="font-style: italic;">initScan()</span> told the table function how
   to filter the rows it returns.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Loop</span> - <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> then
   calls <span style="font-style: italic;">MyVTIClass.next()</span> and retrieves rows until
   <span style="font-style: italic;">MyVTIClass.next()</span> returns false. For each row,
   <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls:
     <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">MyVTIClass.getInt( 1 )</span> to get the <span style="font-style: italic;">id</span> column.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">MyVTIClass.getString( 4 )</span> to get the <span style="font-style: italic;">firstName</span>
      column.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">MyVTIClass.getString( 5 )</span> to get the <span style="font-style: italic;">lastName</span>
      column.</div></td></tr></table></div></div></td></tr></table></div></div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N15ECE"></a><span></span><div style="font-weight: bold;">Contract</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> calls
<span style="font-style: italic;">initScan()</span> before calling any other method on the <span style="font-style: italic;">ResultSet</span>. The
call to <span style="font-style: italic;">initScan()</span> merely passes hints, which the restricted table
function can exploit in order to perform better.
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> enforces the
restriction outside the table function. Therefore, a restricted table function
can still fetch extra columns and can ignore part or all of the restriction set
by the call to <span style="font-style: italic;">initScan()</span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N15EFF"></a><span></span><div style="font-weight: bold;">Affected Operations</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Compared to ordinary table functions, a restricted table function can perform
better in queries involving the following comparisons of its columns to
constants:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
&lt;
&lt;=
=
&gt;
&gt;=
IS NULL
IS NOT NULL
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, performance gains can be realized for queries involving the
following operators on the columns of the restricted table function:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
LIKE
BETWEEN
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, this feature does not boost performance either for the IN operator,
or in situations where <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
transforms OR lists into IN lists. See "Or transformations" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span> for more information.</div></div></div></div><div><a name="N15F50"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevspecialtfoptimizer"></a><div></div>Optimizer support for
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This topic explains how to fine-tune the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> optimizer's decision
about where to place a table function in the join order.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
By default, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
optimizer makes the following assumptions about a table function:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Expensive</span> - It is expensive to create and loop through the
        rows of the table function. This makes it likely that the optimizer will
      place the table function in an outer slot of the join
        order so that it will not be looped through often.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Repeatable</span> - The table function can be instantiated
        multiple times with the same results. This is probably true
        for most table functions. However, some
table functions may open read-once streams. If the optimizer knows that a
        table function is repeatable, then the optimizer can place
        the table function in an inner slot where the function can be
        invoked multiple times. If a table function is not
        repeatable, then the optimizer must either place it in the
        outermost slot or invoke the function once and store its contents in
        a temporary table.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
The user can override this optimizer behavior by giving the optimizer
      more information. Here's how to do this:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">No-arg constructor</span> - The table function's class
        must have a public constructor whose signature has no arguments.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">VTICosting</span> - The class must also implement
<span style="font-style: italic;">org.apache.derby.vti.VTICosting</span>. This involves
implementing the following methods as described in
<span style="color: blue;"><a href="#cdevspecialtfopttune">Measuring the cost of Derby-style table functions</a></span>
and
<span style="color: blue;"><a href="#cdevspecialtfoptexample">Example VTICosting implementation</a></span>:
  <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">getEstimatedCostPerInstantiation()</span> - This method estimates the
            cost of invoking the table function and looping
            through its rows. The returned value adds together
            two estimates:
    <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Empty table - This is the cost of invoking the
    table function, even if it contains 0 rows. See the description of variable <span style="font-weight: bold;">E</span>
    in <span style="color: blue;"><a href="#cdevspecialtfopttune">Measuring the cost of Derby-style table functions</a></span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Scanning - This is the cost of looping through all of the
    rows returned by the table function. See the calculation of <span style="font-weight: bold;">P*N</span>
    in <span style="color: blue;"><a href="#cdevspecialtfopttune">Measuring the cost of Derby-style table functions</a></span>.</div></td></tr></table></div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">getEstimatedRowCount()</span> - This guesses the number of rows
            returned by invoking the table function.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">supportsMultipleInstantiations()</span> - This returns false if
            the table function
returns different results when invoked more than once.
  </div></td></tr></table></div></div></td></tr></table></div></div><div><a name="N16067"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecialtfopttune"></a><div></div>Measuring the cost of
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
functions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This topic shows how to measure the cost of a
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style table
function.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
The following formula describes how to estimate the value returned
by  <span style="font-style: italic;">VTICosting.getEstimatedCostPerInstantiation()</span>:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-weight: bold;">
C = I * A
</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">where</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">C</span> = The estimated <span style="font-weight: bold;">C</span>ost for creating and running the
        table function. That is, the value returned by
<span style="font-style: italic;">VTICosting.getEstimatedCostPerInstantiation()</span>.
        In general, <span style="font-weight: bold;">C</span>ost is a measure of time in milliseconds.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">I</span> = The  optimizer's <span style="font-weight: bold;">I</span>mprecision. A measure of how skewed the optimizer's estimates tend
        to be in your particular environment. See below for instructions on how to estimate this <span style="font-weight: bold;">I</span>mprecision.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">A</span> = The <span style="font-weight: bold;">A</span>ctual time in milliseconds which it takes
        to create and run this table function.</div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16100"></a><span></span><div style="font-weight: bold;">Calculating the optimizer's imprecision</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
We treat optimizer <span style="font-weight: bold;">I</span>mprecision as a constant across the
        runtime environment. The following formula describes it:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-weight: bold;">
I = O / T
</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">where</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">O</span> = The <span style="font-weight: bold;">O</span>ptimizer's estimated cost for a plan.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">T</span> = The <span style="font-weight: bold;">T</span>otal runtime in milliseconds for the plan.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
To estimate these values, turn on
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> statistics collection
and run the following experiment several times, averaging the results:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Select</span> = Select all of the rows from a big table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Record</span> = In the statistics output, look for the ResultSet
          which represents the table scan. That scan has a field
          labelled "optimizer estimated cost". That's <span style="font-weight: bold;">O</span>. Now
          look for the fields in that ResultSet's statistics labelled
"constructor time", "open time", "next time", and "close time". Add up
          all of those fields. That total is <span style="font-weight: bold;">T</span>.
</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
For example:
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
MAXIMUMDISPLAYWIDTH 7000;

CALL SYSCS_UTIL.SYSCS_SET_RUNTIMESTATISTICS(1);
CALL SYSCS_UTIL.SYSCS_SET_STATISTICS_TIMING(1);

select * from T;

values SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTICS();
</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16180"></a><span></span><div style="font-weight: bold;">Calculating the actual runtime cost of a table function</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
The following formula explains how to compute the <span style="font-weight: bold;">A</span>ctual
        runtime cost for the table function:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-weight: bold;">
A =  ( P * N ) + E
</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">where</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">P</span> = The runtime spent <span style="font-weight: bold;">P</span>er row (in milliseconds).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">N</span> = The <span style="font-weight: bold;">N</span>umber of rows in the table function.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">E</span> = The time spent creating an <span style="font-weight: bold;">E</span>mpty instance of the
          table function which has no rows in it. Usually, <span style="font-weight: bold;">P * N</span> dwarfs
          <span style="font-weight: bold;">E</span>. That is, the table function instantiation cost is very
          small compared to the actual cost of looping through the
          rows. However, for some table functions, <span style="font-weight: bold;">E</span> may be significant
          and may dominate the table function's cost when <span style="font-weight: bold;">N</span> is small.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
You may know that <span style="font-weight: bold;">E</span> is basically 0. If so, you can skip this step.
Otherwise, to estimate <span style="font-weight: bold;">E</span>, turn on
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> statistics collection
and run the following experiment several times, averaging the results:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Short-circuit</span> = Short-circuit the next() method of the
<span style="font-style: italic;">ResultSet</span>
returned by your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-style
table function so that it returns
          <span style="font-style: italic;">false</span> the first time it is called. This makes it
          appear that the
<span style="font-style: italic;">ResultSet</span>
has no rows.
</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Select</span> = Select all of the rows from the table function.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Record</span> = In the statistics output, look for the VTIResultSet
          which represents the table function scan. Add up
          the values of the fields in that VTIResultSet's statistics labelled
"constructor time", "open time", "next time", and "close time".
          That total is <span style="font-weight: bold;">E</span>.
</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
To estimate <span style="font-weight: bold;">P</span>, turn on
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> statistics collection
and run the following experiment several times, averaging the results:
</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Select</span> = Select all of the rows from the table function.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Record</span> = In the statistics output, look for the VTIResultSet
          which represents the table function scan. Add up
          the values of the fields in that VTIResultSet's statistics labelled
"constructor time", "open time", "next time", and "close
          time". Subtract <span style="font-weight: bold;">E</span> from the result. Now divide by the
          value of the field "Rows seen".
          The result is <span style="font-weight: bold;">P</span>.
</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1627A"></a><span></span><div style="font-weight: bold;">Computing the value returned by <span style="font-style: italic;">getEstimatedCostPerInstantiation()</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Putting all of this together, the following formula describes the
        value returned by your
table function's
<span style="font-style: italic;">VTICosting.getEstimatedCostPerInstantiation()</span>
method.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-weight: bold;">
C = O/T * [ ( P * N ) + E ]
</span></div></div></div></div><div><a name="N162B9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevspecialtfoptexample"></a><div></div>Example VTICosting implementation</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Once you have measured your table function's cost, you can write
the <span style="font-style: italic;">VTICosting</span> methods.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optimizer fine-tuning can be added to the <span style="font-style: italic;">EmployeeTable</span>
table function shown before in
<span style="color: blue;"><a href="#cdevspecialtfexample">Example Derby-style table function</a></span>:
</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
package com.acme.hrSchema;

import java.io.Serializable;
import java.sql.*;

import org.apache.derby.vti.VTICosting;
import org.apache.derby.vti.VTIEnvironment;

/**
 * Tuned table function.
 */
public class TunedEmployeeTable extends EmployeeTable 
    implements VTICosting
{
    public TunedEmployeeTable() {}

    public double getEstimatedRowCount( VTIEnvironment optimizerState ) 
        throws SQLException
    {
        return getRowCount( optimizerState );
    }

    public double getEstimatedCostPerInstantiation( 
        VTIEnvironment optimizerState ) throws SQLException
    {
        double I = 100.0;  // optimizer imprecision
        double P = 10.0;   // cost per row in milliseconds
        double E = 0.0;    // cost of instantiating the external 
                            //   ResultSet
        double N = getRowCount( optimizerState );

        return I * ( ( P * N ) + E );
    }
    
    public boolean supportsMultipleInstantiations( 
        VTIEnvironment optimizerState ) throws SQLException
    {
        return true;
    }

    //////////////////////////////////////////////////////////////////

    private double  getRowCount( VTIEnvironment optimizerState )
        throws SQLException
    {
        String ROW_COUNT_KEY = "rowCountKey";
        Double estimatedRowCount = (Double) getSharedState( 
            optimizerState, ROW_COUNT_KEY );
        
        if ( estimatedRowCount == null )
        {
            Connection        conn = getConnection();
            PreparedStatement ps = conn.prepareStatement( 
                "select count(*) from hrSchema.EmployeeTable" );
            ResultSet         rs = ps.executeQuery();

            rs.next();
            estimatedRowCount = new Double( rs.getDouble( 1 ) );
            
            setSharedState( optimizerState, ROW_COUNT_KEY, 
                estimatedRowCount );

            rs.close();
            ps.close();
            conn.close();
        }

        return estimatedRowCount.doubleValue();
    }

    private Serializable getSharedState( 
        VTIEnvironment optimizerState, String key )
    { 
        return (Serializable) optimizerState.getSharedState( key ); 
    }

    private void setSharedState( VTIEnvironment optimizerState, 
        String key, Serializable value )
    { 
        optimizerState.setSharedState( key, value ); 
    }
}
</div></pre></div></div></div></div><div><a name="N16319"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevspecialudt"></a><div></div>Programming user-defined types</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows
you to create user-defined types. A user-defined type is a serializable Java
class whose instances are stored in columns. The class must implement the
<span style="font-style: italic;">java.io.Serializable</span> interface, and it must be declared to
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> by means of a
CREATE TYPE statement.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16358"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The key to designing a good user-defined type is to remember that data
evolves over time, just like code. A good user-defined type has version
information built into it. This allows the user-defined data to upgrade itself
as the application changes. For this reason, it is a good idea for a
user-defined type to implement <span style="font-style: italic;">java.io.Externalizable</span> and not just
<span style="font-style: italic;">java.io.Serializable</span>. Although the SQL standard allows a Java class to
implement only <span style="font-style: italic;">java.io.Serializable</span>, this is bad practice for the
following reasons:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Recompilation</span> - If the second version of your application is
compiled on a different platform from the first version, then your serialized
objects may fail to deserialize. This problem and a possible workaround are
discussed in the "Version Control" section near the end of this
<span style="color: blue;"><a href="http://java.sun.com/developer/technicalArticles/Programming/serialization/">Serialization Primer</a></span> and in the last paragraph of the
header comment for <span style="font-style: italic;">java.io.Serializable</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-weight: bold;">Evolution</span> - Your tools for evolving a class which simply implements
<span style="font-style: italic;">java.io.Serializable</span> are very limited.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Fortunately, it is easy to write a version-aware UDT which implements
<span style="font-style: italic;">java.io.Serializable</span> and can evolve itself over time. For example, here
is the first version of such a class:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
package com.acme.types;

import java.io.*;
import java.math.*;

public class Price implements Externalizable
{
    // initial version id
    private static final int FIRST_VERSION = 0;

    public String currencyCode;
    public BigDecimal amount;

    // zero-arg constructor needed by Externalizable machinery
    public Price() {}

    public Price( String currencyCode, BigDecimal amount )
    {
        this.currencyCode = currencyCode;
        this.amount = amount;
    }

    // Externalizable implementation
    public void writeExternal(ObjectOutput out) throws IOException
    {
        // first write the version id
        out.writeInt( FIRST_VERSION );

        // now write the state
        out.writeObject( currencyCode );
        out.writeObject( amount );
    }
    
    public void readExternal(ObjectInput in) 
        throws IOException, ClassNotFoundException
    {
        // read the version id
        int oldVersion = in.readInt();
        if ( oldVersion &lt; FIRST_VERSION ) { 
            throw new IOException( "Corrupt data stream." ); 
        }
        if ( oldVersion &gt; FIRST_VERSION ) { 
            throw new IOException( "Can't deserialize from the future." );
        }

        currencyCode = (String) in.readObject();
        amount = (BigDecimal) in.readObject();
    }
}</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">After this, it is easy to write a second version of the user-defined type
which adds a new field. When old versions of <span style="font-family: Courier;">Price</span> values are
read from the database, they upgrade themselves on the fly. Changes are shown
in <span style="font-weight: bold;">bold</span>:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
package com.acme.types;

import java.io.*;
import java.math.*;
<span style="font-weight: bold;">import java.sql.*;</span>

public class Price implements Externalizable
{
    // initial version id
    private static final int FIRST_VERSION = 0;
    <span style="font-weight: bold;">private static final int TIMESTAMPED_VERSION = FIRST_VERSION + 1;</span>

    <span style="font-weight: bold;">private static final Timestamp DEFAULT_TIMESTAMP = new Timestamp( 0L );</span>

    public String currencyCode;
    public BigDecimal amount;
    <span style="font-weight: bold;">public Timestamp timeInstant;</span>

    // 0-arg constructor needed by Externalizable machinery
    public Price() {}

    public Price( String currencyCode, BigDecimal amount<span style="font-weight: bold;">, 
                  Timestamp timeInstant</span> )
    {
        this.currencyCode = currencyCode;
        this.amount = amount;
        <span style="font-weight: bold;">this.timeInstant = timeInstant;</span>
    }

    // Externalizable implementation
    public void writeExternal(ObjectOutput out) throws IOException
    {
        // first write the version id
        out.writeInt( <span style="font-weight: bold;">TIMESTAMPED_VERSION</span> );

        // now write the state
        out.writeObject( currencyCode );
        out.writeObject( amount );
        <span style="font-weight: bold;">out.writeObject( timeInstant );</span>
    }
      
    public void readExternal(ObjectInput in) 
        throws IOException, ClassNotFoundException
    {
        // read the version id
        int oldVersion = in.readInt();
        if ( oldVersion &lt; FIRST_VERSION ) { 
            throw new IOException( "Corrupt data stream." ); 
        }
        if ( oldVersion &gt; <span style="font-weight: bold;">TIMESTAMPED_VERSION</span> ) {
            throw new IOException( "Can't deserialize from the future." ); 
        }

        currencyCode = (String) in.readObject();
        amount = (BigDecimal) in.readObject();

        <span style="font-weight: bold;">if ( oldVersion &gt;= TIMESTAMPED_VERSION ) {
            timeInstant = (Timestamp) in.readObject(); 
        }
        else { 
            timeInstant = DEFAULT_TIMESTAMP;</span> 
        }
    }
}</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An application needs to keep its code in sync across all tiers. This is true
for all Java code which runs both in the client and in the server. This is true
for functions and procedures which run in multiple tiers. It is also true for
user-defined types which run in multiple tiers. The programmer should code
defensively for the case when the client and server are running different
versions of the application code. In particular, the programmer should write
defensive serialization logic for user-defined types so that the application
gracefully handles client/server version mismatches.</div></div></div></div></div><div><a name="N16426"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevconcepts19524"></a><div></div>Controlling Derby application behavior</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section looks at some advanced <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application
concepts.</div></div><div><a name="N164A9"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts38375"></a><div></div>The JDBC connection and transaction model</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Session and transaction capabilities for SQL are handled through
JDBC routines, not by SQL commands.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">JDBC defines a system session and transaction model for database access.
A <span style="font-style: italic;">session</span> is the duration of one connection to the database and is
handled by a JDBC <span style="font-style: italic;">Connection</span> object.</div></div><div><a name="N1656B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts36881"></a><div></div>Connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="font-style: italic;">Connection</span> object represents a connection with a database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Within the scope of one <span style="font-style: italic;">Connection</span>, you access
only a single <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.
(Database-side JDBC routines can allow you to access more than one database
in some circumstances.) A single application might allow one or more <span style="font-style: italic;">Connections</span> to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, either to a single database
or to many different databases, provided that all the databases are within
the same system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With DriverManager, you use the connection URL as an argument to get the <span style="font-style: italic;">getConnection</span> method
to specify which database to connect to and other details.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following example shows an application establishing three separate
connections to two different databases in the current system.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:sample");
System.out.println("Connected to database sample");
conn.setAutoCommit(false);
Connection conn2 = DriverManager.getConnection(
    "jdbc:derby:newDB;create=true");
System.out.println("Created AND connected to newDB");
conn2.setAutoCommit(false);
Connection conn3 = DriverManager.getConnection(
    "jdbc:derby:newDB");
System.out.println("Got second connection to newDB");
conn3.setAutoCommit(false);</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A <span style="font-style: italic;">Connection</span> object has no association with any specific thread;
during its lifetime, any number of threads might have access to it, as controlled
by the application.</div></div><div><a name="N16655"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts838179"></a><div></div>Statements</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To execute SQL statements against a database, an application uses <span style="font-style: italic;">Statements</span> (<span style="font-family: Courier;"><span style="font-style: italic;">java.sql.Statement</span></span>)
and <span style="font-style: italic;">PreparedStatements</span> (<span style="font-family: Courier;"><span style="font-style: italic;">java.sql.PreparedStatement</span></span>),
or <span style="font-style: italic;">CallableStatements</span> (<span style="font-family: Courier;"><span style="font-style: italic;">java.sql.CallableStatement</span></span>)
for stored procedures.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Because <span style="font-style: italic;">PreparedStatement</span> extends <span style="font-style: italic;">Statement</span> and <span style="font-style: italic;">CallableStatement</span> extends<span style="font-style: italic;"> PreparedStatement</span>,
this section refers to both as <span style="font-style: italic;">Statements</span>. <span style="font-style: italic;">Statements</span> are obtained
from and are associated with a particular <span style="font-style: italic;">Connection</span>.</div></div></div><div><a name="N16713"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts838315"></a><div></div>ResultSets and Cursors</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Executing a <span style="font-style: italic;">Statement</span> that returns values gives a <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> (<span style="font-family: Courier;"><span style="font-style: italic;">java.sql.ResultSet</span></span>),
allowing the application to obtain the results of the statement. Only one <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> can
be open for a particular <span style="font-family: Courier;"><span style="font-style: italic;">Statement</span></span> at any time, as
per the JDBC specification.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Thus, executing a <span style="font-style: italic;">Statement</span> automatically closes any open <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> generated
by an earlier execution of that <span style="font-family: Courier;"><span style="font-style: italic;">Statement</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For this reason, you must use a different <span style="font-style: italic;">Statement</span> to update a
cursor (a named <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span>) from the one used to generate
the cursor. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The names of open cursors must be unique within a <span style="font-style: italic;">Connection</span>.</div></div></div><div><a name="N167F0"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts26633"></a><div></div>Nested connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">SQL statements can include routine invocations. If these routines
interact with the database, they must use a <span style="font-style: italic;">Connection</span>.</div></div></div></div><div><a name="N1686A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts19173"></a><div></div>Transactions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A <span style="font-style: italic;">transaction</span> is a set of one or more SQL statements that
make up a logical unit of work that you can either commit or roll back and
that will be recovered in the event of a system failure.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">All the statements in the transaction are <span style="font-style: italic;">atomic</span>. A transaction
is associated with a single <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> object (and
database). A transaction cannot span <span style="font-style: italic;">Connections</span> (or databases).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> permits schema
and data manipulation statements (DML) to be intermixed within a single transaction.
If you create a table in one transaction, you can also insert into it in that
same transaction. A schema manipulation statement (DDL) is not automatically
committed when it is performed, but participates in the transaction within
which it is issued. Because DDL requires exclusive locks on system tables,
keep transactions that involve DDL short.</div></div><div><a name="N1694A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts838850"></a><div></div>Transactions when auto-commit is disabled</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When auto-commit is disabled, you use a <span style="font-style: italic;">Connection</span> object's <span style="font-family: Courier;"><span style="font-style: italic;">commit</span></span> and <span style="font-family: Courier;"><span style="font-style: italic;">rollback</span></span> methods
to commit or roll back a transaction.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;"><span style="font-style: italic;">commit</span></span> method makes permanent the changes resulting
from the transaction and releases locks. The <span style="font-family: Courier;"><span style="font-style: italic;">rollback</span></span> method
undoes all the changes resulting from the transaction and releases locks.
A transaction encompasses all the SQL statements executed against a single <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> object
since the last <span style="font-family: Courier;"><span style="font-style: italic;">commit</span></span> or <span style="font-family: Courier;"><span style="font-style: italic;">rollback</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You do not need to explicitly begin a transaction. You implicitly end one
transaction and begin a new one after disabling auto-commit, changing the
isolation level, or after calling <span style="font-family: Courier;"><span style="font-style: italic;">commit</span></span> or <span style="font-family: Courier;"><span style="font-style: italic;">rollback</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Committing a transaction also closes all <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> objects
excluding the <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> objects associated with cursors
with holdability <span style="font-family: Courier;">true</span>. The default holdability of the cursors
is <span style="font-family: Courier;">true</span> and <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> objects associated
with them need to be closed explicitly. A commit will not close such <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> objects.
It also releases any database locks currently held by the <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span>,
whether or not these objects were created in different threads.</div></div></div><div><a name="N16A8A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts29416"></a><div></div>Using auto-commit</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A new connection to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is in auto-commit mode by default, as specified by the JDBC standard.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Auto-commit mode means that when a statement is completed, the method <span style="font-style: italic;">commit</span> is
called on that statement automatically. Auto-commit in effect makes every
SQL statement a transaction. The commit occurs when the statement completes
or the next statement is executed, whichever comes first. In the case of a
statement returning a forward only <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span>, the statement completes
when the last row of the <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> has been retrieved
or the <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> has been closed explicitly. In the case
of a statement returning a scrollable <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span>, the
statement completes only when the <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> has been
closed explicitly.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some applications might prefer to work with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
auto-commit mode; some might prefer to work with auto-commit turned off. You
should be aware of the implications of using either model.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You should be aware of the following when you use auto-commit:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Cursors</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot use auto-commit if you do any positioned
updates or deletes (that is, an update or delete statement with a WHERE CURRENT
OF clause) on cursors which have the
<span style="font-family: Courier;"><span style="font-style: italic;">ResultSet.CLOSE_CURSORS_AT_COMMIT</span></span> holdability value
set.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Auto-commit automatically closes cursors that are
explicitly opened with the
<span style="font-family: Courier;"><span style="font-style: italic;">ResultSet.CLOSE_CURSORS_AT_COMMIT</span></span> value, when you do any
in-place updates or deletes.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An updatable cursor declared to be held
across commit (this is the default value) can execute updates and issue multiple
commits before closing the cursor. After an explicit or implicit commit, a
holdable forward-only cursor must be repositioned with a call to the
<span style="font-family: Courier;"><span style="font-style: italic;">next</span></span> method before it can accessed again. In this state,
the only other valid operation besides calling <span style="font-family: Courier;"><span style="font-style: italic;">next</span></span> is
calling <span style="font-family: Courier;"><span style="font-style: italic;">close</span></span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Database-side JDBC routines (routines using nested connections)</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You cannot execute functions within SQL statements if those functions
perform a commit or rollback on the current connection. Since in auto-commit
mode all SQL statements are implicitly committed, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> turns
off auto-commit during execution of database-side routines and turns it
back on when the statement completes.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Routines that use nested connections
are not permitted to turn auto-commit on or off.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Table-level locking and the SERIALIZABLE isolation level</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When
an application uses table-level locking and the SERIALIZABLE isolation level,
all statements that access tables hold at least shared table locks. Shared
locks prevent other transactions that update data from accessing the table.
A transaction holds a lock on a table until the transaction commits. <span style="font-style: italic;">So
even a SELECT statement holds a shared lock on a table until its connection
commits and a new transaction begins. </span></div><div><div style="font-weight: bold;"><span style="color: red;">Table 4. </span>Summary
of Application Behavior with Auto-Commit On or Off</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Topic</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Auto-Commit On</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Auto-Commit Off</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Transactions</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Each statement is a separate transaction.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Commit() or rollback() completes a transaction.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Database-side JDBC routines (routines that use nested connections)</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Auto-commit is turned off.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works (no explicit commits or rollbacks are allowed).</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Updatable cursors</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works for holdable cursors; does not work for non-holdable cursors.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Multiple connections accessing the same data</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works. Lower concurrency when applications use SERIALIZABLE
isolation mode and table-level locking.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Updatable ResultSets</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Savepoints</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Does not work.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Works.</div></td></tr></tbody></table></div></div></td></tr></table></div></div></div><div><a name="N16CBC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevconcepts839040"></a><div></div>Turning off auto-commit</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can disable auto-commit with the <span style="font-style: italic;">Connection</span> class's <span style="font-style: italic;">setAutoCommit</span> method.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16CF6"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">conn.setAutoCommit(false);</div></pre></div></div></div><div><a name="N16D6A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts839085"></a><div></div>Explicitly closing Statements, ResultSets, and Connections</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You should explicitly close <span style="font-style: italic;">Statements</span>, <span style="font-family: Courier;"><span style="font-style: italic;">ResultSets,</span></span> and <span style="font-family: Courier;"><span style="font-style: italic;">Connections</span></span> when
you no longer need them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Connections to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> are
resources external to an application, and the garbage collector will not close
them automatically. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, close a <span style="font-style: italic;">Statement</span> object using its <span style="font-family: Courier;"><span style="font-style: italic;">close</span></span> method;
close a <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> object using its <span style="font-family: Courier;"><span style="font-style: italic;">close</span></span> method.
If auto-commit is disabled, active transactions need to be explicitly committed
or rolled back before closing the connection</div></div></div><div><a name="N16E45"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts14433"></a><div></div>Statement versus transaction runtime rollback</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When an SQL statement generates an exception, this exception results
in a <span style="font-style: italic;">runtime rollback</span>. A runtime rollback is a system-generated rollback
of a statement or transaction by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
as opposed to an explicit <span style="font-family: Courier;"><span style="font-style: italic;">rollback</span></span> call from your
application.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Extremely severe exceptions, such as disk-full errors, shut down the system,
and the transaction is rolled back when the database is next booted. Severe
exceptions, such as deadlock, cause transaction rollback; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> rolls
back all changes since the beginning of the transaction and implicitly begins
a new transaction. Less severe exceptions, such as syntax errors, result in
statement rollback; <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> rolls
back only changes made by the statement that caused the error. The application
developer can insert code to explicitly roll back the entire transaction if
desired.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports partial
rollback through the use of savepoints. See 
<span style="color: blue;"><a href="#cdevconceptssavepoints">Using savepoints</a></span> for more
information.</div></div></div><div><a name="N16F14"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconceptssavepoints"></a><div></div>Using savepoints</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The <span style="font-style: italic;">Savepoint</span> interface contains
methods to set, release, or roll back a transaction to designated savepoints.
Once a savepoint has been set, the transaction can be rolled back to that
savepoint without affecting preceding work. Savepoints provide finer-grained
control of transactions by marking intermediate points within a transaction.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16F52"></a><span></span><div style="font-weight: bold;">Setting and rolling back to a savepoint</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">Connection.setSavepoint</span> method sets a savepoint within the current
transaction. The <span style="font-style: italic;">Connection.rollback</span> method is overloaded to take a
savepoint argument.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The code example below inserts a row into a table, sets the savepoint
<span style="font-family: Courier;">svpt1</span>, and then inserts a second row. When the transaction is
later rolled back to <span style="font-family: Courier;">svpt1</span>, the second insertion is undone, but
the first insertion remains intact. In other words, when the transaction is
committed, only the row containing '1' will be added to TABLE1.
<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">conn.setAutoCommit(false); // Autocommit must be off to use savepoints.
Statement stmt = conn.createStatement();
int rows = stmt.executeUpdate("INSERT INTO TABLE1 (COL1) VALUES(1)");
// set savepoint
Savepoint svpt1 = conn.setSavepoint("S1");
rows = stmt.executeUpdate("INSERT INTO TABLE1 (COL1) VALUES (2)");
...
conn.rollback(svpt1);
...
conn.commit();</span></div></pre></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16F88"></a><span></span><div style="font-weight: bold;">Releasing a savepoint </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The method <span style="font-style: italic;">Connection.releaseSavepoint</span> takes a <span style="font-style: italic;">Savepoint</span> object
as a parameter and removes it from the current transaction. Once a savepoint
has been released, attempting to reference it in a rollback operation will
cause an <span style="font-style: italic;">SQLException</span> to be thrown.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Any savepoints that have been created in a transaction are automatically
released and become invalid when the transaction is committed or when the
entire transaction is rolled back.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Rolling a transaction back to a savepoint automatically releases and makes
invalid any other savepoints created after the savepoint in question.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N16FB2"></a><span></span><div style="font-weight: bold;">Rules for savepoints</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The savepoint cannot be set within a batch of statements to enable partial
recovery. If a savepoint is set any time before the method <span style="font-style: italic;">executeBatch</span>
is called, it is set before any of the statements that have been added to the
batch are executed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A savepoint can be reused after it has been released explicitly (by issuing a
release of the savepoint) or implicitly (by issuing a connection
commit/rollback to that savepoint or to a savepoint declared earlier than that
savepoint).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is possible to nest savepoints, but only in an embedded environment.</div></div></div></div></div></div><div><a name="N17042"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts41275"></a><div></div>Result set and cursor mechanisms</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
A result set maintains a cursor, which points to its current row of
data. It can be used to step through and process the rows one by one.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
In <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, any
SELECT statement generates a cursor which can be controlled by a
<span style="font-family: Courier;"><span style="font-style: italic;">java.sql.ResultSet</span></span> object. 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not
support SQL-92's DECLARE CURSOR language construct to create cursors,
however <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
supports positioned deletes and positioned updates of updatable
cursors.
</div></div><div><a name="N1716B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevconcepts88082"></a><div></div>Simple non-updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example is an excerpt from a sample JDBC application that
generates a result set with a simple SELECT statement and then processes
the rows.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1717D"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:sample");
Statement s = conn.createStatement();
s.execute("set schema 'SAMP'");
<span style="font-weight: bold;">//note that autocommit is on--it is on by default in JDBC</span>
ResultSet rs = s.executeQuery(
    "SELECT empno, firstnme, lastname, salary, bonus, comm "
				 + "FROM samp.employee");
<span style="font-weight: bold;">/** a standard JDBC ResultSet. It maintains a 
  *  cursor that points to the current row of data. The cursor 
  *  moves down one row each time the method next() is called.
  *  You can scroll one way only--forward--with the next()
  *  method. When auto-commit is on, after you reach the 
  *  last row the statement is considered completed
  *  and the transaction is committed.
  */</span>
System.out.println( "last name" + "," + "first name" + ": earnings");
<span style="font-weight: bold;">/* here we are scrolling through the result set 
with the next() method.*/</span>
while (rs.next()) {
<span style="font-weight: bold;">    // processing the rows</span>
    String firstnme = rs.getString("FIRSTNME");
    String lastName = rs.getString("LASTNAME");
    BigDecimal salary = rs.getBigDecimal("SALARY");
    BigDecimal bonus = rs.getBigDecimal("BONUS");
    BigDecimal comm = rs.getBigDecimal("COMM"); 
    System.out.println( lastName + ", " + firstnme + ": " 
                       + (salary.add(bonus.add(comm))));
}
rs.close();
<span style="font-weight: bold;">// once we've iterated through the last row,
// the transaction commits automatically and releases
//shared locks</span>
s.close();</div></pre></div></div></div><div><a name="N171FA"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts28351"></a><div></div>Updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
Updatable result sets in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can be updated by
using result set update methods
(<span style="font-family: Courier;">updateRow()</span>,<span style="font-family: Courier;">deleteRow()</span> and
<span style="font-family: Courier;">insertRow()</span>), or by using positioned update or delete
queries.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17224"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> Both scrollable and non-scrollable result sets can be updatable in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. 
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> If the query which was executed to create the result set is not updatable, 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will downgrade
the concurrency mode to <span style="font-family: Courier;">ResultSet.CONCUR_READ_ONLY</span>,
and add a warning about this on the <span style="font-family: Courier;">ResultSet</span>. The
compilation of the query fails if the result set cannot be updatable,
and contains a <span style="font-family: Courier;">FOR UPDATE</span> clause. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Positioned updates and deletes can be performed if the query 
contains <span style="font-family: Courier;">FOR UPDATE</span> or if the concurrency mode for
the result set is <span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use the result set update methods, the concurrency mode for the
result set must be <span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span>. 
The query does not need to contain <span style="font-family: Courier;">FOR UPDATE</span> to
use these methods. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Updatable cursors lock the current row with an update lock when
positioned on the row, regardless of isolation level. Therefore, to
avoid excessive locking of rows, only use concurrency mode
<span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span> or the <span style="font-family: Courier;">FOR
UPDATE</span> clause when you actually need to update the rows.
For more information about locking, see 
<span style="color: blue;"><a href="#cdevconcepts36402">Types and scope of locks in Derby
systems.</a></span></div></div></div><div><a name="N17335"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts30811"></a><div></div>Requirements for updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Only specific SELECT statements- simple accesses of a single table-allow
you to update or delete rows as you step through them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see "SELECT statement" and "FOR UPDATE clause" in
the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div><div><a name="N173B2"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconceptsfor"></a><div></div>Forward only updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A forward only updatable result set maintains a cursor
which can only move in one direction (forward), and also update rows.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N173C4"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To create a forward only updatable result set, the
statement has to be created with concurrency mode
<span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span> and type
<span style="font-family: Courier;">ResultSet.TYPE_FORWARD_ONLY</span>. 
<div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>   The default type is
<span style="font-family: Courier;">ResultSet.TYPE_FORWARD_ONLY</span>.</div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example of using <span style="font-family: Courier;">ResultSet.updateXXX() +
ResultSet.updateRow()</span> to update a row: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
  Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  while (uprs.next()) {
      int newBonus = uprs.getInt("BONUS") + 100;
      uprs.updateInt("BONUS", newBonus);
      uprs.updateRow();
  }
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example of using <span style="font-family: Courier;">ResultSet.deleteRow()</span> to delete a row: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
  Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  while (uprs.next()) {
      if (uprs.getInt("WORKDEPT")==300) {
         uprs.deleteRow();
      }
  }
</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17406"></a><span></span><div style="font-weight: bold;">Visibility of changes </div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>After an update or delete is made on a forward only result set,
the result set's cursor is no longer on the row just updated or
deleted, but immediately before the next row in the result set (it is
necessary to move to the next row before any further row operations
are allowed). This means that changes made by
<span style="font-family: Courier;">ResultSet.updateRow()</span> and
<span style="font-family: Courier;">ResultSet.deleteRow()</span> are never visible.  
</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If a row has been inserted, i.e using
<span style="font-family: Courier;">ResultSet.insertRow()</span> it may be visible in a forward
only result set.</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1742F"></a><span></span><div style="font-weight: bold;">Conflicting operations</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> The current row of the result set cannot be changed by other
transactions, since it will be locked with an update lock. 
Result sets held open after a commit have to move to the next row
before allowing any operations on it. </div>

Some conflicts may prevent the result set from doing updates/deletes:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the current row is deleted by a statement in the same transaction, calls to
<span style="font-family: Courier;">ResultSet.updateRow()</span> will cause an exception, since
the cursor is no longer positioned on a valid row. </div></td></tr></table></div></div></div></div><div><a name="N1746A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconceptssur"></a><div></div>Scrollable updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A scrollable updatable result set maintains a cursor which
can both scroll and update rows.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1747C"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> only supports
<span style="color: blue;"><a href="#cdevconcepts22641">scrollable insensitive result sets.</a></span>
To create a scrollable insensitive result set which is updatable, the
statement has to be created with concurrency mode
<span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span> and type
<span style="font-family: Courier;">ResultSet.TYPE_SCROLL_INSENSITIVE</span>. 
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example of using result set update methods to update a row: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
  Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  uprs.absolute(5); // update the fifth row
  int newBonus = uprs.getInt("BONUS") + 100;
  uprs.updateInt("BONUS", newBonus);
  uprs.updateRow();
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example of using <span style="font-family: Courier;">ResultSet.deleteRow()</span> to delete a row: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
  Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");
  
  uprs.last();
  uprs.relative(-5); // moves to the 5th from the last row
  uprs.deleteRow(); 
</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N174B9"></a><span></span><div style="font-weight: bold;">Visibility of changes </div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Changes caused by other statements, triggers and other
transactions (others) are considered as other changes, and are not visible in
scrollable insensitive result sets. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Own updates and deletes are visible in Derby's scrollable
insensitive result sets. <div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> handles changes
made using positioned updates and deletes as own changes, so when made
via a result set's cursor such changes are also visible in that result
set.
</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Rows inserted to the table may become visible in the result set.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">ResultSet.rowDeleted()</span> returns true if the row
has been deleted using the cursor or result set.  It does not detect
deletes made by other statements or transactions.  Note that the
method will also work for result sets with concurrency
CONCUR_READ_ONLY if the underlying result set is FOR UPDATE and a
cursor was used to delete the row.
</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">ResultSet.rowUpdated()</span> returns true if the row
has been updated using the cursor or result set. It does not detect
updates made by other statements or transactions.  Note that the
method will also work for result sets with concurrency
CONCUR_READ_ONLY if the underlying result set is FOR UPDATE and a
cursor was used to update the row.
</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Both <span style="font-family: Courier;">ResultSet.rowUpdated()</span> and
<span style="font-family: Courier;">ResultSet.rowDeleted()</span> return true if the row
first is updated and later deleted. </div></div></td></tr></table></div>

Please be aware that even if changes caused by others are not visible
in the result set, SQL operations, including positioned updates, 
which access the current row will read and use the row data as it is
in the database, not as it is reflected in the result set.

</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1750A"></a><span></span><div style="font-weight: bold;">Conflicting operations</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A conflict may occur in scrollable insensitive result sets if a row is
updated/deleted by another committed transaction, or if a row is
updated by another statement in the same transaction. The row which
the cursor is positioned on is locked, however once it moves 
to another row, the lock may be released depending on transaction
isolation level. This means that rows in the scrollable insensitive result
set may have been updated/deleted by other transactions after they
were fetched.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Since the result set is <span style="font-weight: bold;">insensitive</span>, it will not detect the
changes made by others.  When doing updates using the result set,
conflicting changes on the columns being changed will be overwritten. </div>

Some conflicts may prevent the result set from doing updates/deletes:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div> The row has been deleted after it was read into the result set: 
Scrollable insensitive result sets will give a warning with <span style="font-family: Courier;"><span style="font-style: italic;">SQLState</span> 01001 </span>. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div> The table has been compressed: Scrollable insensitive
result sets will give a warning with <span style="font-family: Courier;"><span style="font-style: italic;">SQLState</span>
01001</span>.  A compress conflict may happen if the cursor is held
over a commit. This is because the table intent lock is released on
commit, and not reclaimed until the cursor moves to another row.
</div></td></tr></table></div>

To avoid conflicts with other transactions, you may increase the
transaction isolation level to repeatable read or serializable.  This
will make the transaction hold locks on the rows which have been read
until it commits.

<div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  When you use holdable result sets, be aware that the locks will
be released on commit, and conflicts may occur regardless of isolation level.
You should probably avoid using holdable result sets if your
application relies on transactional behavior for the result set.
</div></div></div></div><div><a name="N1756B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconceptsinsertrow"></a><div></div>Inserting rows with updatable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
Updatable result set can be used to insert rows to the table, by
using <span style="font-family: Courier;">ResultSet.insertRow()</span>.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17583"></a><span></span>
When inserting a row, each column in the insert row that does not
allow null as a value and does not have a default value must be given
a value using the appropriate update method. 

If the inserted row satisfies the query predicate, it may become
visible in the result set.

<div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Example of using <span style="font-family: Courier;">ResultSet.insertRow()</span> to insert a
row: </div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
  Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT firstname, lastname, workdept, bonus " +
    "FROM employee");
  uprs.moveToInsertRow();
  uprs.updateString("FIRSTNAME", "Andreas");
  uprs.updateString("LASTNAME", "Korneliussen");
  uprs.updateInt("WORKDEPT", 123);
  uprs.insertRow();
  uprs.moveToCurrentRow();

</div></pre></div></div></div><div><a name="N175B6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevconcepts41704"></a><div></div>Naming or accessing the name of a cursor</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">There is no SQL language command to <span style="font-style: italic;">assign</span> a name to a cursor.
You can use the JDBC <span style="font-family: Courier;"><span style="font-style: italic;">setCursorName</span></span> method to assign
a name to a <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> that allows positioned updates
and deletes.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N175FE"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You assign a name to a <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> with
the <span style="font-family: Courier;"><span style="font-style: italic;">setCursorName</span></span> method of the <span style="font-family: Courier;"><span style="font-style: italic;">Statement</span></span> interface.
You assign the name to a cursor before executing the <span style="font-family: Courier;"><span style="font-style: italic;">Statement</span></span> that
will generate it.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Statement s3 = conn.createStatement();
// name the statement so we can reference the result set
// it generates
s3.setCursorName("UPDATABLESTATEMENT");
// we will be able to use the following statement later
// to access the current row of the cursor
// a result set needs to be obtained prior to using the
// WHERE CURRENT syntax
ResultSet rs = s3.executeQuery("select * from 
    FlightBookings FOR UPDATE of number_seats");
PreparedStatement ps2 = conn.prepareStatement(
    "UPDATE FlightBookings SET number_seats = ? " +
       "WHERE CURRENT OF UPDATABLESTATEMENT");</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, you
do not assign a name to the cursor, but let the system generate one for you
automatically. You can determine the system-generated cursor name of a <span style="font-style: italic;">ResultSet</span> generated
by a SELECT statement using the <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span> class's <span style="font-family: Courier;"><span style="font-style: italic;">getCursorName</span></span> method.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">PreparedStatement ps2 = conn.prepareStatement(
    "UPDATE employee SET bonus = ? WHERE CURRENT OF "+
        Updatable.getCursorName());</div></pre></div></div></div><div><a name="N1769A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconcepts38274"></a><div></div>Extended updatable result set example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N176A7"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
Connection conn = DriverManager.getConnection("jdbc:derby:sample");
conn.setAutoCommit(false);

<span style="font-weight: bold;">// Create the statement with concurrency mode CONCUR_UPDATABLE</span>
<span style="font-weight: bold;">// to allow result sets to be updatable</span>
Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                      ResultSet.CONCUR_UPDATABLE,
                                      ResultSet.CLOSE_CURSORS_AT_COMMIT);
<span style="font-weight: bold;">// Updatable statements have some requirements</span>
<span style="font-weight: bold;">// for example, select must be on a single table</span>
ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE FOR UPDATE of BONUS"); // Only bonus can be updated

String theDept="E21";

while (uprs.next()) {
    String firstnme = uprs.getString("FIRSTNME");
    String lastName = uprs.getString("LASTNAME");
    String workDept = uprs.getString("WORKDEPT");
    BigDecimal bonus = uprs.getBigDecimal("BONUS");
    if (workDept.equals(theDept)) {
      <span style="font-weight: bold;">  // if the current row meets our criteria,
        // update the updatable column in the row</span>
        uprs.updateBigDecimal("BONUS", bonus.add(BigDecimal.valueOf(250L)));
        uprs.updateRow();
        System.out.println("Updating bonus for employee:" +
                           firstnme + lastName);
    } 
}
conn.commit(); // commit the transaction
<span style="font-weight: bold;">// close object </span>
uprs.close();
stmt.close();
<span style="font-weight: bold;">// Close connection if the application does not need it any more</span>
conn.close();

</div></pre></div></div></div></div><div><a name="N1771A"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts23987"></a><div></div>Result sets and auto-commit</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Except for the result sets associated with holdable cursors, issuing
a commit will cause all result sets on your connection to be closed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The JDBC application is not required to have auto-commit off when
using update methods on updatable result set, even if the result set
is not holdable. Positioned updates and deletes cannot be used in
combination with autocommit and non-holdable result sets.
</div></div></div><div><a name="N177A0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts22641"></a><div></div>Scrollable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">JDBC provides two types of result sets that allow
you to scroll in either direction or to move the cursor to a
particular row. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports one of
these types: scrollable insensitive result sets
(<span style="font-family: Courier;">ResultSet.TYPE_SCROLL_INSENSITIVE</span>).
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N177E4"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you use a result set of type of type
<span style="font-family: Courier;">ResultSet.TYPE_SCROLL_INSENSITIVE</span>, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> materializes rows
from the first one in the result set up to the one with the biggest
row number as the rows are requested. The materialized rows will be
backed to disk if necessary, to avoid excessive memory usage. 
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Insensitive result sets, in contrast to sensitive result sets,
cannot see changes made by others on the rows which have been
materialized. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
allows updates of scrollable insensitive result sets; see <span style="color: blue;"><a href="#rdevconceptssur">Visibility of changes</a></span>,
which also explains visibility of own changes.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not
support result sets of type <span style="font-family: Courier;">ResultSet.TYPE_SCROLL_SENSITIVE</span>.
</div></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">//autocommit does not have to be off because even if 
//we accidentally scroll past the last row, the implicit commit
//on the the statement will not close the result set because result sets
//are held over commit by default</span>
conn.setAutoCommit(false);
Statement s4 = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
                                    ResultSet.CONCUR_READ_ONLY);
s4.execute("set schema 'SAMP'");
ResultSet scroller=s4.executeQuery(
    "SELECT sales_person, region, sales FROM sales " +
    "WHERE sales &gt; 8 ORDER BY sales DESC");
if (scroller.first()) { // One row is now materialized
    System.out.println("The sales rep who sold the highest number" +
                       " of sales is " +
                       scroller.getString("SALES_PERSON"));
} else {
    System.out.println("There are no rows.");
}
scroller.beforeFirst();
scroller.afterLast();   // By calling afterlast(), all rows will be materialized
scroller.absolute(3);
if (!scroller.isAfterLast()) {
    System.out.println("The employee with the third highest number " +
                       "of sales is " +
                       scroller.getString("SALES_PERSON") + ", with " +
                       scroller.getInt("SALES") + " sales");
}
if (scroller.isLast()) {
    System.out.println("There are only three rows.");
}
if (scroller.last()) {
    System.out.println("The least highest number " +
                       "of sales of the top three sales is: " +
                       scroller.getInt("SALES"));
}
scroller.close();
s4.close();
conn.commit()
conn.close();
System.out.println("Closed connection");</div></pre></div></div></div><div><a name="N1788B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevconceptsholdablecursors"></a><div></div>Holdable result sets</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The holdable result set feature permits an application to
keep result sets open after implicit or explicit commits. By default,
the cursor controlled by the result set is held open after a commit.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N178AF"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> also
supports non-holdable result sets.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N178BD"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you create a statement, you can specify that the result set
will be automatically closed when a commit occurs.
Result sets are automatically
closed when a transaction aborts, whether or not they have been specified
to be held open.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N178C6"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify whether a result set should be held open after a commit
takes place, supply one of the following <span style="font-style: italic;">ResultSet</span> parameters to the <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> method <span style="font-family: Courier;"><span style="font-style: italic;">createStatement</span></span>, <span style="font-family: Courier;"><span style="font-style: italic;">prepareStatement</span></span>, or <span style="font-family: Courier;"><span style="font-style: italic;">prepareCall</span></span>:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N178FD"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="font-style: italic;">CLOSE_CURSORS_AT_COMMIT</span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Result sets are closed when an
implicit or explicit commit is performed.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;"><span style="font-style: italic;">HOLD_CURSORS_OVER_COMMIT</span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Result sets are held open when
a commit is performed, implicitly or explicitly. This is the default behavior.</div></div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17929"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The method <span style="font-style: italic;">Statement.getResultSetHoldability()</span> indicates
whether a result set generated by the Statement object stays open or closes, upon
commit. See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for
more information.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17946"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When an implicit or explicit commit occurs, result sets
that hold cursors open behave as follows:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1794F"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Open result sets remain open. Non-scrollable result sets becomes
positioned before the next logical row of the result set. Scrollable
insensitive result sets keep their current position.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>When the session is terminated, the result set is closed and destroyed.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>All locks are released, including locks protecting the current
cursor position.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For non-scrollable result sets, immediately following a commit, the
only valid operations that can be performed on the <span style="font-style: italic;">ResultSet</span>
object are:   <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>positioning the result set to the next row with <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet.next()</span></span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>closing the result set with <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet.close()</span></span>.</div></td></tr></table></div></div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17993"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">When a rollback or rollback to savepoint occurs, either explicitly or implicitly, the following
behavior applies:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>All open result sets are closed.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>All locks acquired during the unit of work are released.</div></td></tr></table></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N179AA"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>   Holdable result sets do not work with XA
transactions in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. When working
with XA transactions, the result set should be opened with holdability
<span style="font-family: Courier;">ResultSet.CLOSE_CURSORS_AT_COMMIT</span>.</div></div></div><div><a name="N17A4F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts840995"></a><div></div>Holdable result sets and autocommit</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When autocommit is on, a positioned update or delete
statement will automatically cause the transaction to commit. 

</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17A78"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the result set has holdability 
<span style="font-family: Courier;">ResultSet.CLOSE_CURSORS_AT_COMMIT</span>, combined with
autocommit on, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
gives an exception on positioned updates and deletes because the
cursor is closed immediately before the positioned statement is
commenced, as mandated by JDBC. In contrast, no such implicit commit
is done when using result set updates methods.
</div></div></div></div><div><a name="N17ABB"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconcepts1119"></a><div></div>Non-holdable result set example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The following example uses <span style="font-style: italic;">Connection.createStatement</span> to
return a <span style="font-family: Courier;"><span style="font-style: italic;">ResultSet</span></span>  that will close after a commit
is performed.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N17ADD"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = ds.getConnection(user, passwd);
Statement stmt =
conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,
                  ResultSet.CONCUR_READ_ONLY,
                  ResultSet.CLOSE_CURSORS_AT_COMMIT);
</div></pre></div></div></div></div></div><div><a name="N17B15"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts30291"></a><div></div>Locking, concurrency, and isolation</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses topics pertinent to multi-user systems,
in which concurrency is important.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is configured
by default to work well for multi-user systems. For single-user systems, you
might want to tune your system so that it uses fewer resources; see <span style="color: blue;"><a href="#cdevconcepts23810">Lock granularity</a></span>.</div></div><div><a name="N17C22"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts15366"></a><div></div>Isolation levels and concurrency</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
four transaction isolation levels. Setting the transaction isolation level
for a connection allows a user to specify how severely the user's transaction
should be isolated from other transactions.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, it allows you to specify whether transaction A is allowed
to make changes to data that have been viewed by transaction B before transaction
B has committed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A connection determines its own isolation level, so JDBC provides an application
with a way to specify a level of transaction isolation. It specifies four
levels of transaction isolation. The higher the transaction isolation, the
more care is taken to avoid conflicts; avoiding conflicts sometimes means
locking out transactions. Lower isolation levels thus allow greater concurrency.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Inserts, updates, and deletes always behave the same no matter what the
isolation level is. Only the behavior of select statements varies.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To set isolation levels you can use the JDBC <span style="font-style: italic;">Connection.setTransactionIsolation</span> method
or the SQL SET ISOLATION statement.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If there is an active transaction, the network client driver always commits 
the active transaction, whether you use the JDBC 
<span style="font-style: italic;">Connection.setTransactionIsolation</span> method or the SQL SET ISOLATION 
statement. It does this even if the method call or statement does not actually 
change the isolation level (that is, if it sets the isolation level to its 
current value). The embedded driver also always commits the active transaction 
if you use the SET ISOLATION statement. However, if you use the 
<span style="font-style: italic;">Connection.setTransactionIsolation</span> method, the embedded driver commits 
the active transaction only if the call to <span style="font-style: italic;">Connection.setTransactionIsolation</span> 
actually changes the isolation level.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The names of the isolation levels are
different, depending on whether you use a JDBC method or SQL statement. <span style="color: blue;"><a href="#cdevconcepts15366">Mapping of JDBC transaction isolation levels to Derby isolation levels</a></span> shows the equivalent
names for isolation levels whether they are set through the JDBC method or
an SQL statement.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 5. </span>Mapping of JDBC transaction
isolation levels to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> isolation
levels</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Isolation levels for JDBC</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Isolation levels for SQL</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_READ_UNCOMMITTED (ANSI level
0)</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>UR, DIRTY READ, READ UNCOMMITTED </div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_READ_COMMITTED (ANSI level
1) </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>CS, CURSOR STABILITY, READ COMMITTED</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_REPEATABLE_READ (ANSI level
2) </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>RS</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_SERIALIZABLE (ANSI level
3) </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>RR, REPEATABLE READ, SERIALIZABLE </div></td></tr></tbody></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These levels allow you to avoid particular kinds of transaction anomalies,
which are described in <span style="color: blue;"><a href="#cdevconcepts17741">Transaction Anomalies</a></span>.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 6. </span>Transaction Anomalies</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>Anomaly</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Example</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Dirty Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A dirty read happens when a transaction
reads data that is being modified by another transaction that has not yet
committed.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">UPDATE employee SET salary = 31650
WHERE empno = '000090'</div></pre> Transaction B begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee</div></pre> (Transaction
B sees data updated by transaction A. Those updates have not yet been committed.)</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Non-Repeatable Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Non-repeatable reads happen when
a query returns data that would be different if the query were repeated within
the same transaction. Non-repeatable reads can occur when other transactions
are modifying data that a transaction is reading.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee
WHERE empno = '000090' </div></pre> Transaction B begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">UPDATE employee SET salary = 30100
WHERE empno = '000090'</div></pre> (Transaction B updates rows viewed by transaction
A before transaction A commits.) If Transaction A issues the same SELECT statement,
the results will be different.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Phantom Reads <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Records that appear in a set being read
by another transaction. Phantom reads can occur when other transactions insert
rows that would satisfy the WHERE clause of another transaction's statement.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Transaction A begins.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM employee
 WHERE salary &gt; 30000 </div></pre> Transaction B begins.  <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">INSERT INTO employee
(empno, firstnme, midinit,
lastname, job,
salary) VALUES ('000350', 'NICK',
'A','GREEN','LEGAL COUNSEL',35000)</div></pre> Transaction B inserts a row
that would satisfy the query in Transaction A if it were issued again.</div></td></tr></tbody></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The transaction isolation level is a way of specifying whether these transaction
anomalies are allowed. The transaction isolation level thus affects the quantity
of data locked by a particular transaction. In addition, a DBMS's locking
schema might also affect whether these anomalies are allowed. A DBMS can lock
either the entire table or only specific rows in order to prevent transaction
anomalies.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="color: blue;"><a href="#cdevconcepts28076">When Transaction Anomalies Are Possible</a></span> shows
which anomalies are possible under the various locking schemas and isolation
levels.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 7. </span>When Transaction Anomalies
Are Possible</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Isolation Level</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Table-Level Locking</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Row-Level Locking</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TRANSACTION_READ_UNCOMMITTED</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Dirty reads, nonrepeatable reads, and phantom reads possible</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Dirty reads, nonrepeatable reads, and phantom reads possible</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TRANSACTION_READ_COMMITTED</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Nonrepeatable reads and phantom reads possible</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Nonrepeatable reads and phantom reads possible</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TRANSACTION_REPEATABLE_READ</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Phantom reads not possible because entire table is locked</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Phantom reads possible</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>TRANSACTION_SERIALIZABLE</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>None</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>None</div></td></tr></tbody></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following <span style="font-style: italic;">java.sql.Connection</span> isolation levels are supported:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">TRANSACTION_SERIALIZABLE</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">RR</span>, <span style="font-family: Courier;">SERIALIZABLE</span>,
or <span style="font-family: Courier;">REPEATABLE READ</span> from SQL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">TRANSACTION_SERIALIZABLE</span> means
that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> treats the transactions
as if they occurred serially (one after the other) instead of concurrently. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues locks to prevent
all the transaction anomalies listed in <span style="color: blue;"><a href="#cdevconcepts17741">Transaction Anomalies</a></span> from
occurring. The type of lock it issues is sometimes called a <span style="font-style: italic;">range lock</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">TRANSACTION_REPEATABLE_READ</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">RS</span> from
SQL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">TRANSACTION_REPEATABLE_READ</span> means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues
locks to prevent only dirty reads and non-repeatable reads, but not phantoms.
It does not issue range locks for selects.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">TRANSACTION_READ_COMMITTED</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">CS</span> or <span style="font-family: Courier;">CURSOR
STABILITY</span> from SQL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> means
that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues locks
to prevent only dirty reads, not all the transaction anomalies listed in <span style="color: blue;"><a href="#cdevconcepts15366">Transaction Anomalies</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> is
the default isolation level for transactions.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-family: Courier;">TRANSACTION_READ_UNCOMMITTED</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">UR</span>, <span style="font-family: Courier;">DIRTY
READ</span>, or <span style="font-family: Courier;">READ UNCOMMITTED</span> from SQL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a
SELECT INTO, FETCH with a read-only cursor, full select used in an INSERT,
full select/subquery in an UPDATE/DELETE, or scalar full select (wherever
used), READ UNCOMMITTED allows:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Any row that is read during the unit of work to be changed by other application
processes.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Any row that was changed by another application process to be read even
if the change has not been committed by the application process.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For other operations, the rules that apply to READ COMMITTED also
apply to READ UNCOMMITTED.</div></div></td></tr></table></div></div></div><div><a name="N17FE6"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts22300"></a><div></div>Configuring isolation levels</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If a connection does not specify its isolation level, it inherits
the default isolation level for the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.
The default value is <span style="font-family: Courier;">CS</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When set to <span style="font-family: Courier;">CS</span>, the connection inherits the TRANSACTION_READ_COMMITTED
isolation level. When set to <span style="font-family: Courier;">RR</span>, the connection inherits
the TRANSACTION_SERIALIZABLE isolation level, when set to <span style="font-family: Courier;">RS</span>,
the connection inherits the TRANSACTION_REPEATABLE_READ isolation level, and
when set to <span style="font-family: Courier;">UR</span>, the connection inherits the TRANSACTION_READ_UNCOMMITTED
isolation level.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To override the inherited default, use the methods of <span style="font-style: italic;">java.sql.Connection</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, a connection can change the isolation level of the transaction
within an SQL statement. For more information, see "SET ISOLATION statement"
in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>. You can
use the WITH clause to change the isolation level for the current statement
only, not the transaction. For information about the WITH clause, see
"SELECT statement" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> In all cases except when you change the isolation level using the WITH
clause, changing the isolation level commits the current transaction. In most
cases, the current transaction is committed even if you set the isolation level
in a way that does not change it (that is, if you set it to its current value).
See <span style="color: blue;"><a href="#cdevconcepts15366">Isolation levels and concurrency</a></span> for details.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  For information about how to choose a particular isolation level, see
"Shielding users from Derby class-loading events" in <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span></span> and
<span style="color: blue;"><a href="#cdevconcepts65864">Multi-thread programming tips</a></span>.</div></div></div><div><a name="N180E0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts23810"></a><div></div>Lock granularity</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can be
configured for <span style="font-style: italic;">table-level</span> locking. With table-level locking, when
a transaction locks data in order to prevent any transaction anomalies, it
always locks the entire table, not just those rows being accessed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
configured for row-level locking. Row-level locking uses more memory but allows
greater concurrency, which works better in multi-user systems. Table-level
locking works best with single-user applications or read-only applications. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You typically set lock granularity for the entire <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
not for a particular application. However, at runtime, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> may
escalate the lock granularity for a particular transaction from row-level
locking to table-level locking for performance reasons. You have some control
over the threshold at which this occurs. For information on turning off row-level
locking, see "<span style="font-style: italic;">derby.storage.rowLocking</span>" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.
For more information about automatic lock escalation, see "About the system's
selection of lock granularity" and "Transaction-based lock escalation" in <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span>. For more
information on tuning your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
see "Tuning databases and applications," also in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span>.</div></div></div><div><a name="N181BC"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts36402"></a><div></div>Types and scope of locks in Derby systems</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">There are several types of locks available in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> systems,
including exclusive, shared, and update locks.</div></div><div><a name="N182A3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts842279"></a><div></div>Exclusive locks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When a statement modifies data, its transaction holds an <span style="font-style: italic;">exclusive</span> lock
on data that prevents other transactions from accessing the data.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This lock remains in place until the transaction holding the lock issues
a commit or rollback. Table-level locking lowers concurrency in a multi-user
system.</div></div></div><div><a name="N1833E"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts842304"></a><div></div>Shared locks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When a statement reads data without making any modifications, its
transaction obtains a <span style="font-style: italic;">shared lock</span> on the data.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another transaction that tries to read the same data is permitted to read,
but a transaction that tries to update the data will be prevented from doing
so until the shared lock is released. How long this shared lock is held depends
on the isolation level of the transaction holding the lock. Transactions using
the TRANSACTION_READ_COMMITTED isolation level release the lock when the transaction
steps through to the next row. Transactions using the TRANSACTION_SERIALIZABLE
or TRANSACTION_REPEATABLE_READ isolation level hold the lock until the transaction
is committed, so even a SELECT can prevent updates if a commit is never issued.
Transactions using the TRANSACTION_READ_UNCOMMITTED isolation level do not
request any locks.</div></div></div><div><a name="N183C1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts842385"></a><div></div>Update locks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When a user-defined update cursor (created with the FOR UPDATE
clause or by using concurrency mode
<span style="font-family: Courier;">ResultSet.CONCUR_UPDATABLE</span>) reads data, its
transaction obtains an <span style="font-style: italic;">update</span> lock on the data.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the user-defined update cursor updates the data, the update lock is
converted to an exclusive lock. If the cursor does not update the row, when
the transaction steps through to the next row, transactions using the TRANSACTION_READ_COMMITTED
isolation level release the lock. (For update locks, the TRANSACTION_READ_UNCOMMITTED
isolation level acts the same way as TRANSACTION_READ_COMMITTED.)</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Update locks help minimize deadlocks.</div></div></div><div><a name="N18460"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconcepts2462"></a><div></div>Lock compatibility</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This table lists compatibility between lock types. <span style="font-family: Courier;">+</span> means
the lock types are compatible,  while <span style="font-family: Courier;">-</span> means they are incompatible.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 8. </span>Lock Compatibility Matrix</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span>&nbsp;'</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Shared</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Update</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Exclusive</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Shared</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">+</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">+</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Update</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">+</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Exclusive</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">-</div></div></td></tr></tbody></table></div></div></div><div><a name="N185AD"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevconcepts8424"></a><div></div>Scope of locks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The amount of data locked by a statement can vary.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N18626"></a><span></span><div style="font-weight: bold;">Table locks</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock the <span style="font-style: italic;">entire table</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Table-level
locking systems always lock entire tables.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Row-level locking systems
can lock entire tables if the WHERE clause of a statement cannot use an index.
For example, UPDATES that cannot use an index lock the entire table.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Row-level
locking systems can lock entire tables if a high number of single-row locks
would be less efficient than a single table-level lock. Choosing table-level
locking instead of row-level locking for performance reasons is called <span style="font-style: italic;">lock
escalation</span>. For more information about this topic, see "About the system's
selection of lock granularity" and "Transaction-based lock escalation" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N18659"></a><span></span><div style="font-weight: bold;">Single-row locks</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock only <span style="font-style: italic;">a
single row</span> at a time.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For row-level locking systems:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For TRANSACTION_REPEATABLE_READ isolation, the locks are released at the
end of the transaction.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For TRANSACTION_READ_COMMITTED isolation, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
rows only as the application steps through the rows in the result. The current
row is locked. The row lock is released when the application goes to the next
row.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For TRANSACTION_SERIALIZABLE isolation, however, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
the whole set before the application begins stepping through.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For TRANSACTION_READ_UNCOMMITTED, no row locks are requested.</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
single rows for INSERT statements, holding each row until the transaction
is committed. If there is an index associated with the table, the previous
key is also locked.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N186A0"></a><span></span><div style="font-weight: bold;">Range locks</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A statement can lock <span style="font-style: italic;">a range of rows</span> (range
lock).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For row-level locking systems: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For <span style="font-style: italic;">any</span> isolation level, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks <span style="font-style: italic;">all
the rows in the result</span> plus an entire range of rows for updates or deletes.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For the TRANSACTION_SERIALIZABLE isolation level, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
all the rows in the result plus an entire range of rows in the table for SELECTs
to prevent nonrepeatable reads and phantoms.</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, if a SELECT statement specifies rows in the <span style="font-style: italic;">Employee</span> table
where the <span style="font-style: italic;">salary</span> is BETWEEN two values, the system can lock more than
just the actual rows it returns in the result. It also must lock the entire <span style="font-style: italic;">range</span> of
rows between those two values to prevent another transaction from inserting,
deleting, or updating a row within that range.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An index must be available
for a range lock. If one is not available, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> locks
the entire table.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 9. </span>Types
and scopes of locking</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Transaction Isolation Level</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Table-Level Locking</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Row-Level Locking</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_READ_UNCOMMITED (SQL: UR)</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>For SELECT statements, table-level locking is never requested
using this isolation level. For other statements, same as for TRANSACTION_READ_COMMITTED.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECT statements get no locks. For other statements, same
as for TRANSACTION_ READ_COMMITTED.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_READ_COMMITTED (SQL: CS) </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECT statements get a shared lock on the entire table.
The locks are released when the user closes the <span style="font-style: italic;">ResultSet</span>. Other statements
get exclusive locks on the entire table, which are released when the transaction
commits.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECTs lock and release single rows as the user steps
through the <span style="font-style: italic;">ResultSet</span>. UPDATEs and DELETEs get exclusive locks on a
range of rows. INSERT statements get exclusive locks on single rows (and sometimes
on the preceding rows).</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_REPEATABLE_READ (SQL: RS)</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Same as for TRANSACTION_SERIALIZABLE</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECT statements get shared locks on the rows that satisfy
the WHERE clause (but do not prevent inserts into this range). UPDATEs and
DELETEs get exclusive locks on a range of rows. INSERT statements get exclusive
locks on single rows (and sometimes on the preceding rows).</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Connection.TRANSACTION_SERIALIZABLE (SQL: RR)</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECT statements get a shared lock on the entire table.
Other statements get exclusive locks on the entire table, which are released
when the transaction commits.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>SELECT statements get shared locks on a range of rows.
UPDATE and DELETE statements get exclusive locks on a range of rows. INSERT
statements get exclusive locks on single rows (and sometimes on the preceding
rows).</div></td></tr></tbody></table></div></div></div></div><div><a name="N18833"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts842613"></a><div></div>Notes on locking</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In addition to the locks already described, foreign key lookups
require briefly held shared locks on the referenced table (row or table, depending
on the configuration).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The table and examples in this section do not take performance-based lock
escalation into account. Remember that the system can choose table-level locking
for performance reasons.</div></div></div></div><div><a name="N188BC"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts28436"></a><div></div>Deadlocks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In a database, a deadlock is a situation in which two or more transactions
are waiting for one another to give up locks.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, Transaction A might hold a lock on some rows in the <span style="font-style: italic;">Accounts</span> table
and needs to update some rows in the <span style="font-style: italic;">Orders</span> table to finish. Transaction
B holds locks on those very rows in the <span style="font-style: italic;">Orders</span> table but needs to update
the rows in the <span style="font-style: italic;">Accounts</span> table held by Transaction A. Transaction A
cannot complete its transaction because of the lock on <span style="font-style: italic;">Orders</span>. Transaction
B cannot complete its transaction because of the lock on <span style="font-style: italic;">Accounts</span>.
All activity comes to a halt and remains at a standstill forever unless the
DBMS detects the deadlock and aborts one of the transactions.</div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 6. </span>A deadlock where two transactions are waiting
for one another to give up locks.</div><div>&nbsp;</div><div><img src="dead.jpg" alt="This figure depicts a deadlock. Transaction A has a lock on the Accounts table and needs a lock on the Orders table to finish the transaction. Transaction B has a lock on the Orders table and needs a lock on the Accounts table to finish the transaction."></div><div></div></div></div><div><a name="N189D1"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts53677"></a><div></div>Avoiding deadlocks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Using both row-level locking and the TRANSACTION_READ_COMMITTED
isolation level makes it likely that you will avoid deadlocks (both settings
are <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> defaults). However,
deadlocks are still possible.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application developers
can avoid deadlocks by using consistent application logic; for example, transactions
that access <span style="font-style: italic;">Accounts</span> and <span style="font-style: italic;">Orders</span> should always access the tables
in the same order. That way, in the scenario described above, Transaction
B simply waits for transaction A to release the lock on <span style="font-style: italic;">Orders</span> before
it begins. When transaction A releases the lock on <span style="font-style: italic;">Orders</span>, Transaction
B can proceed freely.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another tool available to you is the LOCK TABLE statement. A transaction
can attempt to lock a table in exclusive mode when it starts to prevent other
transactions from getting shared locks on a table. For more information, see
"LOCK TABLE statement" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div><div><a name="N18A80"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts95005"></a><div></div>Deadlock detection</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When a transaction waits more than a specific amount of time to
obtain a lock (called the deadlock timeout), <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
detect whether the transaction is involved in a deadlock.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> analyzes
such a situation for deadlocks it tries to determine how many transactions
are involved in the deadlock (two or more). Usually aborting one transaction
breaks the deadlock. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> must
pick one transaction as the victim and abort that transaction; it picks the
transaction that holds the fewest number of locks as the victim, on the assumption
that transaction has performed the least amount of work. (This may not be
the case, however; the transaction might have recently been escalated from
row-level locking to table locking and thus hold a small number of locks even
though it has done the most work.) </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> aborts the
victim transaction, it receives a deadlock error (an <span style="font-style: italic;">SQLException</span> with
an <span style="font-family: Courier;"><span style="font-style: italic;">SQLState</span></span> of 40001). The error message gives you
the transaction IDs, the statements, and the status of locks involved in a
deadlock situation.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ERROR 40001: A lock could not be obtained due to a deadlock,
cycle of locks &amp; waiters is:
Lock : ROW, DEPARTMENT, (1,14)
Waiting XID : {752, X} , APP, update department set location='Boise'
	where deptno='E21'
Granted XID : {758, X} Lock : ROW, EMPLOYEE, (2,8)
Waiting XID : {758, U} , APP, update employee set bonus=150 where salary=23840
Granted XID : {752, X} The selected victim is XID : 752</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information on configuring when deadlock checking occurs, see <span style="color: blue;"><a href="#cdevconcepts16400">Configuring deadlock detection and lock wait timeouts</a></span>.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Deadlocks are detected only within a single database. Deadlocks across
multiple databases are not detected. Non-database deadlocks caused by Java
synchronization primitives are not detected by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div></div><div><a name="N18B55"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts89097"></a><div></div>Lock wait timeouts</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Even if a transaction is not involved in a deadlock, it might have
to wait a considerable amount of time to obtain a lock because of a long-running
transaction or transactions holding locks on the tables it needs.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In such a situation, you might not want a transaction to wait indefinitely.
Instead, you might want the waiting transaction to abort, or <span style="font-style: italic;">time out</span>,
after a reasonable amount of time, called a <span style="font-style: italic;">lock wait timeout</span>.</div></div></div><div><a name="N18BE2"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts16400"></a><div></div>Configuring deadlock detection and lock wait timeouts</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You configure the amount of time a transaction waits before <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does any deadlock checking
with the <span style="font-style: italic;">derby.locks.deadlockTimeout</span> property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You configure the amount of time a transaction waits before timing out
with the <span style="font-family: Courier;"><span style="font-style: italic;">derby.locks.waitTimeout</span></span> property. When configuring
your database or system, you should consider these properties together. For
example, in order for any deadlock checking to occur, the <span style="font-family: Courier;"><span style="font-style: italic;">derby.locks.deadlockTimeout</span></span> property
must be set to a value lower than the <span style="font-family: Courier;"><span style="font-style: italic;">derby.locks.waitTimeout</span></span> property.
If it is set to a value equal to or higher than the <span style="font-family: Courier;"><span style="font-style: italic;">derby.locks.waitTimeout</span></span>,
the transaction times out before <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
any deadlock checking.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, <span style="font-style: italic;">derby.locks.waitTimeout</span> is
set to 60 seconds. -1 is the equivalent of no wait timeout. This means that
transactions never time out, although <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
choose a transaction as a deadlock victim.</div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 7. </span>One possible configuration:
deadlock checking occurs when a transaction has waited 30 seconds; no lock
wait timeouts occur.</div><div>&nbsp;</div><div><img src="lockwa3.jpg" alt="This figure shows a configuration where deadlock checking occurs when a transaction has waited 30 seconds. No lock wait timeouts occur."></div><div></div></div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 8. </span>Another typical configuration:
deadlock checking occurs after a transaction has waited 60 seconds for a lock;
after 90 seconds, the transaction times out and is rolled back. </div><div>&nbsp;</div><div><img src="lockwa1.jpg" alt="This figure shows a configuration where deadlock checking occurs after a transaction has waited 60 seconds for a lock. After 90 seconds, the transaction times out and is rolled back."></div><div></div></div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 9. </span>A configuration in which
no deadlock checking occurs: transactions time out after they have waited
50 seconds. No deadlock checking occurs. </div><div>&nbsp;</div><div><img src="lockwa2.jpg" alt="This figure shows a configuration where no deadlock checking occurs. The transactions time out after they have waited 50 seconds. No deadlock checking occurs."></div><div></div></div></div></div><div><a name="N18D1A"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts50894"></a><div></div>Debugging Deadlocks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If deadlocks occur frequently in your multi-user system with a
particular application, you might need to do some debugging.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides a class
    to help you in this situation, <span style="font-style: italic;">org.apache.derby.diag.LockTable</span>.
    Access to the <span style="font-style: italic;">LockTable</span> information is provided via the
    SYSCS_DIAG.LOCK_TABLE diagnostic table.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The SYSCS_DIAG.LOCK_TABLE
diagnostic table shows all of the locks that are currently held in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database. 
You can reference the SYSCS_DIAG.LOCK_TABLE diagnostic table directly
in a statement.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For
    example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT * FROM SYSCS_DIAG.LOCK_TABLE</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When
the SYSCS_DIAG.LOCK_TABLE diagnostic table is referenced in a statement, a
snapshot of the lock table is taken.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">
    For more information about how to use this table:
    <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>See "SYSCS_DIAG diagnostic tables and functions" in the
            <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>See the <span style="color: blue;"><a href="http://db.apache.org/derby/javadoc/engine/org/apache/derby/diag/LockTable.html">LockTable API documentation</a></span>.
        </div></td></tr></table></div>
    You
can also set the property <span style="font-style: italic;">derby.locks.deadlockTrace</span> to dump additional
information to the derby.log file about any deadlocks that occur on your system. 
See the Tuning Guide for more information on this property. For information, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Additional general information about diagnosing locking problems can be
    found in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
    Wiki at <span style="color: blue;"><a href="http://wiki.apache.org/db-derby/LockDebugging">
        http://wiki.apache.org/db-derby/LockDebugging</a></span>.
</div></div></div><div><a name="N18E22"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevconcepts32861"></a><div></div>Programming applications to handle deadlocks</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you configure your system for deadlock and lockwait timeouts
and an application could be chosen as a victim when the transaction times
out, you should program your application to handle them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To do this, test for <span style="font-style: italic;">SQLExceptions</span> with <span style="font-family: Courier;"><span style="font-style: italic;">SQLStates</span></span> of
40001 (deadlock timeout) or 40XL1 or 40XL2 (lockwait timeout).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In the case of a deadlock you might want to re-try the transaction that
was chosen as a victim. In the case of a lock wait timeout, you probably do
not want to do this right away.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following code is one example of how to handle a deadlock timeout.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">/// if this code might encounter a deadlock, 
// put the whole thing in a try/catch block
// then try again if the deadlock victim exception 
// was thrown</span>
try {
    s6.executeUpdate(
         "UPDATE employee " +
         "SET bonus = 625 "
         "WHERE empno='000150'");
    s6.executeUpdate("UPDATE project " +
         "SET respemp = '000150' " +
         "WHERE projno='IF1000'");
} 
<span style="font-weight: bold;">// note: do not catch such exceptions in database-side methods; 
// catch such exceptions only at the outermost level of 
// application code. 
// See <span style="color: blue;"><a href="#cdevspecial41728">Database-side JDBC routines and SQLExceptions</a></span>. </span> 
catch (SQLException se) { 
    if (se.getSQLState().equals("40001")) { 
        <span style="font-weight: bold;">// it was chosen as a victim of a deadlock. 
        // try again at least once at this point.</span> 
        System.out.println( "Will try the transaction again."); 
        s6.executeUpdate("UPDATE employee " + 
        "SET bonus = 625 " + 
        "WHERE empno='000150'"); 
        s6.executeUpdate("UPDATE project " + 
        "SET respemp = 000150 " + 
        "WHERE projno='IF1000'"); 
    } 
    else throw se; 
}
</div></pre></div></div></div></div><div><a name="N18EF6"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts34828"></a><div></div>Working with multiple connections to a single database</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses deploying <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> so
that many connections can exist to a single database.</div></div><div><a name="N18FC6"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevconcepts713"></a><div></div>Deployment options and threading and connection modes</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A database can be available to multiple connections in several
situations.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N18FFE"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Multiple applications access a single database (possible only when <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is running inside a server
framework).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>A single application has more than one <span style="font-style: italic;">Connection</span> to the same database.
  <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The way you deploy <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> affects
the ways applications can use multi-threading and connections, as shown in <span style="color: blue;"><a href="#cdevconcepts40343">Threading and Connection Modes</a></span>.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 10. </span>Threading and Connection Modes</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>Connection mode</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Embedded</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Server</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">Multi-Threaded</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">From an application, using
a <span style="font-style: italic;">single</span><span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
and issuing requests against that connection in multiple threads.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Supply a single <span style="font-style: italic;">Connection</span> object to separate threads. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> ensures that only one
operation is applied at a time for consistency. Server frameworks automatically
manage multi-threaded operations..</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Server frameworks can automatically multi-thread operations.
Remote client applications can multi-thread if desired.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">Multi-Connection</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">From an application, using
multiple connections to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
and issuing requests against those connections on multiple threads.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Create individual connections within a single application
and use the appropriate connection for each JDBC request. The connections
can all be to the same database, or can be to different databases in the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Remote client applications can establish the multiple connections
desired.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">Multi-User</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multiple applications (or JVMs)
accessing the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database.
Each user application has its own connection or connections to the database.</div></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Not possible. Only one application can access a database
at a time, and only one application can access a specific system at a time.
When using a pre-1.4 JVM, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> might
not prevent multiple applications from concurrently accessing the same <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, but do not allow
this because such access can corrupt the databases involved.</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Only one server should access a database at a time. Multiple
remote client applications can access the same server, and thus can access
the same database at the same time through that server.</div></td></tr></tbody></table></div></div></td></tr></table></div></div></div></div><div><a name="N19168"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts10914"></a><div></div>Multi-user database access</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Multi-user database access is possible if <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running inside a server framework.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If more than one client application tries to modify the same data, the
connection that gets the table first gets the lock on the data (either specific
rows or the entire table). The second connection has to wait until the first
connection commits or rolls back the transaction in order to access the data.
If two connections are only querying and not modifying data, they can both
access the same data at the same time because they can each get a shared lock.</div></div></div><div><a name="N191E3"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts24019"></a><div></div>Multiple connections from a single application</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A single application can work with multiple <span style="font-style: italic;">Connections</span> to
the same database and assign them to different threads.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can avoid concurrency and deadlock problems in your application in
several ways:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use the <span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> isolation level and turn on
row-level locking (the defaults).</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Beware of deadlocks caused by using more than one <span style="font-style: italic;">Connection</span> in
a single thread (the most obvious case). For example, if the thread tries
to update the same table from two different <span style="font-family: Courier;"><span style="font-style: italic;">Connections</span></span>,
a deadlock can occur.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Assign <span style="font-style: italic;">Connections</span> to threads that handle discrete tasks. For example,
do not have two threads update the <span style="font-style: italic;">Hotels</span> table. Have one thread update
the <span style="font-style: italic;">Hotels</span> table and a different one update the <span style="font-style: italic;">Groups</span> table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If threads access the same tables, commit transactions often.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Multi-threaded Java applications have the ability to self-deadlock without
even accessing a database, so beware of that too.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use nested connections to share the same lock space.</div></td></tr></table></div></div></div></div><div><a name="N1928F"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts23499"></a><div></div>Working with multiple threads sharing a single connection</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">JDBC allows you to share a single <span style="font-style: italic;">Connection</span> among multiple
threads.</div></div><div><a name="N1935E"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts89498"></a><div></div>Pitfalls of sharing a connection among threads</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Here is a review of the potential pitfalls of sharing a single <span style="font-style: italic;">Connection</span> among
multiple threads.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Committing or rolling back a transaction closes all open <span style="font-style: italic;">ResultSet</span> objects
and currently executing <span style="font-style: italic;">Statements</span>, unless you are using held cursors. <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If
one thread commits, it closes the <span style="font-style: italic;">Statements</span> and <span style="font-style: italic;">ResultSets</span> of
all other threads using the same connection.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Executing a <span style="font-style: italic;">Statement</span> automatically closes any existing open <span style="font-style: italic;">ResultSet</span> generated
by an earlier execution of that <span style="font-style: italic;">Statement</span>. <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If threads share <span style="font-style: italic;">Statements</span>,
one thread could close another's <span style="font-style: italic;">ResultSet.</span></div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In many cases, it is easier to assign each thread to a distinct <span style="font-style: italic;">Connection</span>.
If thread <span style="font-style: italic;">A</span> does database work that is not transactionally related
to thread <span style="font-style: italic;">B</span>, assign them to different <span style="font-style: italic;">Connections</span>. For example,
if thread <span style="font-style: italic;">A</span> is associated with a user input window that allows users
to delete hotels and thread <span style="font-style: italic;">B</span> is associated with a user window that
allows users to view city information, assign those threads to different <span style="font-style: italic;">Connections</span>.
That way, when thread <span style="font-style: italic;">A</span> commits, it does not affect any <span style="font-style: italic;">ResultSets</span> or <span style="font-style: italic;">Statements</span> of
thread B.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another strategy is to have one thread do queries and another thread do
updates. Queries hold shared locks until the transaction commits in SERIALIZABLE
isolation mode; use READ_COMMITTED instead.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Yet another strategy is to have only one thread do database access. Have
other threads get information from the database access thread.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Multiple threads are permitted to share a <span style="font-style: italic;">Connection</span>, <span style="font-style: italic;">Statement</span>,
or <span style="font-style: italic;">ResultSet</span>. However, the application programmer must ensure that
one thread does not affect the behavior of the others.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N19425"></a><span></span><div style="font-weight: bold;">Recommended Practices</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here are some tips for avoiding
unexpected behavior:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Avoid sharing <span style="font-style: italic;">Statements</span> (and their <span style="font-family: Courier;"><span style="font-style: italic;">ResultSets</span></span>)
among threads.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Each time a thread executes a<span style="font-style: italic;"> Statement</span>, it should process the
results before relinquishing the <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Each time a thread accesses the <span style="font-style: italic;">Connection</span>, it should consistently
commit or not, depending on application protocol.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Have one thread be the "managing" database <span style="font-style: italic;">Connection</span> thread that
should handle the higher-level tasks, such as establishing the <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span>,
committing, rolling back, changing <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span> properties
such as auto-commit, closing the <span style="font-family: Courier;"><span style="font-style: italic;">Connection</span></span>, shutting
down the database (in an embedded environment), and so on.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Close <span style="font-style: italic;">ResultSets</span> and <span style="font-family: Courier;"><span style="font-style: italic;">Statements</span></span> that are
no longer needed in order to release resources.</div></td></tr></table></div></div></div></div><div><a name="N194E5"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts65864"></a><div></div>Multi-thread programming tips</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You may be sharing a <span style="font-style: italic;">Connection</span> among multiple threads because
you have experienced poor concurrency using separate transactions.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here are some tips for increasing concurrency:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use row-level locking.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use the <span style="font-style: italic;">TRANSACTION_READ_COMMITTED</span> isolation level.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Avoid queries that cannot use indexes; they require locking of all the
rows in the table (if only very briefly) and might block an update.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, some programmers might share a statement among multiple threads
to avoid the overhead of each thread's having its own. Using the single statement
cache, threads can share the same statement from <span style="font-style: italic;">different connections</span>.
For more information, see "Using the statement cache" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Tuning Java DB</span></span>.</div></div></div><div><a name="N1956F"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevconcepts600"></a><div></div>Example of threads sharing a statement</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example shows what can happen if two threads try to share
a single<span style="font-style: italic;"> Statement</span>.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N19599"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">PreparedStatement ps = conn.prepareStatement(
    "UPDATE account SET balance =  balance + ? WHERE id = ?");
<span style="font-weight: bold;">/* now assume two threads T1,T2 are given this
java.sql.PreparedStatement object </span>and that the following events
happen in the order shown (pseudojava code)*/
T1 - ps.setBigDecimal(1, 100.00);
T1 - ps.setLong(2, 1234);
T2 -  ps.setBigDecimal(1, -500.00);
<span style="font-weight: bold;">// *** At this point the prepared statement has the parameters
// -500.00 and 1234
// T1 thinks it is adding 100.00 to account 1234 but actually
// it is subtracting 500.00</span>
T1 - ps.executeUpdate();
T2 - ps.setLong(2, 5678);
<span style="font-weight: bold;">// T2 executes the correct update</span>
 T2 - ps.executeUpdate();
<span style="font-weight: bold;">/* Also, the auto-commit mode of the connection can lead
to some strange behavior.*/</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N195BA"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If it is absolutely necessary, the application can get around
this problem with Java synchronization.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N195C3"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the threads each obtain their own <span style="font-style: italic;">PreparedStatement</span> (with
identical text), their <span style="font-family: Courier;"><span style="font-style: italic;">setXXX</span></span> calls do not interfere
with each other. Moreover, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
able to share the same compiled query plan between the two statements; it
needs to maintain only separate state information. However, there is the potential
for confusion in regard to the timing of the <span style="font-style: italic;">commit</span>, since a single <span style="font-style: italic;">commit</span> commits
all the statements in a transaction.</div></div></div></div></div><div><a name="N1962D"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevdvlp22619"></a><div></div>Working with database threads in an embedded environment</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Do not use <span style="font-family: Courier;"><span style="font-style: italic;">interrupt</span></span> calls to notify threads
that are accessing a database, because <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
catch the <span style="font-family: Courier;"><span style="font-style: italic;">interrupt</span></span> call and close the connection
to the database. Use <span style="font-family: Courier;"><span style="font-style: italic;">wait</span></span> and <span style="font-family: Courier;"><span style="font-style: italic;">notify</span></span> calls
instead.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This will not happen in a client/server environment, but if you want your
application to work in either environment it is good practice to follow this
rule.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There are also special considerations when working with more than one database
thread in an application.</div></div></div><div><a name="N1971B"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevconcepts24927"></a><div></div>Working with Derby SQLExceptions in an application</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">JDBC generates exceptions of the type
<span style="font-style: italic;">java.sql.SQLException</span>.
If your application runs on JDK 1.6 or higher, the exceptions
will be the refined subtypes of <span style="font-style: italic;">java.sql.SQLException</span>
introduced by JDBC4.
To see the exceptions generated by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
retrieve and process the <span style="font-family: Courier;"><span style="font-style: italic;">SQLExceptions</span></span> in a catch
block.</div></div><div><a name="N197EF"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevconcepts844813"></a><div></div>Information provided in SQL Exceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
the message, <span style="font-style: italic;">SQLState</span> values, and error codes in SQL exceptions.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">Use the <span style="font-family: Courier;"><span style="font-style: italic;">getSQLState</span></span> and <span style="font-family: Courier;"><span style="font-style: italic;">getMessage</span></span> methods
to view the <span style="font-family: Courier;"><span style="font-style: italic;">SQLState</span></span> and error messages. Use <span style="font-family: Courier;"><span style="font-style: italic;">getErrorCode</span></span> to
see the error code. The error code defines the severity of the error and is
not unique to each exception. <div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Severity is not standardized in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.
Applications should not depend on the severity returned from SQL exceptions.</div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Applications should also check for and process <span style="font-style: italic;">java.sql.SQLWarnings</span>,
which are processed in a similar way. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> issues
an <span style="font-family: Courier;"><span style="font-style: italic;">SQLWarning</span></span> if the <span style="font-family: Courier;"><span style="font-style: italic;">create=true</span></span> attribute
is specified and the database already exists.</div></div><div><a name="N198B8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevprocsqle"></a><div></div>Example of processing SQLExceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A single error can generate more than one <span style="font-style: italic;">SQLException</span>.
Use a loop and the <span style="font-family: Courier;"><span style="font-style: italic;">getNextException</span></span> method to process
all <span style="font-family: Courier;"><span style="font-style: italic;">SQLExceptions</span></span> in the chain. In many cases, the
second exception in the chain is the pertinent one.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N198E4"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following is an example:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N198ED"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">catch (Throwable e) {
    System.out.println("exception thrown:");
    errorPrint(e);
}
static void errorPrint(Throwable e) {
    if (e instanceof SQLException) 
        SQLExceptionPrint((SQLException)e);
    else
        System.out.println("A non-SQL error: " + e.toString());
}
static void SQLExceptionPrint(SQLException sqle) {
    while (sqle != null) {
        System.out.println("\n---SQLException Caught---\n");
        System.out.println("SQLState:   " + (sqle).getSQLState());
        System.out.println("Severity: " + (sqle).getErrorCode());
        System.out.println("Message:  " + (sqle).getMessage()); 
        sqle.printStackTrace();  
        sqle = sqle.getNextException();
    }
}</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N198F7"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If your application runs on JDK 1.4 or higher, then the <span style="font-style: italic;">SQLException</span>
may wrap another, triggering exception, like an <span style="font-style: italic;">IOException</span>. To inspect
this additional, wrapped error, call the <span style="font-style: italic;">SQLException</span>'s <span style="font-style: italic;">getCause</span> method.
</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N19918"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See also "<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Exception
Messages and SQL States", in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div></div></div></div></div></div><div><a name="N19952"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevresman19524"></a><div></div>Using Derby as a J2EE resource manager</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">J2EE, or the Java 2 Platform, Enterprise Edition, is a standard
for development of enterprise applications based on reusable components in
a multi-tier environment. In addition to the features of the Java 2 Platform,
Standard Edition (J2SE), J2EE adds support for Enterprise Java Beans (EJBs),
Java Server Pages (JSPs), Servlets, XML and many more. The J2EE architecture
is used to bring together existing technologies and enterprise applications
in a single, manageable environment.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is a J2EE-conformant
component in a distributed J2EE system. As such, it is one part of a larger
system that includes, among other things, a JNDI server, a connection pool
module, a transaction manager, a resource manager, and user applications.
Within this system, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
serve as the resource manager.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information on J2EE and how to work in this environment, see the
J2EE specification available at <span><span style="font-style: italic;">http://java.sun.com/j2ee/docs.html</span></span>.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  This chapter does not show you how to use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as
a Resource Manager. Instead, it provides details specific to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that
are not covered in the specification. This information is useful to programmers
developing other modules in a distributed J2EE system, not to end-user application
developers.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In order to qualify as a resource manager in a J2EE system, J2EE requires
these basic areas of support. These three areas of support involve implementation
of APIS and are described in "J2EE Compliance: Java Transaction API and javax.sql
Extensions" in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This chapter describes the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> classes
that implement the APIs and provides some implementation-specific details.</div></div><div><a name="N199FF"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="rdevresman79556"></a><div></div>Classes that pertain to resource managers</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Derby provides two variants of each <span style="font-style: italic;">DataSource</span> interface 
defined by the JDBC API.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N19A3D"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
Applications that run on the J2SE 1.4 or 1.5 platform <span style="font-weight: bold;">must</span> use the first 
variant. Applications that run on the Java SE 6 platform can use either of the 
two variants. However, the <span style="font-style: italic;">DataSource</span> methods specific to the JDBC 4 API 
are available only from the second variant (the one whose class name ends with "40").</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If an application is running on the Java SE 6 platform, all connection objects 
returned from the <span style="font-style: italic;">DataSource</span> will be JDBC 4 connection objects, 
regardless of which <span style="font-style: italic;">DataSource</span> variant is in use.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
The Derby implementation classes for the <span style="font-style: italic;">DataSource</span> interfaces are as
follows:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDataSource</span>
and <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDataSource40</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Implements the <span style="font-style: italic;">javax.sql.DataSource</span> interface,
which a JNDI server can reference. Typically this is the object that you work
with as a <span style="font-style: italic;">DataSource</span>.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource</span>
and <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Implements the <span style="font-style: italic;">javax.sql.ConnectionPoolDataSource</span> interface.
A factory for <span style="font-style: italic;">PooledConnection</span> objects.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedXADataSource</span>
and <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedXADataSource40</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
implementation of the <span style="font-style: italic;">javax.sql.XADataSource</span> interface.</div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the javadoc for each class for more information.</div></div></div></div><div><a name="N19B11"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevresman89722"></a><div></div>Getting a DataSource</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Normally, you can simply work with the interfaces for <span style="font-style: italic;">javax.sql.DataSource</span>, 
<span style="font-style: italic;">javax.sql.ConnectionPoolDataSource</span>, and <span style="font-style: italic;">javax.sql.XADataSource</span>, as shown in the following
examples.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
<span style="font-weight: bold;">// If your application is running on the Java SE 6 platform,
// and if you would like to call DataSource methods specific 
// to the JDBC 4 API (for example, isWrapperFor), use the
// JDBC 4 variants of these classes:
//
//   org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40
//   org.apache.derby.jdbc.EmbeddedDataSource40
//   org.apache.derby.jdbc.EmbeddedXADataSource40
//</span>
import org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource;
import org.apache.derby.jdbc.EmbeddedDataSource;
import org.apache.derby.jdbc.EmbeddedXADataSource; 

javax.sql.ConnectionPoolDataSource cpds = new EmbeddedConnectionPoolDataSource(); 
javax.sql.DataSource ds = new EmbeddedDataSource(); 
javax.sql.XADataSource xads = new EmbeddedXADataSource();</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides six properties
for a <span style="font-style: italic;">DataSource</span>. These properties are in <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDataSource</span>.
They are:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">DatabaseName</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This mandatory property must be set. It identifies
which database to access. To access a database named <span style="font-style: italic;">wombat</span> located at 
<span style="font-style: italic;">/local1/db/wombat</span>, call <span style="font-style: italic;">setDatabaseName("/local1/db/wombat")</span>
on the data source object. </div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">CreateDatabase</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Sets a property to create a database
the next time the <span style="font-style: italic;">getConnection</span> method of a data source object is called.
The string <span style="font-style: italic;">createString</span> is always "create" (or possibly null). (Use
the method <span style="font-style: italic;">setDatabaseName()</span> to define the name of
the database.)</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">ShutdownDatabase</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Sets a property to shut down a
database. The string <span style="font-style: italic;">shutDownString</span> is always "shutdown" (or possibly
null). Shuts down the database the next time the <span style="font-style: italic;">getConnection</span> method
of a data source object is called.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">DataSourceName</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Name for <span style="font-style: italic;">ConnectionPoolDataSource</span>
or <span style="font-style: italic;">XADataSource</span>. Not used by the data source object. Used for informational
purposes only. </div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Description</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Description of the data source. Not
used by the data source object. Used for informational purposes only. </div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">connectionAttributes</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Optional. Connection attributes specific
to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for a more information about
the attributes. </div></div></td></tr></table></div></div></div><div><a name="N19C64"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevresman92946"></a><div></div>Shutting down or creating a database</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If you need to shut down or create a database, it is easiest just
to work with the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>-specific
implementations of interfaces, as shown in these examples.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">javax.sql.XADataSource xads = makeXADataSource(mydb, true);


<span style="font-weight: bold;">// example of setting property directory using </span>
// <span style="font-weight: bold;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 's </span>XADataSource object
import org.apache.derby.jdbc.EmbeddedXADataSource;
import javax.sql.XADataSource;
<span style="font-weight: bold;">// dbname is the database name
// if create is true, create the database if not already created</span>
XADataSource makeXADataSource (String dbname, boolean create) 
{
    <span style="font-weight: bold;">//
    // If your application runs on JDK 1.6 or higher, then
    // you will use the JDBC4 variant of this class:
    // EmbeddedXADataSource40.
    //</span>
    EmbeddedXADataSource xads = new EmbeddedXADataSource();
<span style="font-weight: bold;">    // use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> 's setDatabaseName call</span>
    xads.setDatabaseName(dbname);
    if (create)
        xads.setCreateDatabase("create");
    return xads;
}</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Setting the property does not create or shut down the database. The database
is not actually created or shut down until the next connection request. </div></div></div></div><div><a name="N19CEF"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevcsecuree"></a><div></div>Derby and Security</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can be
deployed in a number of ways and in a number of different environments. The
security needs of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
are also diverse.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supplies or supports
the following optional security mechanisms:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">User authentication</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> verifies
user names and passwords before permitting them access to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">User authorization</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A means of granting specific users permission
to read a database or to write to a database.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Disk encryption</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A means of encrypting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> data
stored on disk.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Validation of Certificate for Signed Jar Files</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a Java 2
environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> validates
certificates for classes loaded from signed jar files.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">Network encryption and authentication</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
network traffic may be encrypted with SSL/TLS. SSL/TLS certificate
authentication is also supported. See <span style="font-style: italic;">"Network encryption and authentication with SSL/TLS"</span> in the
<span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span> for
details.</div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The following figure shows some of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> security
mechanisms at work in a client/server environment. User authentication is
performed by accessing an LDAP Directory Service. The data in the database
is not encrypted in this trusted environment.<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 10. </span>Example
of using an LDAP Directory Service in a trusted environment.</div><div>&nbsp;</div><div><img src="security_os.jpg" alt="This figure shows user authentication from an LDAP directory service to the Derby engine and user authorization to read and write data. The Derby database is a trusted environment and the data is not encrypted."></div><div></div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The following figure shows how another <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> security
mechanism, disk encryption, protects data when the recipient might not know
how to protect data. It is useful for databases deployed in an embedded environment.<div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 11. </span>Example of using disk encryption to protect data.</div><div>&nbsp;</div><div><img src="security2_os.jpg" alt="This figure shows disk encryption between the Derby engine and the database."></div><div></div></div></div></div><div><a name="N19E90"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure12392"></a><div></div>Configuring security for your environment</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In most cases, you enable <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
security features through the use of properties. It is important to understand
the best way of setting properties for your environment.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N19EBA"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not come with a built-in superuser. For that reason, be careful when configuring <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> for user authentication
and user authorization. </div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>When first working with security, work with system-level properties only
so that you can easily override them if you make a mistake. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Be sure to create at least one valid user, and grant that user full (read-write)
access. For example, you might always want to create a user called <span style="font-style: italic;">sa</span> with
the password <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span></span> while
you are developing. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Test the authentication system while it is still configured at the system
level. Be absolutely certain that you have configured the system correctly
before setting the properties as database-level properties.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Before disabling system-level properties (by setting <span style="font-style: italic;">derby.database.propertiesOnly</span> to
true), test that at least one database-level read-write user (such as <span style="font-style: italic;">sa</span>)
is valid. If you do not have at least one valid user that the system can authenticate,
you will not be able to access your database.</div></td></tr></table></div></div></div><div><a name="N19FA9"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevcsecure82556"></a><div></div>Configuring security in a client/server environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This procedure requires a system with multiple databases and some
administrative resources.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Configure security features as system properties.  See
<span style="color: blue;"><a href="#cdevsetprop824451">Scope of properties</a></span> and 
<span style="color: blue;"><a href="#cdevsetprop16827">Setting system-wide properties</a></span>.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Provide administrative-level protection for the <span style="font-style: italic;">derby.properties</span> file
and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases. For
example, you can protect these files and directories with operating system
permissions and firewalls.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Turn on user authentication for your system.  All users must provide
valid user IDs and passwords to access the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.
If you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in users, configure users for the system in the <span style="font-style: italic;">derby.properties</span> file.
Provide the protection for this file.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div></div></div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Configure user authorization for sensitive databases in your system.
 Only designated users will be able to access sensitive databases. You typically
configure user authorization with database-level properties. It is also possible
to configure user authorization with system-level properties. This is useful
when you are developing systems or when all databases have the same level
of sensitivity.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Check and if necessary configure your Derby network security 
according to your environment. See the section "Network client security" in the
<span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Server and Administration Guide</span></span></span>.</span></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1A03B"></a><span></span></div></div></div><div><a name="N1A08B"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="tdevcsecure81850"></a><div></div>Configuring security in an embedded environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In an embedded environment, typically there is only one database
per system and there are no administrative resources to protect databases.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1A09D"></a><span></span>To configure security in an embedded environment:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Encrypt the database when you create it.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Configure all security features as database-level properties. 
These properties are stored in the database (which is encrypted). See
<span style="color: blue;"><a href="#cdevsetprop824451">Scope of properties</a></span> and 
<span style="color: blue;"><a href="#cdevsetprop12821">Setting database-wide properties</a></span> for more
information.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Turn on protection for database-level properties so that they cannot
be overridden by system properties by setting the <span style="font-style: italic;">derby.database.propertiesOnly</span> property
to TRUE. See the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for details
on this property.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">To prevent unauthorized users from accessing databases once they
are booted, turn on user authentication for the database and configure user
authorization for the database.</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">If you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in users, configure each user as a database-level property so that user
names and passwords can be encrypted.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div></div></div></div></td></tr></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1A10C"></a><span></span></div></div></div></div><div><a name="N1A15C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure42374"></a><div></div>Working with user authentication</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
support for user authentication. <span style="border-right-width: 0pt; border-left-width: 0pt;">User authentication</span> means that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> authenticates the name
and password for a user before allowing that user access to the system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When user authentication is enabled (which it is not by default), the user
requesting a connection must provide a valid name and password, which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> verifies against the
repository of users defined for the system. After <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> authenticates
the user, it grants the user access to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
but not necessarily access to the database made in the connection request.
In the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, access
to a database is determined by <span style="color: blue;"><a href="#cdevcsecure36595">user
authorization</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For user authentication, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows
you to provide a repository of users in a number of different ways. For example,
you can hook <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> up to
an external directory service elsewhere in your enterprise, create your own
directory service, or use <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
simple mechanism for creating a built-in repository of users.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on an
external directory service such as LDAP or a user-defined class for
authentication. It is also strongly recommended that production systems protect
network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can define a repository of users for a particular database or for an
entire system, depending on whether you use system-wide or database-wide properties.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user authentication
is enabled and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
an external directory service, the architecture looks something like that
shown in the figure below. </div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 12. </span><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user
authentication using an external service. The application can be a single-user
application with an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
or a multi-user application server.</div><div>&nbsp;</div><div><img src="authentic_os.jpg" alt="This figure shows Derby handling user authentication using an external service."></div><div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> always runs embedded
in another Java application, whether that application is a single-user application
or a multiple-user application server or connectivity framework. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A database can be accessed by only one JVM at a time, so it is possible
to deploy a system in which the application in which <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
embedded, not <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, handles
the user authentication by connecting to an external directory service. </div><div style="margin-top: 0.8em; margin-bottom: 0.8em; margin-left: 72pt;"><div style="font-weight: bold;"><span style="color: red;">Figure 13. </span>The application provides the user authentication
using an external service. The application can be a single-user application
with an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
or a multi-user application server.</div><div>&nbsp;</div><div><img src="appauth_os.jpg" alt="This figure shows the application handling user authentication using an external service."></div><div></div></div></div><div><a name="N1A35C"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure36127"></a><div></div>Enabling user authentication</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To enable user authentication, set the <span style="font-style: italic;">derby.connection.requireAuthentication</span> property
to true. Otherwise, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not require a user name and password. You can set this property as a system-wide
property or as a database-wide property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For a multi-user product, you would typically set it for the system in
the <span style="font-style: italic;">derby.properties</span> file for your server, since it is in a trusted
environment.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you start a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
with user authentication enabled but without defining at least one user, you
will not be able to shut down the system gracefully. When <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running in a connectivity server and user authentication is turned on, stopping
the server requires a user name and password. You will need to alter shutdown
scripts accordingly. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  
  Additionally, if you create and start
  a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
  with user authentication and
  <span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
  both enabled, or plan to enable them later,
  you should make sure you create
  the database by connecting as the user that is to become the
  <span style="color: blue;"><a href="#cdevcsecureDbOwner">database
    owner</a></span>. 
  
  If you neglect to supply a user when the database is created, the
  database owner will by default become "APP". If you later enable
  both authentication and SQL authorization and "APP" is a not valid
  user name, you will not be able to perform operations restricted to
  the database owner, including shutting down the database (as opposed
  to the full system which may currently be shut down by any
  authenticated user, see previous note). Nor will you be able to
  (re)encrypt the database nor perform a full upgrade of it.
</div></div></div><div><a name="N1A427"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure37817"></a><div></div>Defining users</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
several ways to define the repository of users and passwords. To specify which
of these services to use with your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
set the property <span style="font-style: italic;">derby.authentication.provider</span> to the appropriate value
as discussed here.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Setting the property as a system-wide property creates system-wide users.
Setting the property as a database-wide property creates users for a single
database only.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="color: blue;"><a href="#cdevcsecure38522">External directory service</a></span>: <span style="color: blue;"><a href="#cdevcsecure41285">LDAP directory service</a></span>.
This includes Windows NT domain user authentication through the Netscape NT
Synchronization Service.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="color: blue;"><a href="#cdevcsecure21561">User-defined class</a></span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="color: blue;"><a href="#cdevcsecure21547">Built-in Derby users</a></span></div></td></tr></table></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Shutting down the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
(for example, using the <span style="font-style: italic;">shutdown=true</span> form of the connection URL without
specifying a particular database) when user authentication is turned on requires
that you define at least one user as a system-wide user.</div></div></div><div><a name="N1A51D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure38522"></a><div></div>External directory service</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A directory service stores names and attributes of those names.
A typical use for a directory service is to store user names and passwords
for a computer system. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
the Java naming and directory interface (JNDI) to interact with external directory
services that can provide authentication of users' names and passwords.</div></div><div><a name="N1A5E6"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure41285"></a><div></div>LDAP directory service</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can allow <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
authenticate users against an existing LDAP directory service within your
enterprise. LDAP (lightweight directory access protocol) provides an open
directory access protocol running over TCP/IP. An LDAP directory service can
quickly authenticate a user's name and password.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The runtime library provided with the Java Development Kit (JDK) includes
libraries that allow you to access an LDAP directory service.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use an LDAP directory service, set <span style="font-style: italic;">derby.authentication.provider</span> to
<span style="font-style: italic;">LDAP</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Examples of LDAP service providers include the 389 Directory Server and
OpenLDAP.</div></div><div><a name="N1A681"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure863446"></a><div></div>Setting up Derby to use your LDAP directory service: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When specifying LDAP as your authentication service, you must specify
what LDAP server to use.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">derby.authentication.server</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set the property <span style="font-style: italic;">derby.authentication.server</span> to
the URL to the LDAP server. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.authentication.server=ldap://godfrey:389/</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The LDAP server may be specified using just the server name, the server name
and its port number separated by a colon, or a ldap URL. If a full URL is not provided, 
Derby will by default use unencrypted LDAP - to use SSL encrypted LDAP an URL
starting with "ldaps://" must be provided.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Also note that support for ldaps:// URLs requires that Derby runs on Java 1.4.2 or higher.</div></div></td></tr></table></div></div></div><div><a name="N1A6FF"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure876908"></a><div></div>Guest access to search for DNs: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In an LDAP system, users are hierarchically organized in the directory
as a set of entries. An <span style="font-style: italic;">entry</span> is a set of name-attribute pairs identified
by a unique name, called a DN (distinguished name).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An entry is unambiguously identified by a DN, which is the concatenation
of selected attributes from each entry in the tree along a path leading from
the root down to the named entry, ordered from right to left. For example,
a DN for a user might look like this:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">cn=mary,ou=People,o=FlyTours.com

uid=mary,ou=People,o=FlyTours.com</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The allowable entries for the name are defined by the entry's <span style="font-style: italic;">objectClass</span>. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An LDAP client can bind to the directory (successfully log in) if it provides
a user ID and password. The user ID must be a DN, the fully qualified list
of names and attributes. This means that the user must provide a very long
name.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, the user knows only a simple user name (e.g., the first part
of the DN above, <span style="font-style: italic;">mary</span>). With <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
you do not need the full DN, because an LDAP client (<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>)
can go to the directory first as a guest or even an anonymous user, search
for the full DN, then rebind to the directory using the full DN (and thus
authenticate the user).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> typically initiates
a search for a full DN before binding to the directory using the full DN for
user authentication. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does
not initiate a search in the following cases:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You have set <span style="font-style: italic;">derby.authentication.ldap.searchFilter</span> to <span style="font-style: italic;">derby.user</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>A user DN has been cached locally for the specific user with the <span style="font-style: italic;">derby.user.UserName</span> property.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information, see "<span style="font-style: italic;">derby.authentication.ldap.searchFilter</span>" in
the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Some systems permit anonymous searches; other require a user DN and password.
You can specify a user's DN and password for the search with the properties
listed below. In addition, you can limit the scope of the search by specifying
a filter (definition of the object class for the user) and a base (directory
from which to begin the search) with the properties listed below. </div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">derby.authentication.ldap.searchAuthDN (optional)</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies
the DN with which to bind (authenticate) to the server when searching for
user DNs. This parameter is optional if anonymous access is supported by your
server. If specified, this value must be a DN recognized by the directory
service, and it must also have the authority to search for the entries.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If
not set, it defaults to an anonymous search using the root DN specified by
the <span style="font-style: italic;">derby.authentication.ldap.searchBase</span> property. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">uid=guest,o=FlyTours.com</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">derby.authentication.ldap.searchAuthPW (optional)</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies
the password to use for the guest user configured above to bind to the directory
service when looking up the DN. If not set, it defaults to an anonymous search
using the root DN specified by the <span style="font-style: italic;">derby.authentication.ldap.searchBase</span> property.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">myPassword</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">derby.authentication.ldap.searchBase (optional)</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Specifies
the root DN of the point in your hierarchy from which to begin a guest search
for the user's DN. For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ou=people,o=FlyTours.com</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When
using Netscape Directory Server, set this property to the root DN, the special
entry to which access control does not apply (optional).</div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To narrow the search, you can specify a user's <span style="font-style: italic;">objectClass</span>.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">derby.authentication.ldap.searchFilter (optional)</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set <span style="font-style: italic;">derby.authentication.ldap.searchFilter</span> to
a logical expression that specifies what constitutes a user for your LDAP
directory service. The default value of this property is <span style="font-family: Courier;">objectClass=inetOrgPerson</span>.
For example:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">objectClass=person</div></pre></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for details on all
these properties.</div></div></div><div><a name="N1A86B"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure863546"></a><div></div>LDAP performance issues: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">For performance reasons, the LDAP directory server should be in
the same LAN as <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not cache the user's
credential information locally and thus must connect to the directory server
every time a user connects.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Connection requests that provide the full DN are faster than those that
must search for the full DN.</div></div></div><div><a name="N1A8D2"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure863676"></a><div></div>LDAP restrictions: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not
support LDAP groups.</div></div></div></div><div><a name="N1A92D"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure864242"></a><div></div>JNDI-specific properties for external directory services</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> allows
you to set a few advanced JNDI properties, which you can set in any of the
supported ways of setting <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties.
Typically you would set these at the same level (database or system) for which
you configured the external authentication service.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The list of supported properties can be found in Appendix A: JNDI Context
Environment in the Java Naming and Directory API at <span><span style="font-style: italic;">http://java.sun.com/products/jndi/reference/api/index.html</span></span>.
The external directory service must support the property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Each JNDI provider has its set of properties that you can set within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, you can set the property <span style="font-style: italic;">java.naming.security.authentication</span> to
allow user credentials to be encrypted on the network if the provider supports
it. You can also specify that SSL be used with LDAP (LDAPS).</div></div></div><div><a name="N1A9C3"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure21561"></a><div></div>User-defined class</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Set <span style="font-style: italic;">derby.authentication.provider</span> to the full name of a
class that implements the public interface <span style="font-style: italic;">org.apache.derby.authentication.UserAuthenticator</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By writing your own class that fulfills some minimal requirements, you
can hook <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> up to an <span style="font-style: italic;">external
authentication service</span> other than LDAP. To do so, specify an external
authentication service by setting the property <span style="font-family: Courier;"><span style="font-style: italic;">derby.authentication.provider</span></span> to
a class name that you want <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
load at startup.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The class that provides the external authentication service must implement
the public interface <span style="font-style: italic;">org.apache.derby.authentication</span>.<span style="font-style: italic;">UserAuthenticator</span> and
throw exceptions of the type <span style="font-style: italic;">java.sql.SQLException</span> where appropriate.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Using a user-defined class makes <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> adaptable
to various naming and directory services.</div></div><div><a name="N1AA86"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="rdevexudclass"></a><div></div>Example of setting a user-defined class: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A very simple example of a class that implements the <span style="font-style: italic;">org.apache.derby.authentication.UserAuthenticator </span> interface.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1AAB0"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import org.apache.derby.authentication.UserAuthenticator;
import java.io.FileInputStream;
import java.util.Properties;
import java.sql.SQLException;
<span style="font-weight: bold;">/**
  * A simple example of a specialized Authentication scheme.
  * The system property 'derby.connection.requireAuthentication'
  * must be set
  * to true and 'derby.authentication.provider' must
  * contain the full class name of the overriden authentication
  * scheme,  i.e., the name of this class.
  *
  * @see org.apache.derby.authentication.UserAuthenticator 
  */</span>

public class MyAuthenticationSchemeImpl implements
UserAuthenticator {
    private static final String USERS_CONFIG_FILE = "myUsers.cfg";
    private static Properties usersConfig;

   <span style="font-weight: bold;"> // Constructor
    // We get passed some Users properties if the 
    //authentication service could not set them as 
    //part of System properties.
    //</span>
    public MyAuthenticationSchemeImpl() {
    }
<span style="font-weight: bold;">    /* static block where we load the users definition from a
users configuration file.*/</span>

    static {
<span style="font-weight: bold;">       /* load users config file as Java properties
        File must be in the same directory where
        <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>  gets started.
       (otherwise full path must be specified) */</span>
       FileInputStream in = null;
       usersConfig = new Properties();
       try {
           in = new FileInputStream(USERS_CONFIG_FILE);
           usersConfig.load(in);
           in.close();
       } catch (java.io.IOException ie) {
           // No Config file. Raise error message
           System.err.println(
             "WARNING: Error during Users Config file
retrieval");
           System.err.println("Exception: " + ie);
       }
    }
<span style="font-weight: bold;">    /**
     * Authenticate the passed-in user's credentials.
     * A more complex class could make calls
     * to any external users directory.
     *
     * @param userName               The user's name
     * @param userPassword           The user's password 
     * @param databaseName           The database 
     * @param infoAdditional jdbc connection info.
     * @exception SQLException on failure
     */</span>
    public boolean authenticateUser(String userName,
     String userPassword,
     String databaseName,
     Properties info)
       throws SQLException 
    {
 <span style="font-weight: bold;">      /* Specific Authentication scheme logic.
        If user has been authenticated, then simply return.
        If user name and/or password are invalid, 
        then raise the appropriate exception.
            
       This example allows only users defined in the
       users config properties object.

       Check if the passed-in user has been defined for the system.
       We expect to find and match the property corresponding to
       the credentials passed in. */</span>
       if (userName == null)
          <span style="font-weight: bold;"> // We do not tolerate 'guest' user for now.
       </span>    return false;
<span style="font-weight: bold;">       //
       // Check if user exists in our users config (file)
       // properties set.
       // If we did not find the user in the users config set, then
       // try to find if the user is defined as a System property.
       //</span>
       String actualUserPassword;
       actualUserPassword = usersConfig.getProperty(userName);
       if (actualUserPassword == null)
           actualUserPassword = System.getProperty(userName);
       if (actualUserPassword == null)
            <span style="font-weight: bold;">// no such passed-in user found</span>
            return false;
            <span style="font-weight: bold;">// check if the password matches</span>
       if (!actualUserPassword.equals(userPassword))
       return false;
       <span style="font-weight: bold;">// Now, check if the user is a valid user of the database</span>
       if (databaseName != null)
       {
             <span style="font-weight: bold;">/* if database users restriction lists present, then check 
            if there is one for this database and if so, 
            check if the user is a valid one of that database.
            For this example, the only user we authorize in database
            DarkSide is user 'DarthVader'. This is the only database
            users restriction list we have for this example.
            We authorize any valid (login) user to access the
            OTHER databases in the system.
            Note that database users ACLs could be set in the same
            properties file or a separate one and implemented as you
            wish. */</span>
            <span style="font-weight: bold;">//</span>
           if (databaseName.equals("DarkSide")) {
              <span style="font-weight: bold;">// check if user is a valid one.</span>
              if (!userName.equals("DarthVader"))
                  <span style="font-weight: bold;">// This user is not a valid one of the passed-in</span>
                  return false;
           }
       }
       <span style="font-weight: bold;">// The user is a valid one in this database</span>
       return true;
    }
}</div></pre></div></div></div></div></div><div><a name="N1AB3D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure21547"></a><div></div>Built-in Derby users</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
a simple, built-in repository of user names and passwords.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use the built-in repository, set <span style="font-style: italic;">derby.authentication.provider</span> to <span style="font-style: italic;">BUILTIN</span>.
Using built-in users is an alternative to using an external directory service
such as LDAP.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.authentication.provider=BUILTIN</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can create user names and passwords for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> users
by specifying them with the <span style="font-style: italic;">derby.user.UserName</span> property.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  These user names are case-sensitive for user authentication. User names
are <span style="font-style: italic;">SQL92Identifiers</span>. Delimited identifiers are allowed:   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.user."FRed"=java</div></pre></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  For passwords, it is a good idea not to use words that would be easily
guessed, such as a login name or simple words or numbers. A password should
be a mix of numbers and upper- and lowercase letters.</div></div><div><a name="N1AC52"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure864642"></a><div></div>Database-level properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you create users with database-level properties, those users
are available to the specified database only.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You set the property once for each user. To delete a user, set that user's
password to null.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- adding the user sa with password '<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass'</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.sa', '<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass')
<span style="font-weight: bold;">-- adding the user mary with password 'little7xylamb'</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.mary', 'little7xylamb')
<span style="font-weight: bold;">-- removing mary by setting password to null</span>
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.mary', null)</div></pre></div></div><div><a name="N1ACBA"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure864692"></a><div></div>System-level properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you create users with system-level properties, those users
are available to all databases in the system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You set the value of this system-wide property once for each user, so you
can set it several times. To delete a user, remove that user from the file.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can define this property in the usual ways -- typically in the <span style="font-style: italic;">derby.properties</span> file.
For more information about setting properties, see 
<span style="color: blue;"><a href="#cdevsetprop34818">Working with Derby properties</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is a sample excerpt from the <span style="font-style: italic;">derby.properties</span> file:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;"># Users definition
#</span>
derby.user.sa=<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>pass
derby.user.mary=little7xylamb</div></pre></div></div></div><div><a name="N1AD2E"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevcsecure557"></a><div></div>List of user authentication properties</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This table summarizes the various properties related to user authentication.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 11. </span>User authentication properties</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Property Name</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Use</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.connection.requireAuthentication</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Turns on user authentication.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.authentication.provider</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Specifies the kind of user authentication to use.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.authentication.server</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>For LDAP user authentication, specifies the location of
the server.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.authentication.ldap.searchAuthDN, derby.authentication.ldap.searchAuthPW,
derby.authentication.ldap.searchFilter,</span> and <span style="font-style: italic;">derby.authentication.ldap.searchBase</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Configures the way that DN searches are performed.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.user.UserName</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Creates a user name and password for the built-in user
repository in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">derby.authentication.builtin.algorithm</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Specifies the message digest algorithm to use to protect the
passwords that are stored in the database when using built-in
authentication.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div><span style="font-style: italic;">java.naming.*</span></div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>JNDI properties. See Appendix A in the JNDI API reference
for more information about these properties.</div></td></tr></tbody></table></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1AE26"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div></div></div></div></div><div><a name="N1AEAB"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure79358"></a><div></div>Programming applications for Derby user authentication</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses programming user authentication into applications
for use with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div><div><a name="N1AF65"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure766"></a><div></div>Programming the application to provide the user and password</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In the <span style="font-style: italic;">DriverManager.getConnection</span> call, an application
can provide the user name and password in the following ways.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1AFA3"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Separately as arguments to the following signature of the method: <span style="font-style: italic;">getConnection(String
url, String user, String password)</span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "mary", "little7xylamb");</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>As attributes to the database connection URL   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB;user=mary;password=little7xylamb");</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>By setting the user and password properties in a Properties object as
with other connection URL attributes   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Properties p = new Properties();
p.put("user", "mary");
p.put("password", "little7xylamb");
Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", p);</div></pre></div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1AFD1"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The password is not encrypted. When you are using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
the context of a server framework, the framework should be responsible for
encrypting the password across the network. If your framework does not encrypt
the password, consider using SSL. </div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1AFE0"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information about the treatment of user names within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, see <span style="color: blue;"><a href="#cdevcsecure37241">Users and authorization identifiers</a></span>.</div></div></div></div><div><a name="N1B025"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure305"></a><div></div>Login failure exceptions with user authentication</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If user authentication is turned on and a valid user name and password
are not provided, <span style="font-style: italic;">SQLException</span> 08004 is raised.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1B03D"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ERROR 08004: Connection refused : Invalid authentication.</div></pre></div></div></div></div></div><div><a name="N1B075"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure37241"></a><div></div>Users and authorization identifiers</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">User names within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system
are known as <span style="font-style: italic;">authorization identifiers</span>. The authorization identifier
is a string that represents the name of the user, if one was provided in the
connection request.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, the built-in function CURRENT_USER returns the authorization
identifier for the current user.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once the authorization identifier is passed to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
it becomes an <span style="font-style: italic;">SQL92Identifier</span>. <span style="font-family: Courier;"><span style="font-style: italic;">SQL92Identifiers</span></span>-the
kind of identifiers that represent database objects such as tables and columns-are
case-insensitive (they are converted to all caps) unless delimited with double
quotes, are limited to 128 characters, and have other limitations.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">User names must be valid authorization identifiers even if user authentication
is turned off, and even if all users are allowed access to all databases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about <span style="font-style: italic;">SQL92Identifiers</span>, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div><div><a name="N1B1AB"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure24458"></a><div></div>Authorization identifiers, user authentication, and user authorization</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When working with both user authentication and user authorization,
you need to understand how user names are treated by each system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If an external authentication system is used, the conversion of the user's
name to an authorization identifier does not happen until <span style="font-style: italic;">after</span> authentication
has occurred but <span style="font-style: italic;">before</span> user authorization. Imagine, for example, a
user named Fred.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Within the user authentication system, Fred is known as <span style="font-style: italic;">FRed</span>. Your
external user authorization service is case-sensitive, so Fred must always
type his name that way.   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "FRed", "flintstone");</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user
authorization system, Fred becomes a case-insensitive authorization identifier.
Fred is known as <span style="font-style: italic;">FRED</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>When specifying which users are authorized to access the accounting database,
you must list Fred's authorization identifier, <span style="font-style: italic;">FRED</span> (which you can
type as <span style="font-style: italic;">FRED</span>, <span style="font-style: italic;">FREd</span>, or <span style="font-style: italic;">fred</span>, since the system automatically
converts it to all-uppercase).   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">derby.fullAccessUsers=sa,FRED,mary</span></div></pre></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Let's take a second example, where Fred has a slightly different name within
the user authentication system.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Within the user authentication system, Fred is known as <span style="font-style: italic;">Fred!</span>.
You must now put double quotes around the name, because it is not a valid <span style="font-family: Courier;"><span style="font-style: italic;">SQL92Identifier</span></span>.
(<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> knows to remove
the double quotes when passing the name to the external authentication system.)
  <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">Connection conn = DriverManager.getConnection(
    "jdbc:derby:myDB", "\"Fred!\"", "flintstone");</div></pre></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> user
authorization system, <span style="font-style: italic;">Fred</span> becomes a case-sensitive authorization identifier.
Fred is known as <span style="font-style: italic;">Fred!</span>.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>When specifying which users are authorized to access the accounting database,
you must list Fred's authorization identifier, <span style="font-style: italic;">"Fred!"</span> (which you must
always delimit with double quotation marks).   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">derby.fullAccessUsers=sa,"Fred!",manager</div></pre></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">As shown in the first example, your external authentication system may
be case-sensitive, whereas the authorization identifier within <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> may
not be. If your authentication system allows two distinct users whose names
differ by case, delimit all user names within the connection request to make
all user names case-sensitive within the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system.
In addition, you must also delimit user names that do not conform to <span style="font-style: italic;">SQL92Identifier</span> rules
with double quotes.</div></div></div><div><a name="N1B2F5"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecureDbOwner"></a><div></div>Database owner
</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
  The term <span style="font-style: italic;">database owner</span> refers to the current authorization
  identifier when the database is created, that is, the user creating
  the database. If you enable or plan to enable SQL authorization,
  controlling the identity of the database owner becomes important.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
    When a database is created, the database owner of that database
    gets implicitly set to the authorization identifier used in the
    connect operation which creates the database, for example by
    supplying the URL attribute "user".  Note that this applies even
    if authentication is not (yet) enabled.  In SQL, the built-in
    functions USER and the equivalent CURRENT_USER return the current
    authorization identifier.
  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
    If the database is created <span style="font-style: italic;">without</span> supplying a user (only
    possible if authentication is not enabled), the database owner
    gets set to the default authorization identifier, "APP", which is
    also the name of the default schema, see the section "SET
    SCHEMA statement" in
    the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.
  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
    The database owner has automatic SQL level permissions when
    SQL authorization is enabled, see more about this
    in <span style="color: blue;"><a href="#cdevcsecure36595">User authorizations</a></span>.
  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
    To further enhance security, when <span style="font-style: italic;">both</span><span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
    and SQL authorization are enabled for a
    database, Derby restricts some special powers to the database
    owner: only the database owner is allowed to
    <span style="color: blue;"><a href="#tdevdvlp40464">shut down</a></span>
    the database, to
    <span style="color: blue;"><a href="#tdevcsecureunencrypteddb">encrypt</a></span>
    or
    <span style="color: blue;"><a href="#tdevcsecurenewkeyoverview">reencrypt</a></span>
    the database or to perform a
    <span style="color: blue;"><a href="#tdevupgradedb">full upgrade</a></span>
    of it. These powers can not be delegated.
  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Attention: </span>  
      There is currently no way of changing the database owner once
      the database is created. This means that if you plan to run with
      SQL authorization enabled, you should make sure to create the
      database as the user you want to be the owner.
    </div></div></div></div><div><a name="N1B3DC"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure865580"></a><div></div>User names and schemas</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">User names can affect a user's default schema.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information about user names and schemas, see "SET SCHEMA statement"
in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span><span style="font-style: italic;">.</span></div></div></div><div><a name="N1B451"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevcsecure622"></a><div></div>Exceptions when using authorization identifiers</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Specifying an invalid authorization identifier in a database user
authorization property raises an exception. Specifying an invalid authorization
identifier in a connection request raises an exception.</div></div></div></div><div><a name="N1B4AF"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure36595"></a><div></div>User authorizations</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you specify user authorizations, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> verifies
that a user has been granted permission to access a system, database, object,
or SQL action. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There are two types of user authorization in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
connection authorization and SQL authorization. <span style="border-right-width: 0pt; border-left-width: 0pt;">Connection authorization</span> specifies
the access that users have to connect to a system or database. <span style="border-right-width: 0pt; border-left-width: 0pt;">SQL authorization</span> controls
the permissions that users have on database objects or for SQL actions. You
can set the user authorization properties in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> as
system-level properties or database-level properties.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Set system-level user authorizations when you are developing applications,
or when you want to specify a secure default authorization for all users to
connect to all of the databases in the system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">There are several properties that you can set to control database-level
user authorizations. Some of the properties are general properties that set
the access mode for all users. Other properties are user specific properties
that set the type of access for specific user IDs.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The properties that affect authorization are:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div> The <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property controls
the default access mode. Use the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
to specify the default connection access that users have when they connect
to the database. If you do not explicitly set the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property,
the default user authorization for a database is <span style="font-style: italic;">fullAccess</span>,
which is read-write access.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The <span style="font-family: Courier;">derby.database.fullAccessUsers</span> and <span style="font-family: Courier;">derby.database.readOnlyAccessUsers</span> properties
are user specific properties. Use these properties to specify the user IDs
that have read-write access and read-only access to a database.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property enables
SQL standard authorization. Use the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
to specify if object owners can grant and revoke permission for users to perform
SQL actions on database objects. The default setting for the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
is <span style="font-style: italic;">FALSE</span>. When the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
is set to <span style="font-style: italic;">TRUE</span>, object owners can use the GRANT and REVOKE
SQL statements to set the user permissions for specific database objects or
for specific SQL actions. </div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you do not specify the user authorizations for a specific user ID, the
user ID inherits whatever authorization is set as the default user authorization
for the database.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Tip: </span>  If you set the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
to <span style="font-style: italic;">noAccess</span> or <span style="font-style: italic;">readOnlyAccess</span>, you should
allow at least one user read-write access. Otherwise, depending on the default
connection authorization you specify, you will configure the database so that
it cannot be accessed or changed.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1B5E1"></a><span></span><div style="font-weight: bold;">How user authorization properties work together</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
and the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property work together.
The default settings for these properties allow anyone to access and drop
the database objects that you create. You can change the default access mode
by specifying different settings for these properties.<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>When the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property is <span style="font-style: italic;">FALSE</span>,
the ability to read from or write to database objects is determined by the
setting for the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property.
If the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property is set
to <span style="font-style: italic;">readOnlyAccess</span>, users can access all of the database
objects but they cannot update or drop the objects. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>When the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property is <span style="font-style: italic;">TRUE</span>,
the ability to read from or write to database objects is further restricted
to the owner of the database objects. The owner must grant permission for
others to access the database objects. No one but the owner of an object or
the
<span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
can drop the object. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The access mode specified for the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
overrides the permissions that are granted by the owner of a database object.
For example, if a user is granted INSERT privileges on a table but the user
only has read-only connection authorization, the user cannot insert data into
the table.</div></td></tr></table></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1B645"></a><span></span><div style="font-weight: bold;">Changes to connection authorization settings</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Connection
authorization properties are fixed for the duration of a connection. If you
change the connection authorization properties during a connection, those
changes are not in affect until you establish a new connection.</div></div></div><div><a name="N1B736"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure865818"></a><div></div>Setting the default connection access mode</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Use the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
to specify the default type of access that users have when they connect to
the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The valid settings for the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property
are:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">noAccess</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">readOnlyAccess</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">fullAccess</span></div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you do not specify a setting for the <span style="font-family: Courier;">derby.database.defaultConnectionMode</span> property,
the default access setting is <span style="font-style: italic;">fullAccess</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To set the default connection access mode, specify the access in a CALL
statement. For example:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To specify read-write access for the system administrator userID <span style="font-family: Courier;">sa</span> and
the read-only as the default access for anyone else who connects to the database,
issue these CALL statements:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', 'sa')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultConnectionMode',
    'readOnlyAccess')
</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify read-write access for the user ID Fred and no access for other
users, issue these CALL statements:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', 'Fred')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultConnectionMode',
    'noAccess')
</div></pre></div></div><div><a name="N1B802"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure865880"></a><div></div>Setting access for individual users</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Use the <span style="font-family: Courier;">derby.database.fullAccessUsers</span> and <span style="font-family: Courier;">derby.database.readOnlyAccessUsers</span> properties
to specify the user IDs that have read-write access and read-only access to
a database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specify multiple user IDs by using a comma-separated list, with
no spaces between the comma and the next user ID.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To set the user authorizations for individual users, specify the access
in a CALL statement. For example:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To specify read-write access for the system administrator user ID <span style="font-family: Courier;">sa</span> and
for the user ID <span style="font-family: Courier;">maria</span>, issue this CALL statement:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', 'sa,maria')
</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To specify read-only access for a guest user ID and for Fred, issue this
CALL statement:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.readOnlyAccessUsers', 'guest,Fred')</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">To specify read-write access for the user ID "Elena!", use delimited identifiers
for the user ID. For example: <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers', '"Elena!"')
</div></pre></div></div><div><a name="N1B8DD"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure190"></a><div></div>Read-only and full access permissions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The actions that users can perform on a Derby database is determined
by the type of access that users have to the database objects.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1B90B"></a><span></span>The following table lists the actions that users can perform based
on the type of access that a user is granted on a database. These actions
apply to regular databases, source databases, and target databases.</div><div><div style="font-weight: bold;"><span style="color: red;">Table 12. </span>Actions that are authorized
by type of access</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Action</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Read-only access</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: left; padding: 2pt; background-color: silver; margin-left: 2pt;"><div>Full access </div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Executing SELECT statements</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Reading database properties</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Loading database classes from jar files</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Executing INSERT, UPDATE, or DELETE statements</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>&nbsp;</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Executing DDL statements</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>&nbsp;</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Adding or replacing jar files</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>&nbsp;</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Setting database properties</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>&nbsp;</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>X</div></td></tr></tbody></table></div></div></div><div><a name="N1BA1F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure379"></a><div></div>User authorization exceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">SQL exceptions are returned when errors occur with user authorizations.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1BA4D"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> validates
the database properties when you set the properties. An exception is returned
if you specify an invalid value when you set these properties. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a user
attempts to connect to a database but is not authorized to connect to that
database, the SQLException 04501 is returned. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a user with read-only
access attempts to write to a database, the SQLException 08004 <span style="font-family: Courier;">- connection
refused</span> is returned.</div></div></div></div></div><div><a name="N1BA95"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure866060"></a><div></div>Setting the SQL standard authorization mode</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Use the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
to enable SQL standard authorization.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property controls
the ability for object owners to grant and revoke permission for users to
perform actions on database objects. It also controls the ability for users
to create, set, and drop roles.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The valid settings for the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
are:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">TRUE</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">FALSE</span></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default setting for the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
is <span style="font-style: italic;">FALSE</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property is usable only
if the property <span style="font-family: Courier;">derby.connection.requireAuthentication</span> is also
set to true, since SQL authorization is of no value unless authentication is
also enabled.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">After you set the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
to <span style="font-style: italic;">TRUE</span>, you cannot set the property back to <span style="font-style: italic;">FALSE</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can set the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
as a system property or as a database property. If you set this property as
a system property before you create the databases, all new databases will
automatically have SQL authorization enabled. If the databases already exists,
you can set this property only as a database property.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To enable SQL standard authorization for the entire system, set the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
as a system property:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">derby.database.sqlAuthorization=true</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To enable SQL standard authorization for a specific database, set the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
as a database property:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.sqlAuthorization',
    'true')
</div></pre></div><div><a name="N1BBD4"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecuregrantrevokeaccess"></a><div></div>Using SQL standard authorization</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When the SQL standard authorization mode is enabled, object owners
can use the GRANT and REVOKE SQL statements to set the user privileges for
specific database objects or for specific SQL actions. They can also use roles
to administer privileges.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The SQL standard authorization mode is a SQL2003 compatible access control
system. You enable the SQL standard authorization mode by setting the <span style="font-family: Courier;">derby.database.sqlAuthorization</span> property
to <span style="font-family: Courier;">TRUE</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">While <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> has a simpler
database access mode which can be set to provide users with <span style="font-style: italic;">full</span>, <span style="font-style: italic;">read-only</span>,
or <span style="font-style: italic;">no access</span> authorization, this simpler access mode is
less appropriate for most client-server database configurations. When users
or applications issue SQL statements directly against the database, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> SQL authorization mode
provides a more precise mechanism to limit the actions that users can take
on the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The GRANT statement is used to grant specific privileges to users or to
roles, or to grant roles to users or to roles. The
REVOKE statement is used to revoke privileges and role grants. The grant and
revoke privileges are:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DELETE</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>EXECUTE</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>INSERT</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>SELECT</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>REFERENCES</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>TRIGGER</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>UPDATE</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a table, view, function, or procedure is created, the person that
creates the object is referred to as the <span style="border-right-width: 0pt; border-left-width: 0pt;">owner</span> of the object.
Only the object owner and the
<span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
have full privileges on the object.
No other users have privileges on the object until the object owner grants
privileges to them.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another way of saying that privileges on objects belong to the owner is to
call them <span style="border-right-width: 0pt; border-left-width: 0pt;">definer rights</span>, as opposed to <span style="border-right-width: 0pt; border-left-width: 0pt;">invoker rights</span>.
This is the terminology used by the SQL standard.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span> for more
information on the GRANT and REVOKE statements.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1BCD9"></a><span></span><div style="font-weight: bold;">Public and individual user privileges</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The object
owner can grant and revoke privileges for specific users, for specific roles,
or for all users.
The keyword PUBLIC is used to specify all users. When PUBLIC is specified,
the privileges affect all current and future users. The privileges granted
and revoked to PUBLIC and to individual users or roles are independent. For example,
a SELECT privilege on table <span style="font-family: Courier;">t</span> is granted to both PUBLIC and
to the user <span style="font-family: Courier;">harry</span>. The SELECT privilege is later revoked
from user <span style="font-family: Courier;">harry</span>, but user <span style="font-family: Courier;">harry</span> has access
to table <span style="font-family: Courier;">t</span> through the PUBLIC privilege.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Exception: </span>  When you create a view, trigger, or constraint, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> first
checks to determine if you have the required privileges at the user level.
If you have the user-level privileges, the object is created and is dependent
on that user-level privilege. If you do not have the required privileges at
the user-level, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checks
to determine if you have the required privileges at the PUBLIC level. If you
have the PUBLIC level privileges, the object is created and is dependent on
that PUBLIC level privilege. After the object is created, if the privilege
on which the object depends is revoked, the object is automatically dropped. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not try to determine
if you have other privileges that can replace the privileges that are being
revoked. <div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Example 1</span></div><div style="margin-left: 72pt + 16pt;">User <span style="font-family: Courier;">zhi</span> creates table <span style="font-family: Courier;">t1</span> and grants
SELECT privileges to user <span style="font-family: Courier;">harry</span> on table <span style="font-family: Courier;">t1</span>.
User <span style="font-family: Courier;">zhi</span> grants SELECT privileges to PUBLIC on table <span style="font-family: Courier;">t1</span>.
User <span style="font-family: Courier;">harry</span> creates view <span style="font-family: Courier;">v1</span> with the statement
<span style="font-family: Courier;">SELECT * from zhi.t1</span>. The view depends on the user-level
privilege that user <span style="font-family: Courier;">harry</span> has on <span style="font-family: Courier;">t1</span>. Subsequently,
user <span style="font-family: Courier;">zhi</span> revokes SELECT privileges from user <span style="font-family: Courier;">harry</span> on
table <span style="font-family: Courier;">t1</span>. As a result, the view <span style="font-family: Courier;">harry.v1</span> is
dropped.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Example 2</span></div><div style="margin-left: 72pt + 16pt;">User <span style="font-family: Courier;">anita</span> creates table <span style="font-family: Courier;">t1</span> and grants
SELECT privileges to PUBLIC. User <span style="font-family: Courier;">harry</span> creates view <span style="font-family: Courier;">v1</span> with
the statement <span style="font-family: Courier;">SELECT * from anita.t1</span>. The view depends on
the PUBLIC level privilege that user <span style="font-family: Courier;">harry</span> has on <span style="font-family: Courier;">t1</span>, since
user <span style="font-family: Courier;">harry</span> does not have user-level privileges on table <span style="font-family: Courier;">t1</span> when
he creates the view <span style="font-family: Courier;">harry.v1</span>. Subsequently, user <span style="font-family: Courier;">anita</span> grants
SELECT privileges to user <span style="font-family: Courier;">harry</span> on table <span style="font-family: Courier;">anita.t1</span>.
The view <span style="font-family: Courier;">harry.v1</span> continues to depend on the PUBLIC level privilege
that user <span style="font-family: Courier;">harry</span> has on <span style="font-family: Courier;">t1</span>. When user <span style="font-family: Courier;">anita</span> revokes
SELECT privileges from PUBLIC on table <span style="font-family: Courier;">t1</span>, the view <span style="font-family: Courier;">harry.v1</span> is
dropped.</div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See
<span style="color: blue;"><a href="#cdevcsecureprivileges">Privileges on views, triggers, and constraints</a></span> for
more information.</div></div></div></div></div><div><a name="N1BE5B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecureprivileges"></a><div></div>Privileges on views, triggers, and constraints</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Views, triggers, and constraints operate with the privileges of the
owner of the view, trigger, or constraint.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose that user <span style="font-family: Courier;">anita</span> wants to create a view
using the following statement:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CREATE VIEW s.v(vc1,vc2,vc3)
	AS SELECT t1.c1,t1.c2,f(t1.c3)
  FROM t1 JOIN t2 ON t1.c1 = t2.c1 
	WHERE t2.c2 = 5</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">User <span style="font-family: Courier;">anita</span> needs the following privileges to create the
view:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Ownership of the schema <span style="font-family: Courier;">s</span>, so that she can create something
in the schema</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Ownership of the table <span style="font-family: Courier;">t1</span>, so that she can allow others
to see columns in the table</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>SELECT privilege on column <span style="font-family: Courier;">t2.c1</span> and column
<span style="font-family: Courier;">t2.c2</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>EXECUTE privilege on function <span style="font-family: Courier;">f</span></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When the view is created, only user <span style="font-family: Courier;">anita</span> has the SELECT
privilege on it. User <span style="font-family: Courier;">anita</span> can grant the SELECT privilege on
any or all of the columns of view <span style="font-family: Courier;">s.v</span> to anyone, even to users
that do not have the SELECT privilege on <span style="font-family: Courier;">t1</span> or
<span style="font-family: Courier;">t2</span>, or the EXECUTE privilege on <span style="font-family: Courier;">f</span>. User
<span style="font-family: Courier;">anita</span> then grants the SELECT privilege on view
<span style="font-family: Courier;">s.v</span> to user <span style="font-family: Courier;">harry</span>. When user
<span style="font-family: Courier;">harry</span> issues a SELECT statement on the view
<span style="font-family: Courier;">s.v</span>, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
checks to determine if user <span style="font-family: Courier;">harry</span> has the SELECT privilege on
view <span style="font-family: Courier;">s.v</span>.
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not check to
determine if user <span style="font-family: Courier;">harry</span> has the SELECT privilege on
<span style="font-family: Courier;">t1</span> or <span style="font-family: Courier;">t2</span>, or the EXECUTE privilege on
<span style="font-family: Courier;">f</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Privileges on triggers and constraints work the same way as privileges on
views. When a view, trigger, or constraint is created,
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> checks that the owner
has the required privileges. Other users do not need to have those privileges
to perform actions on a view, trigger, or constraint.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the required privileges are revoked from the owner of a view, trigger,
or constraint, the object is dropped as part of the REVOKE statement.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Another way of saying that privileges on objects belong to the owner is to
call them <span style="border-right-width: 0pt; border-left-width: 0pt;">definer rights</span>, as opposed to <span style="border-right-width: 0pt; border-left-width: 0pt;">invoker rights</span>.
This is the terminology used by the SQL standard.</div></div></div><div><a name="N1BFEC"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecureroles"></a><div></div>Using SQL roles</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When the SQL standard authorization mode is enabled, object owners
can use the SQL roles facility to administer privileges.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">SQL roles are useful for administering privileges when a database has many
users. Roles provide a more powerful way to grant privileges to users' sessions
than to grant privileges to each user of the database, which easily becomes
tedious and error-prone when many users are involved. Roles do not in and of
themselves give better database security, but used correctly, they facilitate
better security. Only the
<span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
can create, grant, revoke, and drop roles. However, object owners can grant and
revoke privileges for those objects to and from roles, as well as to and from
individual users and PUBLIC (all users).</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> implements a
subset of SQL roles. The fact that only the database owner can create, grant,
revoke, and drop roles is an implementation restriction.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C03A"></a><span></span><div style="font-weight: bold;">Creating and granting roles</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Roles are available only when SQL authorization mode is enabled (that is,
when the property <span style="font-family: Courier;">derby.database.sqlAuthorization</span> is set to
<span style="font-family: Courier;">TRUE</span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Old databases must be (hard) upgraded to at least Release 10.5 before roles
can be used.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If SQL authorization mode is enabled, the database owner can use the
CREATE ROLE statement to create roles. The database owner can then use the GRANT
statement to grant a role to one or more users, to PUBLIC, or to another role.
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A role A <span style="font-style: italic;">contains</span> another role B if role B is granted to role A, or is
contained in a role C granted to role A. Privileges granted to a contained role
are inherited by the containing roles. So the set of privileges identified by
role A is the union of the privileges granted to role A and the privileges
granted to any contained roles of role A.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, suppose the database owner issued the following statements:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">  create role reader;
  create role updater;
  create role taskLeaderA;
  create role taskLeaderB;
  create role projectLeader;
  grant reader to updater;
  grant updater to taskLeaderA;
  grant updater to taskLeaderB;
  grant taskLeaderA to projectLeader;
  grant taskLeaderB to projectLeader;
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The roles would then have the following containment relationships:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">                   reader
                     |
                     v
                  updater
                 /       \
       taskLeaderA       taskLeaderB
                 \       /
               projectLeader  
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In this case, the <span style="font-family: Courier;">projectLeader</span> role contains all the other
roles and has all their privileges. If the database owner then revokes
<span style="font-family: Courier;">updater</span> from <span style="font-family: Courier;">taskLeaderA</span>,
<span style="font-family: Courier;">projectLeader</span> still contains that role through
<span style="font-family: Courier;">taskLeaderB</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The SYSCS_DIAG.CONTAINED_ROLES diagnostic table function can be used to
determine the set of contained roles for a role.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cycles are not permitted in role grants. That is, if a role contains another
role, you cannot grant the container role to the contained role. For example,
the following statement would not be permitted:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">grant projectLeader to updater;</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C0B3"></a><span></span><div style="font-weight: bold;">Setting roles</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a user first connects to
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, no role is set, and
the CURRENT_ROLE function returns null. During a session, the user can call the
SET ROLE statement to set the current role for that session. The role can be
any role that has been granted to the session's current user or to PUBLIC. To
unset the current role, call SET ROLE with an argument of NONE. At any time
during a session, there is always a current user, but there is a current role
only if SET ROLE has been called with an argument other than NONE. If a current
role is not set, the session has only the privileges granted to the user
directly or to PUBLIC.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, if the database owner created and granted the roles shown in the
previous session, a user would have to issue a SET ROLE statement to have them
take effect. Suppose a user issued the following statement:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SET ROLE taskLeaderA;</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Assuming that the database owner had granted the <span style="font-family: Courier;">taskLeaderA</span>
role to the user, the user would be allowed to set the role as shown and would
have all the privileges granted to the <span style="font-family: Courier;">taskLeaderA</span>,
<span style="font-family: Courier;">updater</span>, and <span style="font-family: Courier;">reader</span> roles.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To retrieve the current role identifier in SQL, call the CURRENT_ROLE
function.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Within stored procedures and functions that contain SQL, the current role is
on the authorization stack. Initially, inside a nested connection, the current
role is set to that of the calling context. Upon return from the stored
procedure or function, the authorization stack is popped, so the current role
of the calling context is not affected by any setting of the role inside the
called procedure or function. If the stored procedure opens more than one
nested connection, these all share the same (stacked) current role state. Any
dynamic result set passed out of a stored procedure sees the current role of
the nested context.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C0F9"></a><span></span><div style="font-weight: bold;">Granting privileges to roles</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Once a role has been created, both the database owner and the object owner
can grant privileges on tables and routines to that role. You can grant the same
privileges to roles that you can grant to users. Granting a privilege to a role
implicitly grants privileges to all roles that contain that role. For example,
if you grant delete privileges on a table to <span style="font-family: Courier;">updater</span>, every
user in the <span style="font-family: Courier;">updater</span>, <span style="font-family: Courier;">taskLeaderA</span>,
<span style="font-family: Courier;">taskLeaderB</span>, and <span style="font-family: Courier;">projectLeader</span> role will also
have delete privileges on that table, but users in the <span style="font-family: Courier;">reader</span>
role will not.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C12B"></a><span></span><div style="font-weight: bold;">Revoking privileges from a role</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Either the database owner or the object owner can revoke privileges from a
role.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a privilege is revoked from a role A, that privilege is no longer held
by role A, unless A otherwise inherits that privilege from a contained role.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If a privilege to an object is revoked from role A, a session will lose that
privilege if it has a current role set to A or a role that contains A, unless
one or more of the following is true:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The privilege is granted directly to the current user</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The privilege is granted to PUBLIC</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The privilege is also granted to another role B in the current role's set of
contained roles</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The session's current user is the database owner or the object owner</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C15B"></a><span></span><div style="font-weight: bold;">Revoking roles</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database owner can use the REVOKE statement to revoke a role from a user,
from PUBLIC, or from another role.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a role is revoked from a user, that session can no longer keep that
role, nor can it take on that role in a SET ROLE statement, unless the role is
also granted to PUBLIC. If that role is the current role of an existing session,
the current privileges of the session lose any extra privileges obtained through
setting that role.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default drop behavior is CASCADE. Therefore, all persistent objects
(constraints, views and triggers) that rely on that role are dropped. Although
there may be other ways of fulfilling that privilege at the time of the revoke,
any dependent objects are still dropped. This is an implementation limitation.
Any prepared statement that is potentially affected will be checked again on the
next execute. A result set that depends on a role will remain open even if that
role is revoked from a user.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When a role is revoked from a role, the default drop behavior is also
CASCADE. Suppose you revoke role A from role B. Revoking the role will have the
effect of revoking all additional applicable privileges obtained through A from
B. Roles that contain B will also lose those privileges, unless A is still
contained in some other role C granted to B, or the privileges come through some
other role. See
<span style="color: blue;"><a href="#rolecreategrant">Creating and granting roles</a></span>
for an example.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C180"></a><span></span><div style="font-weight: bold;">Dropping roles</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Only the database owner can drop a role. To drop a role, use the DROP ROLE
statement.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Dropping a role effectively revokes all grants of this role to users and
other roles.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C193"></a><span></span><div style="font-weight: bold;">Further information</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For details on the following statements, functions, and system table related
to roles, see the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>CREATE ROLE statement</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>SET ROLE statement</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DROP ROLE statement</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>GRANT statement</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>REVOKE statement</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>CURRENT_ROLE function</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>SYSCS_DIAG.CONTAINED_ROLES table function</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>SYSROLES system table</div></td></tr></table></div></div></div></div></div><div><a name="N1C21B"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecuresqlauthexceptions"></a><div></div>SQL standard authorization exceptions</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">SQL exceptions are returned when errors occur with SQL
authorization.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C249"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following errors can result from the CREATE ROLE statement:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot create a role if you are not the database owner. An attempt to do
so raises the <span style="font-style: italic;">SQLException</span> 4251A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot create a role if a role with that name already exists. An attempt
to do so raises the <span style="font-style: italic;">SQLException</span> X0Y68.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot create a role name if there is a user by that name. An attempt to
create a role name that conflicts with an existing user name raises the
<span style="font-style: italic;">SQLException</span> X0Y68.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>A role name cannot start with the prefix SYS (after case normalization). Use
of the prefix SYS raises the <span style="font-style: italic;">SQLException</span> 4293A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot create a role with the name PUBLIC (after case normalization).
PUBLIC is a reserved authorization identifier. An attempt to create a role with
the name PUBLIC raises <span style="font-style: italic;">SQLException</span> 4251B.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following errors can result from the DROP ROLE statement:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot drop a role if you are not the database owner. An attempt to do
so raises the <span style="font-style: italic;">SQLException</span> 4251A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot drop a role that does not exist. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 0P000.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following errors can result from the SET ROLE statement:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot set a role if you are not the database owner. An attempt to do so
raises the <span style="font-style: italic;">SQLException</span> 4251A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot set a role that does not exist. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 0P000.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot set a role when a transaction is in progress. An attempt to do so
raises the <span style="font-style: italic;">SQLException</span> 25001.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot use NONE or a malformed identifier as a string or
<span style="font-family: Courier;">?</span> argument to SET ROLE. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> XCXA0.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following errors can result from the GRANT statement:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot grant a role if you are not the database owner. An attempt to do
so raises the <span style="font-style: italic;">SQLException</span> 4251A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot grant a role that does not exist. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 0P000.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot grant the role "PUBLIC". An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 4251B.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot grant a role if doing so would create a circularity by granting
a container role to a contained role. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 4251C.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following errors can result from the REVOKE statement:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot revoke a role if you are not the database owner. An attempt to do
so raises the <span style="font-style: italic;">SQLException</span> 4251A.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot revoke a role that does not exist. An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 0P000.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You cannot revoke the role "PUBLIC". An attempt to do so raises the
<span style="font-style: italic;">SQLException</span> 4251B.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For all statements, an attempt to specify an identifier argument more than
128 characters long raises the <span style="font-style: italic;">SQLException</span> 42622.</div></div></div></div></div></div><div><a name="N1C395"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure24366"></a><div></div>Encrypting databases on disk</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
a way for you to encrypt your data on disk.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Typically, database systems encrypt and decrypt data in transport over
the network, using industry-standard systems. This system works well for client/server
databases; the server is assumed to be in a trusted, safe environment, managed
by a system administrator. In addition, the recipient of the data is trusted
and should be capable of protecting the data. The only risk comes when transporting
data over the wire, and data encryption happens during network transport only.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">However, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases
are platform-independent files that are designed to be easily shared in a
number of ways, including transport over the Internet. Recipients of the data
might not know how, or might not have the means, to properly protect the data.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This data encryption feature provides the ability to store user data in
an encrypted form. The user who boots the database must provide a boot password.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  Jar files stored in the database are not encrypted.</div></div><div><a name="N1C4B7"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure96815"></a><div></div>Requirements for Derby encryption</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports disk
encryption and requires an encryption provider. An encryption provider
implements the Java cryptography concepts. The JRE for J2SE 1.4 and
higher includes Java Cryptographic Extensions (JCE <span style="color: blue;"><a href="http://java.sun.com/products/jce/index.html">http://java.sun.com/products/jce/index.html</a></span>)
and one or more default encryption providers.
</div></div></div><div><a name="N1C565"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure97760"></a><div></div>Working with encryption</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section describes using encryption in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></div><div><a name="N1C603"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure88690"></a><div></div>Encrypting databases on creation</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You configure a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
for encryption when you create the database by specifying the <span style="font-style: italic;">dataEncryption=true</span> attribute
on the connection URL.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"> The Java Runtime Environment (JRE) determines the default encryption provider,
as follows:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>For J2SE/J2EE 1.4 or higher, the JRE's provider is the default.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If your environment for some reason does not include a provider, it must be specified.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You have the option of specifying an alternate encryption provider. The
default encryption algorithm is DES, but you have the option of specifying
an alternate algorithm as well. See <span style="color: blue;"><a href="#cdevcsecure31493">Specifying an alternate encryption provider</a></span></div></div></div><div><a name="N1C6C2"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevcsecureunencrypteddb"></a><div></div>Encrypting an existing unencrypted database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can encrypt an unencrypted <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
by specifying attributes on the connection URL when you boot the database.
The attributes that you specify depend on how you want the database encrypted.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C6F6"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database is configured with log archival, you must disable log
archival and perform a shutdown before you can encrypt the database. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If there are any global transaction that are in the prepared state after
recovery, the database cannot be encrypted.</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1C708"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you encrypt an existing, unencrypted database, you can specify
whether the database should be encrypted using a boot password or an external
encryption key.  You can also specify the <span style="font-style: italic;">encryptionProvider</span> attribute
and the <span style="font-style: italic;">encryptionAlgorithm</span> attribute on the connection URL. The database
is configure with the specified encryption attributes and all of the existing
data in the database is encrypted. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Encrypting a database is a time
consuming process because it involves encrypting all of the existing data
in the database. If the process is interrupted before completion, all the
changes are rolled back the next time that the database is booted. If the
interruption occurs immediately after the database is encrypted but before
the connection is returned to the application, you might not be able to boot
the database without the boot password or external encryption key. In these
rare circumstances, you should try to boot the database with the boot password
or the external encryption key. </div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Recommendation: </span>  Ensure
that you have enough free disk space before you encrypt a database. In addition
to the disk space required for the current size of the database, temporary
disk space is required to store the old version of the data to restore the
database back to it's original state if the encryption is interrupted or returns
errors. All of the temporary disk space is released back to the operating
system after the database is encrypted.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To encrypt an existing unencrypted
database:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Specify the <span style="font-style: italic;">dataEncryption=true</span> attribute and either the <span style="font-style: italic;">encryptionKey</span> attribute
or the <span style="font-style: italic;">bootPassword</span> attribute in a URL and boot the database.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, to encrypt the <span style="font-family: Courier;">salesdb</span> database with
the boot password <span style="font-family: Courier;">abc1234xyz</span>, specify the following attributes
in the URL:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:salesdb;dataEncryption=true;bootPassword=abc1234xyz </div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
  If <span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
  and
  <span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
  are both enabled, the credentials of the 
  <span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
  must be supplied as well, since encryption is a restricted operation.
</div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
If you disabled log archival before you encrypted the database, create
a new backup of the database after the database is encrypted.</div></div></div></td></tr></table></div></div></div><div><a name="N1C7D8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure866716"></a><div></div>Creating the boot password</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you encrypt a database you must also specify a boot password,
which is an alpha-numeric string used to generate the encryption key.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The length of the encryption key depends on the algorithm used:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>AES (128, 192, and 256 bits)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DES (the default) (56 bits)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DESede (168 bits)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>All other algorithms (128 bits)</div></td></tr></table></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The boot password should have at least as many characters as number
of bytes in the encryption key (56 bits=8 bytes, 168 bits=24 bytes, 128 bits=16
bytes). The minimum number of characters for the boot password allowed by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is eight.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It is a good idea not to use words that would be easily guessed, such as
a login name or simple words or numbers. A <span style="font-style: italic;">bootPassword</span>, like any password,
should be a mix of numbers and upper- and lowercase letters.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You turn on and configure encryption and specify the corresponding boot
password on the connection URL for a database when you create it:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:encryptionDB1;create=true;dataEncryption=true;
    bootPassword=clo760uds2caPe</div></pre><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  If you lose the <span style="font-style: italic;">bootPassword</span> and the database is not currently
booted, you will not be able to connect to the database anymore. (If you know
the current <span style="font-style: italic;">bootPassword</span>, you can change it. See <span style="color: blue;"><a href="#tdevcsecurenewkeyoverview">Encrypting databases with a new key</a></span>.)</div></div><div><a name="N1C89E"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure31493"></a><div></div>Specifying an alternate encryption provider: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can specify an alternate provider when you create the database
with the <span style="font-family: Courier;"><span style="font-style: italic;">encryptionProvider=providerName</span></span> attribute.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You must specify the full package and class name of the provider, and you
must also add the libraries to the application's classpath.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- using the the provider library jce_jdk13-10b4.zip|
-- available from www.bouncycastle.org</span>
jdbc:derby:encryptedDB3;create=true;dataEncryption=true;
bootPassword=clo760uds2caPe;
encryptionProvider=org.bouncycastle.jce.provider.BouncyCastleProvider;
encryptionAlgorithm=DES/CBC/NoPadding

<span style="font-weight: bold;">-- using a provider
-- available from
-- http://jcewww.iaik.tu-graz.ac.at/download.html</span>
jdbc:derby:encryptedDB3;create=true;dataEncryption=true;
bootPassword=clo760uds2caPe;
encryptionProvider=iaik.security.provider.IAIK;encryptionAlgorithm=
DES/CBC/NoPadding</div></pre></div></div><div><a name="N1C925"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure67151"></a><div></div>Specifying an alternate encryption algorithm: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
the following encryption algorithms.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DES (the default)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>DESede (also known as triple DES)</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Any encryption algorithm that fulfills the following requirements:   <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>It is symmetric</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>It is a block cipher, with a block size of 8 bytes</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>It uses the <span style="font-style: italic;">NoPadding</span> padding scheme</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Its secret key can be represented as an arbitrary byte array</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>It requires exactly one initialization parameter, an initialization vector
of type <span style="font-style: italic;">javax.crypto.spec.IvParameterSpec</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>It can use <span style="font-style: italic;">javax.crypto.spec.SecretKeySpec</span> to represent its key</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, the algorithm <span style="font-style: italic;">Blowfish</span> implemented in the
Java Cryptography Extension (JCE) packages (<span style="font-style: italic;">javax.crypto.*</span>) fulfills
these requirements.</div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By Java convention, an encryption algorithm is specified like this:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;"><span style="font-style: italic;">algorithmName</span>/<span style="font-style: italic;">feedbackMode</span>/<span style="font-style: italic;">padding</span></span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The only feedback modes allowed are:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>CBC</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>CFB</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>ECB</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>OFB</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The only padding mode allowed is <span style="font-style: italic;">NoPadding</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">By default, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
the DES algorithm of <span style="font-style: italic;">DES/CBC/NoPadding</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify an alternate encryption algorithm when you create a database, use
the <span style="font-style: italic;">encryptionAlgorithm=algorithm</span> attribute. If the algorithm you specify
is not supported by the provider you have specified, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> throws
an exception.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To specify the AES encryption algorithm with a key length other than the
default of 128, specify the <span style="font-style: italic;">encryptionKeyLength</span> attribute. For example,
you might specify the following connection attributes:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">
jdbc:derby:encdbcbc_192;create=true;dataEncryption=true;
encryptionKeyLength=192;encryptionAlgorithm=AES/CBC/NoPadding;
bootPassword=Thursday
</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To use the AES algorithm with a key length of 192 or 256, you must use 
unrestricted policy jar files for your JRE. You can obtain these files from your
Java provider. They might have a name like "Java Cryptography Extension (JCE)
Unlimited Strength Jurisdiction Policy Files." If you specify a non-default key
length using the default policy jar files, a Java exception occurs.</div></div></div></div><div><a name="N1CA63"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="tdevcsecurenewkeyoverview"></a><div></div>Encrypting databases with a new key</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can apply a new encryption key to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
by specifying a new boot password or a new external key.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1CA97"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Encrypting a database with a new encryption key is a time consuming
process because it involves encrypting all of the existing data in the database
with the new encryption key. If the process is interrupted before completion,
all the changes are rolled back the next time that the database is booted.
If the interruption occurs immediately after the database is encrypted with
the new encryption key but before the connection is returned to the application,
you might not be able to boot the database with the old encryption key. In
these rare circumstances, you should try to boot the database with the new
encryption key. </div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Recommendation: </span>  Ensure that
you have enough free disk space before you encrypt a database with a new key.
In addition to the disk space required for the current size of the database,
temporary disk space is required to store the old version of the data to restore
the database back to it's original state if the new encryption is interrupted
or returns errors. All of the temporary disk space is released back to the
operating system after the database is reconfigured to work with the new encryption
key.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To encrypt a database with a new encryption key:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Use the type of encryption that is currently used to encrypt the
database:</span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>To <span style="color: blue;"><a href="#tdevcsecurenewbootpw">encrypt
the database with a new boot password key</a></span>, use the <span style="font-style: italic;">newBootPassword</span> attribute.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>To <span style="color: blue;"><a href="#tdevcsecurenewextkey">encrypt
the database with a new external encryption key</a></span>, use the <span style="font-style: italic;">newEncryptionKey</span> attribute.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
  If <span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
  and
  <span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
  are both enabled, the credentials of the 
  <span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
  must be supplied, since reencryption is a restricted operation.
</div></div></td></tr></table></div></div><div><a name="N1CB44"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="tdevcsecurenewbootpw"></a><div></div>Encrypting databases with a new boot password: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can apply a new boot password to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
by specifying the <span style="font-style: italic;">newBootPassword</span> attribute on the connection URL when
you boot the database.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1CB7E"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database is configured with log archival for roll-forward recovery,
you must disable log archival and perform a shutdown before you can encrypt
the database with a new boot password. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If there are any global transaction that are in the prepared state after
recovery, the database cannot be encrypted with a new boot password.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database is currently encrypted with an external encryption key,
you should use the <span style="color: blue;"><a href="#tdevcsecurenewextkey"><span style="font-style: italic;">newEncryptionKey</span></a></span> attribute
to encrypt the database.</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1CBA0"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you use the <span style="font-style: italic;">newBootPassword</span> attribute, a new encryption
key is generated internally by the engine and the key is protected using the
new boot password. The newly generated encryption key encrypts the database,
including the existing data. You cannot change the encryption provider or
encryption algorithm when you apply a new boot password.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To encrypt
a database  with a new boot password:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Specify the <span style="font-style: italic;">newBootPassword</span> attribute in a URL and reboot
the database.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, when the following URL is used when
the <span style="font-family: Courier;">salesdb</span> database is rebooted, the database is encrypted
with the new encryption key, and is protected by the password new1234xyz:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"> jdbc:derby:salesdb;bootPassword=abc1234xyz;newBootPassword=new1234xyz</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
    If <span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
    and
    <span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
    are both enabled, the credentials of the 
    <span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
    must be supplied as well, since reencryption is a restricted operation.
    </div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you disabled log archival before you applied the new boot
password, create a new backup of the database after the database is reconfigured
with the new boot password.</div></div></div></td></tr></table></div></div></div><div><a name="N1CC59"></a><div style="font-size: 11pt; font-weight: bold; margin-left: 72pt;"><a name="tdevcsecurenewextkey"></a><div></div>Encrypting databases with a new external encryption key: </div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can apply a new external encryption key to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
by specifying the <span style="font-style: italic;">newEncryptionKey</span> attribute on the connection URL
when you boot the database.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1CC93"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database is configured with log archival for roll-forward recovery,
you must disable log archival and perform a shutdown before you can encrypt
the database with a new external encryption key. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If there are any global transaction that are in the prepared state after
recovery, the database cannot be encrypted with a new encryption key.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>If the database is currently encrypted with a boot password , you should
use the <span style="color: blue;"><a href="#tdevcsecurenewbootpw"><span style="font-style: italic;">newBootPassword</span></a></span> attribute
to encrypt the database.</div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1CCB5"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">To encrypt a database with a new external encryption key:</div></div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">Specify the <span style="font-style: italic;">newEncryptionKey</span> attribute in a URL and reboot
the database.</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, when the following URL is used when
the <span style="font-family: Courier;">salesdb</span> database is rebooted, the database is encrypted
with the new encryption key 6862636465666768:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:salesdb;encryptionKey=6162636465666768;newEncryptionKey=6862636465666768'</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
  If <span style="color: blue;"><a href="#cdevcsecure36127">authentication</a></span>
  and
  <span style="color: blue;"><a href="#cdevcsecure36595">SQL authorization</a></span>
  are both enabled, the credentials of the 
  <span style="color: blue;"><a href="#cdevcsecureDbOwner">database owner</a></span>
  must be supplied as well, since encryption is a restricted operation.
  </div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If you disabled log archival before you applied the new encryption
key, create a new backup of the database after the database is reconfigured
with new the encryption key.
</div></div></div></td></tr></table></div></div></div></div><div><a name="N1CD63"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="cdevcsecure60146"></a><div></div>Booting an encrypted database</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If you create an encrypted database using the <span style="font-style: italic;">bootPassword</span> attribute,
you must specify the boot password to reboot the database. If you create an
encrypted database using the <span style="font-style: italic;">encryptionKey</span> attribute, you must specify
the <span style="font-style: italic;">encryptionKey</span> to reboot the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Encrypted databases cannot be booted automatically along with all other
system databases on system startup (see "<span style="font-style: italic;">derby.system.bootAll</span>" in the
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>). Instead, you boot encrypted
databases when you first connect to the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">Booting a database with the <span style="font-style: italic;">bootPassword</span> attribute</div><div style="margin-left: 72pt + 16pt;">To access an encrypted database called <span style="font-family: Courier;">wombat</span> that was
created with the boot password <span style="font-family: Courier;">clo760uds2caPe</span>, use the following
connection URL:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:wombat;bootPassword=clo760uds2caPe</div></pre></div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;">Booting a database with the <span style="font-style: italic;">encryptionKey</span> attribute</div><div style="margin-left: 72pt + 16pt;">To access an encrypted database called <span style="font-family: Courier;">flintstone</span> that
was created with the <span style="font-family: Courier;">encryptionKey=c566bab9ee8b62a5ddb4d9229224c678</span> and
with the <span style="font-family: Courier;">encryptionAlgorithm=AES/CBC/NoPadding</span>, use the following
connection URL:   <pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">jdbc:derby:flintstone;encryptionAlgorithm=AES/CBC/NoPadding;
encryptionKey=c566bab9ee8b62a5ddb4d9229224c678  </div></pre></div></div></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">After the database is booted, all connections can access the database without
the boot password. Only a connection that boots the database requires the
key.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">For example, the following connections would boot the database and require
the boot password or encryption key, depending on what mechanism was used
to encrypt the database originally:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The first connection to the database in the JVM session</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The first connection to the database after the database has been explicitly
shut down</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The first connection to the database after the system has been shut down
and then rebooted</div></td></tr></table></div></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The boot password and the encryption key are not meant to prevent unauthorized
connections to the database after the database is booted. To protect a database
after it has been booted, turn on user authentication (see <span style="color: blue;"><a href="#cdevcsecure42374">Working with user authentication</a></span>).</div></div></div></div></div><div><a name="N1CEA4"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure90988"></a><div></div>Signed jar files</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In a Java 2 environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> can
detect digital signatures on jar files. When attempting to load a class from
a signed jar file stored in the database, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will
verify the validity of the signature.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> class loader
only validates the integrity of the signed jar file and that the certificate
has not expired. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> cannot
ascertain whether the validity/identity of declared signer is correct. To
validate identity, use a Security Manager (i.e., an implementation of <span style="font-style: italic;">java.lang.SecurityManager</span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When loading classes from an application jar file in a Java 2 environment, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> behaves as follows: </div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">If the class is signed, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> will:</span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Verify that the jar was signed using a X.509 certificate (i.e., can be
represented by the class <span style="font-style: italic;">java.security.cert.X509Certificate</span>). If not,
throw an exception. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Verify that the digital signature matches the contents of the file. If
not, throw an exception. </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Check that the set of signing certificates are all valid for the current
date and time. If any certificate has expired or is not yet valid, throw an
exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Pass the array of certificates to the <span style="font-style: italic;">setSigners()</span> method of <span style="font-family: Courier;"><span style="font-style: italic;">java.lang.ClassLoader</span></span>.
This allows security managers to obtain the list of signers for a class (using <span style="font-family: Courier;"><span style="font-style: italic;">java.lang.Class.getSigners</span></span>)
and then validate the identity of the signers using the services of a Public
Key Infrastructure (PKI). </div></td></tr></table></div></div></td></tr></table></div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide
a security manager.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about signed jar files, see the Java 2 specifications
at <span><span style="font-style: italic;">http://java.sun.com</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about Java 2 security, go to <span><span style="font-style: italic;">http://java.sun.com/security/</span></span>.</div></div></div><div><a name="N1D050"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure10983"></a><div></div>Notes on the Derby security features</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> security
model has some basic limitations.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You lock out non full-access users with database properties, which are
stored in the database (and in an encrypted database these properties are
also encrypted). Note, however, for a distributed/embedded system that a sophisticated
user with the database encryption key might be able to physically change those
properties in the database files.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In addition, in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system,
it is not necessary to have a specific connection (or permission to access
a particular database) to shut down the system. Any authenticated user can
shut down the system.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Other security holes to think about are:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>JVM subversion, running the application under a home-grown JVM.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Trolling for objects</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Class substitution, locating a class that has access to sensitive data
and replacing it with one that passes on information</div></td></tr></table></div></div></div><div><a name="N1D143"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcsecure51876"></a><div></div>User authentication and authorization examples</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section provides examples on using user authentication and
authorization in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in
either a client/server environment or in an embedded environment.</div></div><div><a name="N1D209"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevcsecure125"></a><div></div>User authentication example in a client/server environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In this example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
running in a user-designed application server.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D221"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
the user authentication, not the application server. The server is running
in a secure environment, the application server encrypts the passwords, and
a database administrator is available. The administrator configures security
using system-level properties in the <span style="font-style: italic;">derby.properties</span> file and has
protected this file with operating system tools. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> connects
to an existing LDAP directory service within the enterprise to authenticate
users.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D23B"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default access mode for all databases is set to <span style="font-style: italic;">fullAccess</span> (the
default).</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D24A"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The <span style="font-style: italic;">derby.properties</span> file for the server includes the following
entries:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D259"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;"># turn on user authentication</span>
derby.connection.requireAuthentication=true
<span style="font-weight: bold;"># set the authentication provider to an external LDAP server</span>
derby.authentication.provider=LDAP
<span style="font-weight: bold;"># the host name and port number of the LDAP server</span>
derby.authentication.server=godfrey:389
<span style="font-weight: bold;"># the search base for user names</span>
derby.authentication.ldap.searchBase=o=oakland.mycompany.com
<span style="font-weight: bold;"># explicitly show the access mode for databases (this is default)</span>
derby.database.defaultConnectionMode=fullAccess</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D280"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With these settings, all users must be authenticated by the LDAP
server in order to access any <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D28F"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database administrator has determined that one database, <span style="font-style: italic;">accountingDB</span>,
has additional security needs. Within a connection to that database, the database
administrator uses database-wide properties (which override properties set
in the <span style="font-style: italic;">derby.properties</span> file) to limit access to this database. Only
the users <span style="font-style: italic;">prez</span>, <span style="font-style: italic;">cfo</span>, and <span style="font-style: italic;">numberCruncher</span> have full (read-write)
access to this database, and only <span style="font-style: italic;">clerk1</span> and <span style="font-style: italic;">clerk2</span> have read-only
access to this database. No other users can access the database.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D2C2"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.defaultConnectionMode', 'noAccess')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.fullAccessUsers',
    'prez,cfo,numberCruncher')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.readOnlyAccessUsers', 'clerk1,clerk2')</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D2D0"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The database administrator then requires all current users to
disconnect and re-connect. These property changes do not go into effect for
current connections. The database administrator can force current users to
reconnect by shutting down the database</div></div></div><div><a name="N1D318"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecureclientexample"></a><div></div>User authentication and authorization client example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example consists of a pair of programs,
<span style="font-family: Courier;">AuthExampleClient1.java</span> and
<span style="font-family: Courier;">AuthExampleClient2.java</span>, which show how to turn on, use, and
turn off user authentication using
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication and user authorization using the client
driver.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D33C"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example uses one program to set properties and a second program to
perform database operations. A similar example that uses the embedded
driver, in
<span style="color: blue;"><a href="#rdevcsecure26537">User authentication and authorization embedded example</a></span>, is a single long
program. Either example would work equally well in the other format.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See
<span style="color: blue;"><a href="#rdevcsecuresqlauthclientex">User authentication and SQL authorization client example</a></span>
for an example similar to this one that uses SQL authorization.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The first program, <span style="font-family: Courier;">AuthExampleClient1.java</span>, does the
following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Creates a database named <span style="font-family: Courier;">authClientDB</span>, using the client
driver.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Sets database properties that create users with different levels of access
(read-only and full access), require authentication, and set the default access
level to no access.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection and shuts down the database.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The second program, <span style="font-family: Courier;">AuthExampleClient2.java</span>, does the
following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database without a username and password, raising
an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with read-only access; the connection
succeeds, but an attempt to create a table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with full access; this user can create
and populate a table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Removes the table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection and shuts down the database.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Make sure that the <span style="font-family: Courier;">javac</span> command is in your path, then
compile the programs as follows:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleClient1.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleClient2.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before you run the programs, start the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network
Server as described in step 2 of "Activity 4: Create and run a JDBC program
using the client driver and Network Server" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span>. When you run the
programs, make sure that
<span style="font-family: Courier;">%DERBY_HOME%\lib\derbyclient.jar</span> (or
<span style="font-family: Courier;">$DERBY_HOME/lib/derbyclient.jar</span>) is in your classpath. For
example, you might use the following commands on a Windows system:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .;%DERBY_HOME%\lib\derbyclient.jar AuthExampleClient1</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .;%DERBY_HOME%\lib\derbyclient.jar AuthExampleClient2</span></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D401"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleClient1.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleClient1 {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.ClientDriver";
        String dbName="authClientDB";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName +
            ";create=true";
        Connection conn = null;

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derbyclient.jar " +
                "(${DERBY_HOME}/lib/derbyclient.jar).\n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Create and boot the database and set up users, then shut down
        // the database as one of the users with full access
        try {
            System.out.println("Trying to connect to " + connectionURL);
            conn = DriverManager.getConnection(connectionURL);
            System.out.println("Connected to database " + connectionURL);

            turnOnBuiltInUsers(conn);

            // Close connection
            conn.close();
            System.out.println("Closed connection");

            /* Shut down the database to make static properties take
             * effect. Because the default connection mode is now 
             * noAccess, you must specify a user that has access. But
             * because requireAuthentication does not take effect until
             * you restart the database, the password is not checked.
             *
             * Database shutdown throws the 08006 exception to confirm
             * success.
             */
            try {
                DriverManager.getConnection(
                    "jdbc:derby://localhost:1527/" + dbName + 
                    ";user=sa;password=badpass;shutdown=true");
            } catch (SQLException se)  {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (Throwable e) {
            errorPrintAndExit(e);
        }
    }

    /**
     * Turn on built-in user authentication and user authorization.
     *
     * @param conn a connection to the database.
     */
    public static void turnOnBuiltInUsers(Connection conn) 
            throws SQLException {

        String setProperty = 
            "CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(";
        String getProperty = 
            "VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(";
        String requireAuth = "'derby.connection.requireAuthentication'";
        String defaultConnMode =
            "'derby.database.defaultConnectionMode'";
        String fullAccessUsers = "'derby.database.fullAccessUsers'";
        String readOnlyAccessUsers =
            "'derby.database.readOnlyAccessUsers'";
        String provider = "'derby.authentication.provider'";
        String propertiesOnly = "'derby.database.propertiesOnly'";

        System.out.println("Turning on authentication.");
        Statement s = conn.createStatement();

        // Set and confirm requireAuthentication
        s.executeUpdate(setProperty + requireAuth + ", 'true')");
        ResultSet rs = s.executeQuery(getProperty + requireAuth + ")");
        rs.next();
        System.out.println("Value of requireAuthentication is " +
            rs.getString(1));

        // Set authentication scheme to Derby builtin
        s.executeUpdate(setProperty + provider + ", 'BUILTIN')");

        // Create some sample users
        s.executeUpdate(
            setProperty + "'derby.user.sa', 'ajaxj3x9')");
        s.executeUpdate(
            setProperty + "'derby.user.guest', 'java5w6x')");
        s.executeUpdate(
            setProperty + "'derby.user.mary', 'little7xylamb')");

        // Define noAccess as default connection mode
        s.executeUpdate(
            setProperty + defaultConnMode + ", 'noAccess')");

        // Confirm default connection mode
        rs = s.executeQuery(getProperty + defaultConnMode + ")");
        rs.next();
        System.out.println("Value of defaultConnectionMode is " +
            rs.getString(1));

        // Define read-write users
        s.executeUpdate(
            setProperty + fullAccessUsers + ", 'sa,mary')");

        // Define read-only user
        s.executeUpdate(
            setProperty + readOnlyAccessUsers + ", 'guest')");

        // Confirm full-access users
        rs = s.executeQuery(getProperty + fullAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of fullAccessUsers is " + rs.getString(1));

        // Confirm read-only users
        rs = s.executeQuery(getProperty + readOnlyAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of readOnlyAccessUsers is " + rs.getString(1));

        // We would set the following property to TRUE only when we were
        // ready to deploy. Setting it to FALSE means that we can always
        // override using system properties if we accidentally paint
        // ourselves into a corner.
        s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" +
            "'derby.database.propertiesOnly', 'false')");
        s.close();
    }

    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException)
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage());
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D415"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleClient2.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleClient2 {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.ClientDriver";
        String dbName="authClientDB";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName;
        Connection conn = null;

        // Restart database and confirm that unauthorized users cannot
        //  access it

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derbyclient.jar " +
                "(${DERBY_HOME}/lib/derbyclient.jar). \n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Try to log in with no username or password
        try {
            // connection attempt should fail
            System.out.println("Trying to connect to " + connectionURL +
                " without username or password");
            conn = DriverManager.getConnection(connectionURL);
            System.out.println(
                "ERROR: Unexpectedly connected to database " + dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with read-only access
        try {
            // connection should succeed, but create table should fail
            String newURL = connectionURL + 
                ";user=guest;password=java5w6x";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName +
                " with read-only access");

            Statement s = conn.createStatement();
            s.executeUpdate("CREATE TABLE t1(C1 VARCHAR(6))");
            System.out.println(
                "ERROR: Unexpectedly allowed to modify database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("25503")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with full access
        // Create, update, and query table
        try {
            // this should succeed
            String newURL = connectionURL + 
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();
            s.executeUpdate("CREATE TABLE T1(C1 VARCHAR(6))");
            System.out.println("Created table T1");
            s.executeUpdate("INSERT INTO T1 VALUES('hello')");

            ResultSet rs = s.executeQuery("SELECT * FROM T1");
            rs.next();
            System.out.println("Value of T1/C1 is " + rs.getString(1));
            s.executeUpdate("DROP TABLE T1");

            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        try {
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /** 
     * Close connection and shut down database.
     *
     * @param conn a connection to the database
     */
    public static void cleanUpAndShutDown (Connection conn)
            throws SQLException {

        String dbName="authClientDB";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName;

        try {
            conn.close();
            System.out.println("Closed connection");

            // As mary, shut down the database.
            try {
                String newURL = connectionURL + 
                    ";user=mary;password=little7xylamb;shutdown=true";
                DriverManager.getConnection(newURL);
            } catch (SQLException se)  {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException)
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage());
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div></div></div></div><div><a name="N1D446"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevcsecure13713"></a><div></div>User authentication example in a single-user, embedded environment</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">In this example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> is
embedded in a single-user application that is deployed in a number of different
and potentially insecure ways.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D45E"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For that reason, the application developer has decided to encrypt
the database and to turn on user authentication using <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication, which will not require connections to an LDAP
server. The end-user must know the <span style="font-style: italic;">bootPassword</span> to boot the database
and the user name and password to connect to the database. Even if the database
ended up in an e-mail, only the intended recipient would be able to access
data in the database. The application developer has decided not to use any
user authorization features, since each database will accept only a single
user. In that situation, the default full-access connection mode is acceptable.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D47E"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When creating the database, the application developer encrypts
the database by using the following connection URL:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D487"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">jdbc:derby:wombat;create=true;dataEncryption=true;
    bootPassword=sxy90W348HHn;user=redbaron</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D495"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before deploying the database, the application developer turns
on user authentication, sets the authentication provider to BUILTIN, creates
a single user and password, and disallows system-wide properties to protect
the database-wide security property settings:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D49E"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.connection.requireAuthentication', 'true')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.authentication.provider', 'BUILTIN')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.user.redbaron', 'red29PlaNe')

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(
    'derby.database.propertiesOnly', true')</span></div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D4AC"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When the user connects (and boots) the database, the user has
to provide the <span style="font-style: italic;">bootPassword</span>, the user name, and the password. 
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  
    The user name (the value specified by
    the <span style="font-family: Courier;">derby.user.<span style="font-style: italic;">enduser</span></span> property) must be
    supplied when the database is created, even if authentication is
    not yet enabled. Otherwise the database owner will have the
    default name "APP"
    (see <span style="color: blue;"><a href="#cdevcsecureDbOwner">Database owner</a></span> for
    details).
  </div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">
  The following example shows how to provide these properties in a
  connection URL, although the application programmer would probably
  provide GUI windows to allow the end user to type those in:
</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D4DC"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">jdbc:derby:wombat;bootPassword=sxy90W348HHn;
    user=redbaron;password=red29PlaNe</span></div></pre></div></div><div><a name="N1D529"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure26537"></a><div></div>User authentication and authorization embedded example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example, <span style="font-family: Courier;">AuthExampleEmbedded.java</span>,
shows how to turn on, use, and turn off user authentication using
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication and user authorization using the embedded
driver.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D547"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example is a single long program. A similar example that uses the client
driver, in
<span style="color: blue;"><a href="#rdevcsecureclientexample">User authentication and authorization client example</a></span>,
uses one program to set properties and a second program to perform database
operations. Either example would work equally well in the other format.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See 
<span style="color: blue;"><a href="#rdevcsecuresqlauthembeddedex">User authentication and SQL authorization embedded example</a></span>
for an example similar to this one that uses SQL authorization.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The program does the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and creates
a database named <span style="font-family: Courier;">authEmbDB</span>, using the embedded driver.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Sets database properties that create users with different levels of access
(read-only and full access), require authentication, and set the default access
level to no access.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection, then stops and restarts the database so that the
authentication changes can take effect.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database without a username and password, raising
an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with read-only access; the connection
succeeds, but an attempt to create a table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>6. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with full access; this user can create
and populate a table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>7. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Deletes the table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>8. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection, shuts down the database, then shuts down
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Make sure that the <span style="font-family: Courier;">javac</span> command is in your path, then
compile the program as follows:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleEmbedded.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you run <span style="font-family: Courier;">AuthExampleEmbedded</span>, make
sure that <span style="font-family: Courier;">%DERBY_HOME%\lib\derby.jar</span> (or
<span style="font-family: Courier;">$DERBY_HOME/lib/derby.jar</span>) is in your classpath. For example,
you might use the following command on a UNIX system:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .:${DERBY_HOME}/lib/derby.jar AuthExampleEmbedded</span></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D5E7"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleEmbedded.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleEmbedded {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.EmbeddedDriver";
        String dbName="authEmbDB";
        String connectionURL = "jdbc:derby:" + dbName + ";create=true";
        Connection conn = null;

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derby.jar " +
                "(${DERBY_HOME}/lib/derby.jar).\n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Create and boot the database and set up users, then shut down
        // the database as one of the users with full access
        try {
            System.out.println("Trying to connect to " + connectionURL);
            conn = DriverManager.getConnection(connectionURL);
            System.out.println("Connected to database " + connectionURL);

            turnOnBuiltInUsers(conn);

            // close the connection
            conn.close();
            System.out.println("Closed connection");

            /* Shut down the database to make static properties take
             * effect. Because the default connection mode is now 
             * noAccess, you must specify a user that has access. But
             * because requireAuthentication does not take effect until
             * you restart the database, the password is not checked.
             *
             * Database shutdown throws the 08006 exception to confirm
             * success.
             */
            try {
                DriverManager.getConnection("jdbc:derby:" + dbName +
                    ";user=sa;password=badpass;shutdown=true");
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        // Restart database and confirm that unauthorized users cannot
        //  access it
        connectionURL = "jdbc:derby:" + dbName;

        // Try to log in with no username or password
        try {
            // connection attempt should fail
            System.out.println("Trying to connect to " + connectionURL +
                " without username or password");
            conn = DriverManager.getConnection(connectionURL);
            System.out.println(
                "ERROR: Unexpectedly connected to database " + dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with read-only access
        try {
            // connection should succeed, but create table should fail
            String newURL = connectionURL + 
                ";user=guest;password=java5w6x";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName +
                " with read-only access");

            Statement s = conn.createStatement();
            s.executeUpdate("CREATE TABLE t1(C1 VARCHAR(6))");
            System.out.println(
                "ERROR: Unexpectedly allowed to modify database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("25503")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with full access
        // Create, update, and query table
        try {
            // this should succeed
            String newURL = connectionURL + 
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();
            s.executeUpdate("CREATE TABLE T1(C1 VARCHAR(6))");
            System.out.println("Created table T1");
            s.executeUpdate("INSERT INTO T1 VALUES('hello')");

            ResultSet rs = s.executeQuery("SELECT * FROM T1");
            rs.next();
            System.out.println("Value of T1/C1 is " + rs.getString(1));
            s.executeUpdate("DROP TABLE T1");

            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        try {
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }
    
    /**
     * Close connection and shut down database. Since this is embedded
     * mode, we must also shut down the Derby system.
     *
     * @param conn a connection to the database
     */
    public static void cleanUpAndShutDown (Connection conn)
            throws SQLException {

        String dbName="authEmbDB";
        String connectionURL = "jdbc:derby:" + dbName;

        try {
            conn.close();
            System.out.println("Closed connection");

            // As mary, shut down the database.
            try {
                String newURL = connectionURL + 
                    ";user=mary;password=little7xylamb;shutdown=true";
                DriverManager.getConnection(newURL);
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");

            try {
                DriverManager.getConnection("jdbc:derby:;shutdown=true");
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("XJ015") ) {
                    throw se;
                }
            }

            System.out.println("Derby system shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /**
     * Turn on built-in user authentication and user authorization.
     *
     * @param conn a connection to the database
     */
    public static void turnOnBuiltInUsers(Connection conn) 
            throws SQLException {

        String setProperty = 
            "CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(";
        String getProperty = 
            "VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(";
        String requireAuth = "'derby.connection.requireAuthentication'";
        String defaultConnMode =
            "'derby.database.defaultConnectionMode'";
        String fullAccessUsers = "'derby.database.fullAccessUsers'";
        String readOnlyAccessUsers =
            "'derby.database.readOnlyAccessUsers'";
        String provider = "'derby.authentication.provider'";
        String propertiesOnly = "'derby.database.propertiesOnly'";

        System.out.println("Turning on authentication.");
        Statement s = conn.createStatement();

        // Set and confirm requireAuthentication
        s.executeUpdate(setProperty + requireAuth + ", 'true')");
        ResultSet rs = s.executeQuery(getProperty + requireAuth + ")");
        rs.next();
        System.out.println("Value of requireAuthentication is " +
            rs.getString(1));

        // Set authentication scheme to Derby builtin
        s.executeUpdate(setProperty + provider + ", 'BUILTIN')");

        // Create some sample users
        s.executeUpdate(
            setProperty + "'derby.user.sa', 'ajaxj3x9')");
        s.executeUpdate(
            setProperty + "'derby.user.guest', 'java5w6x')");
        s.executeUpdate(
            setProperty + "'derby.user.mary', 'little7xylamb')");
 
        // Define noAccess as default connection mode
        s.executeUpdate(
            setProperty + defaultConnMode + ", 'noAccess')");

        // Confirm default connection mode
        rs = s.executeQuery(getProperty + defaultConnMode + ")");
        rs.next();
        System.out.println("Value of defaultConnectionMode is " +
            rs.getString(1));

        // Define read-write user
        s.executeUpdate(
            setProperty + fullAccessUsers + ", 'sa,mary')");

        // Define read-only user
        s.executeUpdate(
            setProperty + readOnlyAccessUsers + ", 'guest')");

        // Confirm full-access users
        rs = s.executeQuery(getProperty + fullAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of fullAccessUsers is " + rs.getString(1));

        // Confirm read-only users
        rs = s.executeQuery(getProperty + readOnlyAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of readOnlyAccessUsers is " + rs.getString(1));

        // We would set the following property to TRUE only when we were
        // ready to deploy. Setting it to FALSE means that we can always
        // override using system properties if we accidentally paint
        // ourselves into a corner.
        s.executeUpdate(setProperty + propertiesOnly + ", 'false')");
        s.close();
    }

    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException)
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage());
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div></div></div></div><div><a name="N1D618"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevcsecuresqlauthexs"></a><div></div>User authentication examples using SQL authorization</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">
These examples show how to use SQL authorization in 
conjunction with <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s 
built-in user authentication and user authorization.
</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D630"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">These examples are based on the examples in 
<span style="color: blue;"><a href="#rdevcsecureclientexample">User authentication and authorization client example</a></span> and 
<span style="color: blue;"><a href="#rdevcsecure26537">User authentication and authorization embedded example</a></span>.</div></div></div><div><a name="N1D68F"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecuresqlauthclientex"></a><div></div>User authentication and SQL authorization client example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example consists of a pair of programs,
<span style="font-family: Courier;">AuthExampleClientSQLAuth1.java</span> and
<span style="font-family: Courier;">AuthExampleClientSQLAuth2.java</span>, which show how to use SQL
authorization, in addition to 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication and user authorization, with the client driver.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D6B3"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example uses one program to set properties and a second program to
perform database operations. A similar example that uses the embedded
driver, in
<span style="color: blue;"><a href="#rdevcsecuresqlauthembeddedex">User authentication and SQL authorization embedded example</a></span>,
is a single long program. Either example would work equally well in the other
format.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See <span style="color: blue;"><a href="#cdevcsecure36595">User authorizations</a></span> for more
information on using SQL authorization, which allows you to use ANSI SQL
Standard GRANT and REVOKE statements. Compare this example to the one in
<span style="color: blue;"><a href="#rdevcsecureclientexample">User authentication and authorization client example</a></span>,
which does not use SQL authorization.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The first program, <span style="font-family: Courier;">AuthExampleClientSQLAuth1.java</span>, does the
following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Creates a database named <span style="font-family: Courier;">sqlAuthClientDB</span>, using the client
driver. The connection URL creates the database as the user
<span style="font-family: Courier;">mary</span>, who is therefore the database owner. After SQL
authorization is enabled, only the database owner will have the right to set and
read database properties.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Sets database properties that create users with different levels of access
(no access, read-only access, and full access), that require authentication, and
that turn on SQL authorization. The users <span style="font-family: Courier;">mary</span> and
<span style="font-family: Courier;">sqlsam</span> have full access.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection, then shuts down the database so that the
authentication and SQL authorization changes can take effect.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The second program, <span style="font-family: Courier;">AuthExampleClientSQLAuth2.java</span>, does the
following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database without a username and password, raising
an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database as a user with no access, raising an
exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with read-only access; the connection
succeeds, but an attempt to create a table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as <span style="font-family: Courier;">mary</span>, who has full access; this
user creates and populates a table. This user also grants select and insert
privileges on this table to another user.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as <span style="font-family: Courier;">sqlsam</span>, the user who has been
granted select and insert privileges by <span style="font-family: Courier;">mary</span>. This user has
full (that is, read-write) access on the connection level, but has limited
powers for this table because SQL authorization is active. The user successfully
performs select and insert operations on the table, but an attempt to delete a
row from the table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>6. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database again as <span style="font-family: Courier;">mary</span>, who then deletes
the table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>7. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Shuts down the database.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Make sure that the <span style="font-family: Courier;">javac</span> command is in your path, then
compile the programs as follows:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleClientSQLAuth1.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleClientSQLAuth2.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Before you run the programs, start the
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> Network
Server as described in step 2 of "Activity 4: Create and run a JDBC program
using the client driver and Network Server" in
<span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Getting Started with Java DB</span></span>. When you run the
programs, make sure that
<span style="font-family: Courier;">%DERBY_HOME%\lib\derbyclient.jar</span> (or
<span style="font-family: Courier;">$DERBY_HOME/lib/derbyclient.jar</span>) is in your classpath.  For
example, you might use the following commands on a UNIX system:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .:${DERBY_HOME}/lib/derbyclient.jar AuthExampleClientSQLAuth1</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .:${DERBY_HOME}/lib/derbyclient.jar AuthExampleClientSQLAuth2</span></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D7B4"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleClientSQLAuth1.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleClientSQLAuth1 {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.ClientDriver";
        String dbName="sqlAuthClientDB";
        String dbOwner="mary";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName +
            ";user=" + dbOwner + ";create=true";
        Connection conn = null;

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derbyclient.jar " +
                "(${DERBY_HOME}/lib/derbyclient.jar).\n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Create and boot the database as user mary (who then becomes
        // the database owner), set up users and then shut down the
        // database
        try {
            System.out.println("Trying to connect to " + connectionURL);
            conn = DriverManager.getConnection(connectionURL);
            System.out.println("Connected to database " + connectionURL);

            turnOnBuiltInUsers(conn);
            
            // Close connection
            conn.close();
            System.out.println("Closed connection");

            /* Shut down the database to make static properties take
             * effect. Because the default connection mode is now 
             * noAccess, you must specify a user that has access. But
             * because requireAuthentication and sqlAuthorization do not
             * take effect until you restart the database, you do not
             * need to specify a password.
             *
             * Database shutdown throws the 08006 exception to confirm
             * success.
             */
            try {
                DriverManager.getConnection(
                    "jdbc:derby://localhost:1527/" + dbName + 
                    ";user=mary;shutdown=true");
            } catch (SQLException se)  {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (Throwable e) {
            errorPrintAndExit(e);
        }
    }

    /**
     * Turn on built-in user authentication and SQL authorization.
     *
     * Default connection mode is fullAccess, but SQL authorization
     * restricts access to the owners of database objects.
     *
     * @param conn a connection to the database
     */
    public static void turnOnBuiltInUsers(Connection conn) 
            throws SQLException {

        String setProperty = 
            "CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(";
        String getProperty = 
            "VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(";
        String requireAuth = "'derby.connection.requireAuthentication'";
        String sqlAuthorization = "'derby.database.sqlAuthorization'";
        String defaultConnMode =
            "'derby.database.defaultConnectionMode'";
        String fullAccessUsers = "'derby.database.fullAccessUsers'";
        String readOnlyAccessUsers =
            "'derby.database.readOnlyAccessUsers'";
        String provider = "'derby.authentication.provider'";
        String propertiesOnly = "'derby.database.propertiesOnly'";

        System.out.println(
            "Turning on authentication and SQL authorization.");
        Statement s = conn.createStatement();

        // Set requireAuthentication
        s.executeUpdate(setProperty + requireAuth + ", 'true')");
        // Set sqlAuthorization
        s.executeUpdate(setProperty + sqlAuthorization + ", 'true')");

        // Retrieve and display property values
        ResultSet rs = s.executeQuery(getProperty + requireAuth + ")");
        rs.next();
        System.out.println(
            "Value of requireAuthentication is " + rs.getString(1));

        rs = s.executeQuery(getProperty + sqlAuthorization + ")");
        rs.next();
        System.out.println(
            "Value of sqlAuthorization is " + rs.getString(1));

        // Set authentication scheme to Derby builtin
        s.executeUpdate(setProperty + provider + ", 'BUILTIN')");

        // Create some sample users
        s.executeUpdate(
            setProperty + "'derby.user.sa', 'ajaxj3x9')");
        s.executeUpdate(
            setProperty + "'derby.user.guest', 'java5w6x')");
        s.executeUpdate(
            setProperty + "'derby.user.mary', 'little7xylamb')");
        s.executeUpdate(
            setProperty + "'derby.user.sqlsam', 'light8q9bulb')");

        // Define noAccess as default connection mode
        s.executeUpdate(
            setProperty + defaultConnMode + ", 'noAccess')");

        // Confirm default connection mode
        rs = s.executeQuery(getProperty + defaultConnMode + ")");
        rs.next();
        System.out.println("Value of defaultConnectionMode is " +
            rs.getString(1));

        // Define read-write users
        s.executeUpdate(
            setProperty + fullAccessUsers + ", 'sqlsam,mary')");

        // Define read-only user
        s.executeUpdate(
            setProperty + readOnlyAccessUsers + ", 'guest')");
        
        // Therefore, user sa has no access

        // Confirm full-access users
        rs = s.executeQuery(getProperty + fullAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of fullAccessUsers is " + rs.getString(1));

        // Confirm read-only users
        rs = s.executeQuery(getProperty + readOnlyAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of readOnlyAccessUsers is " + rs.getString(1));

        // We would set the following property to TRUE only when we were
        // ready to deploy. Setting it to FALSE means that we can always
        // override using system properties if we accidentally paint
        // ourselves into a corner.
        s.executeUpdate("CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(" +
            "'derby.database.propertiesOnly', 'false')");
        s.close();
    }
 
    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException) 
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }   
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage()); 
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D7C8"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleClientSQLAuth2.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleClientSQLAuth2 {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.ClientDriver";
        String dbName="sqlAuthClientDB";
        String dbOwner="mary";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName;
        Connection conn = null;

        // Restart database and confirm that unauthorized users cannot 
        //  access it

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derbyclient.jar " +
                "(${DERBY_HOME}/lib/derbyclient.jar). \n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Try to log in with no username or password
        try {
            // connection attempt should fail
            System.out.println("Trying to connect to " + connectionURL +
                " without username or password");
            conn = DriverManager.getConnection(connectionURL);
            System.out.println(
                "ERROR: Unexpectedly connected to database " + dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Try to log in as a valid user with noAccess
        try {
            // connection attempt should fail
            String newURL = connectionURL + ";user=sa;password=ajaxj3x9";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println(
                "ERROR: Unexpectedly allowed to connect to database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with read-only access
        try {
            // connection should succeed, but create table should fail
            String newURL = connectionURL + 
                ";user=guest;password=java5w6x";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName +
                " with read-only access");

            Statement s = conn.createStatement();
            s.executeUpdate(
                "CREATE TABLE accessibletbl(textcol VARCHAR(6))");
            System.out.println(
                "ERROR: Unexpectedly allowed to modify database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("25503")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with full access
        // Create, update, and query table
        // Grant select and insert privileges to another user
        try {
            // this should succeed
            String newURL = connectionURL +
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();

            s.executeUpdate(
                "CREATE TABLE accessibletbl(textcol VARCHAR(6))");
            System.out.println("Created table accessibletbl");
            s.executeUpdate("INSERT INTO accessibletbl VALUES('hello')");

            ResultSet rs = s.executeQuery("SELECT * FROM accessibletbl");
            rs.next();
            System.out.println("Value of accessibletbl/textcol is " + 
                rs.getString(1));

            // grant insert privileges on table to user sqlsam
            s.executeUpdate(
                "GRANT SELECT, INSERT ON accessibletbl TO sqlsam");
            System.out.println(
                "Granted select/insert privileges to sqlsam");

            s.close();
            conn.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        // Log in as user with select and insert privileges on the table,
        //  but not delete privileges
        try {
            String newURL = 
                connectionURL + ";user=sqlsam;password=light8q9bulb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            // look at table
            Statement s = conn.createStatement();
            ResultSet rs = 
                s.executeQuery("SELECT * FROM mary.accessibletbl");
            rs.next();
            System.out.println("Value of accessibletbl/textcol is " + 
                rs.getString(1));

            s.executeUpdate(
                "INSERT INTO mary.accessibletbl VALUES('sam')");
            System.out.println("Inserted string into table");
            
            rs = s.executeQuery("SELECT * FROM mary.accessibletbl");
            while (rs.next()) {
               System.out.println("Value of accessibletbl/textcol is " + 
                   rs.getString(1));
            }
            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        try {
            Statement s = conn.createStatement();

            // this should fail
            s.executeUpdate("DELETE FROM mary.accessibletbl " +
                "WHERE textcol = 'hello'");
            System.out.println("ERROR: Unexpectedly allowed to DELETE " +
                "table mary.accessibletbl");
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("42500")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        /* Log in again as mary, delete table
         */
        try {
            String newURL = connectionURL + 
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();
            s.executeUpdate("DROP TABLE accessibletbl");
            System.out.println("Removed table accessibletbl");
            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
        
        try {
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /** Close connection and shut down database.
     *
     * @param conn a connection to the database
     */
    public static void cleanUpAndShutDown (Connection conn)
            throws SQLException {

        String dbName="sqlAuthClientDB";
        String dbOwner="mary";
        String connectionURL = "jdbc:derby://localhost:1527/" + dbName;

        try {
            conn.close();
            System.out.println("Closed connection");

            // As mary, the database owner, shut down the database.
            try {
                String newURL = connectionURL + ";user=" + dbOwner +
                    ";password=little7xylamb;shutdown=true";
                DriverManager.getConnection(newURL);
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException)
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage());
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div></div></div><div><a name="N1D7F9"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecuresqlauthembeddedex"></a><div></div>User authentication and SQL authorization embedded example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This example, <span style="font-family: Courier;">AuthExampleEmbeddedSQLAuth.java</span>,
shows how to use SQL authorization, in addition to 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in user authentication and user authorization, with the embedded
driver.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D817"></a><span></span><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">&gt;
        Important: </span>  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
built-in authentication mechanism is suitable only for development and testing
purposes. It is strongly recommended that production systems rely on LDAP or a
user-defined class for authentication. It is also strongly recommended that
production systems protect network connections with SSL/TLS.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This example is a single long program. A similar example that uses the client
driver, in
<span style="color: blue;"><a href="#rdevcsecuresqlauthclientex">User authentication and SQL authorization client example</a></span>,
uses one program to set properties and a second program to perform database
operations. Either example would work equally well in the other format.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See <span style="color: blue;"><a href="#cdevcsecure36595">User authorizations</a></span> for more
information on using SQL authorization, which allows you to use ANSI SQL
Standard GRANT and REVOKE statements. Compare this example to the one in
<span style="color: blue;"><a href="#rdevcsecure26537">User authentication and authorization embedded example</a></span>, which does not use
SQL authorization.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The program does the following:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and creates
a database named <span style="font-family: Courier;">sqlAuthEmbDB</span>, using the embedded driver. The
connection URL creates the database as the user <span style="font-family: Courier;">mary</span>, who is
therefore the database owner. After SQL authorization is enabled, only the
database owner will have the right to set and read database properties.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Sets database properties that create users with different levels of access
(no access, read-only access, and full access), that require authentication, and
that turn on SQL authorization. The users <span style="font-family: Courier;">mary</span> and
<span style="font-family: Courier;">sqlsam</span> have full access.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>3. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection, then stops and restarts the database so that the
authentication and SQL authorization changes can take effect.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>4. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database without a username and password, raising
an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>5. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Tries to connect to the database as a user with no access, raising an
exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>6. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as a user with read-only access; the connection
succeeds, but an attempt to create a table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>7. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as <span style="font-family: Courier;">mary</span>, who has full access; this
user creates and populates a table. This user also grants select and insert
privileges on this table to another user.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>8. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database as <span style="font-family: Courier;">sqlsam</span>, the user who has been
granted select and insert privileges by <span style="font-family: Courier;">mary</span>. This user has
full (that is, read-write) access on the connection level, but has limited
powers for this table because SQL authorization is active. The user successfully
performs select and insert operations on the table, but an attempt to delete a
row from the table raises an exception.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>9. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Connects to the database again as <span style="font-family: Courier;">mary</span>, who then deletes
the table.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>10. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>Closes the connection, shuts down the database, then shuts down
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Make sure that the <span style="font-family: Courier;">javac</span> command is in your path, then
compile the program as follows:
</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">javac AuthExampleEmbeddedSQLAuth.java</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you run <span style="font-family: Courier;">AuthExampleEmbeddedSQLAuth</span>, make
sure that <span style="font-family: Courier;">%DERBY_HOME%\lib\derby.jar</span> (or
<span style="font-family: Courier;">$DERBY_HOME/lib/derby.jar</span>) is in your classpath. For example,
you might use the following command on a Windows system:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-family: Courier;">java -cp .;%DERBY_HOME%\lib\derby.jar AuthExampleEmbeddedSQLAuth</span></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1D8F3"></a><span></span><div style="font-weight: bold;">Source code for <span style="font-family: Courier;">AuthExampleEmbeddedSQLAuth.java</span></div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;

public class AuthExampleEmbeddedSQLAuth {

    public static void main(String[] args) {

        String driver = "org.apache.derby.jdbc.EmbeddedDriver";
        String dbName="sqlAuthEmbDB";
        String dbOwner="mary";
        String connectionURL = "jdbc:derby:" + dbName + 
            ";user=" + dbOwner + ";create=true";
        Connection conn = null;

        // Load the driver. This code is not needed if you are using 
        // JDK 6, because in that environment the driver is loaded 
        // automatically when the application requests a connection.
        try {
            Class.forName(driver);
            System.out.println(driver + " loaded.");
        } catch (java.lang.ClassNotFoundException ce) {
            System.err.print("ClassNotFoundException: ");
            System.err.println(ce.getMessage());
            System.out.println("\n Make sure your CLASSPATH variable " +
                "contains %DERBY_HOME%\\lib\\derby.jar " +
                "(${DERBY_HOME}/lib/derby.jar).\n");
        } catch (Exception ee) {
            errorPrintAndExit(ee);
        }

        // Create and boot the database as user mary (who then becomes
        // the database owner), set up users and then shut down the
        // database
        try {
            System.out.println("Trying to connect to " + connectionURL);
            conn = DriverManager.getConnection(connectionURL);
            System.out.println("Connected to database " + connectionURL);

            turnOnBuiltInUsers(conn);

            // Close connection
            conn.close();
            System.out.println("Closed connection");

            /* Shut down the database to make static properties take
             * effect. Because the default connection mode is now 
             * noAccess, you must specify a user that has access. But
             * because requireAuthentication and sqlAuthorization do not
             * take effect until you restart the database, you do not
             * need to specify a password.
             *
             * Database shutdown throws the 08006 exception to confirm
             * success.
             */
            try {
                DriverManager.getConnection("jdbc:derby:" + dbName +
                    ";user=mary;shutdown=true");
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        // Restart database and confirm that unauthorized users cannot
        //  access it
        connectionURL = "jdbc:derby:" + dbName;

        // Try to log in with no username or password
        try {
            // connection attempt should fail
            System.out.println("Trying to connect to " + connectionURL +
                " without username or password");
            conn = DriverManager.getConnection(connectionURL);
            System.out.println(
                "ERROR: Unexpectedly connected to database " + dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Try to log in as a valid user with noAccess
        try {
            // connection attempt should fail
            String newURL = connectionURL + ";user=sa;password=ajaxj3x9";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println(
                "ERROR: Unexpectedly allowed to connect to database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("08004")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with read-only access
        try {
            // connection should succeed, but create table should fail
            String newURL = connectionURL + 
                ";user=guest;password=java5w6x";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName +
                " with read-only access");

            Statement s = conn.createStatement();
            s.executeUpdate(
                "CREATE TABLE accessibletbl(textcol VARCHAR(6))");
            System.out.println(
                "ERROR: Unexpectedly allowed to modify database " +
                     dbName);
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("25503")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        // Log in as a user with full access
        // Create, update, and query table
        // Grant select and insert privileges to another user
        try {
            // this should succeed
            String newURL = connectionURL +
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();

            s.executeUpdate(
                "CREATE TABLE accessibletbl(textcol VARCHAR(6))");
            System.out.println("Created table accessibletbl");
            s.executeUpdate("INSERT INTO accessibletbl VALUES('hello')");

            ResultSet rs = s.executeQuery("SELECT * FROM accessibletbl");
            rs.next();
            System.out.println("Value of accessibletbl/textcol is " + 
                rs.getString(1));

            // grant insert privileges on table to user sqlsam
            s.executeUpdate(
                "GRANT SELECT, INSERT ON accessibletbl TO sqlsam");
            System.out.println(
                "Granted select/insert privileges to sqlsam");

            s.close();
            conn.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        // Log in as user with select and insert privileges on the table,
        //  but not delete privileges
        try {
            String newURL = 
                connectionURL + ";user=sqlsam;password=light8q9bulb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            // look at table
            Statement s = conn.createStatement();
            ResultSet rs = 
                s.executeQuery("SELECT * FROM mary.accessibletbl");
            rs.next();
            System.out.println("Value of accessibletbl/textcol is " + 
                rs.getString(1));

            s.executeUpdate(
                "INSERT INTO mary.accessibletbl VALUES('sam')");
            System.out.println("Inserted string into table");
            
            rs = s.executeQuery("SELECT * FROM mary.accessibletbl");
            while (rs.next()) {
               System.out.println("Value of accessibletbl/textcol is " + 
                   rs.getString(1));
            }
            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }

        try {
            Statement s = conn.createStatement();

            // this should fail
            s.executeUpdate("DELETE FROM mary.accessibletbl " +
                "WHERE textcol = 'hello'");
            System.out.println("ERROR: Unexpectedly allowed to DELETE " +
                "table mary.accessibletbl");
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            if (e.getSQLState().equals("42500")) {
                System.out.println("Correct behavior: SQLException: " +
                    e.getMessage());
                try {
                    conn.close();
                } catch (SQLException ee) {
                    errorPrintAndExit(ee);
                }
            } else {
                errorPrintAndExit(e);
            }
        }

        /* Log in again as mary, delete table
         */
        try {
            String newURL = connectionURL + 
                ";user=mary;password=little7xylamb";
            System.out.println("Trying to connect to " + newURL);
            conn = DriverManager.getConnection(newURL);
            System.out.println("Connected to database " + dbName);

            Statement s = conn.createStatement();
            s.executeUpdate("DROP TABLE accessibletbl");
            System.out.println("Removed table accessibletbl");
            s.close();
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
        
        try {
            cleanUpAndShutDown(conn);
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }
    
    /**
     * Close connection and shut down database. Since this is embedded
     * mode, we must also shut down the Derby system.
     *
     * @param conn a connection to the database
     */
    public static void cleanUpAndShutDown (Connection conn)
            throws SQLException {

        String dbName="sqlAuthEmbDB";
        String dbOwner="mary";
        String connectionURL = "jdbc:derby:" + dbName;

        try {
            conn.close();
            System.out.println("Closed connection");

            // As mary, the database owner, shut down the database.
            try {
                String newURL = connectionURL + ";user=" + dbOwner +
                    ";password=little7xylamb;shutdown=true";
                DriverManager.getConnection(newURL);
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("08006") ) {
                    throw se;
                }
            }
            System.out.println("Database shut down normally");

            try {
                DriverManager.getConnection("jdbc:derby:;shutdown=true");
            } catch (SQLException se) {
                if ( !se.getSQLState().equals("XJ015") ) {
                    throw se;
                }
            }

            System.out.println("Derby system shut down normally");
        } catch (SQLException e) {
            errorPrintAndExit(e);
        }
    }

    /**
     * Turn on built-in user authentication and SQL authorization.
     *
     * Default connection mode is fullAccess, but SQL authorization
     * restricts access to the owners of database objects.
     * 
     * @param conn a connection to the database
     */
    public static void turnOnBuiltInUsers(Connection conn) 
            throws SQLException {

        String setProperty = 
            "CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(";
        String getProperty = 
            "VALUES SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(";
        String requireAuth = "'derby.connection.requireAuthentication'";
        String sqlAuthorization = "'derby.database.sqlAuthorization'";
        String defaultConnMode =
            "'derby.database.defaultConnectionMode'";
        String fullAccessUsers = "'derby.database.fullAccessUsers'";
        String readOnlyAccessUsers =
            "'derby.database.readOnlyAccessUsers'";
        String provider = "'derby.authentication.provider'";
        String propertiesOnly = "'derby.database.propertiesOnly'";

        System.out.println(
            "Turning on authentication and SQL authorization.");
        Statement s = conn.createStatement();

        // Set requireAuthentication
        s.executeUpdate(setProperty + requireAuth + ", 'true')");
        // Set sqlAuthorization
        s.executeUpdate(setProperty + sqlAuthorization + ", 'true')");

        // Retrieve and display property values
        ResultSet rs = s.executeQuery(getProperty + requireAuth + ")");
        rs.next();
        System.out.println(
            "Value of requireAuthentication is " + rs.getString(1));

        rs = s.executeQuery(getProperty + sqlAuthorization + ")");
        rs.next();
        System.out.println(
            "Value of sqlAuthorization is " + rs.getString(1));

        // Set authentication scheme to Derby builtin
        s.executeUpdate(setProperty + provider + ", 'BUILTIN')");

        // Create some sample users
        s.executeUpdate(
            setProperty + "'derby.user.sa', 'ajaxj3x9')");
        s.executeUpdate(
            setProperty + "'derby.user.guest', 'java5w6x')");
        s.executeUpdate(
            setProperty + "'derby.user.mary', 'little7xylamb')");
        s.executeUpdate(
            setProperty + "'derby.user.sqlsam', 'light8q9bulb')");

        // Define noAccess as default connection mode
        s.executeUpdate(
            setProperty + defaultConnMode + ", 'noAccess')");

        // Confirm default connection mode
        rs = s.executeQuery(getProperty + defaultConnMode + ")");
        rs.next();
        System.out.println("Value of defaultConnectionMode is " +
            rs.getString(1));

        // Define read-write users
        s.executeUpdate(
            setProperty + fullAccessUsers + ", 'sqlsam,mary')");

        // Define read-only user
        s.executeUpdate(
            setProperty + readOnlyAccessUsers + ", 'guest')");
        
        // Therefore, user sa has no access

        // Confirm full-access users
        rs = s.executeQuery(getProperty + fullAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of fullAccessUsers is " + rs.getString(1));

        // Confirm read-only users
        rs = s.executeQuery(getProperty + readOnlyAccessUsers + ")");
        rs.next();
        System.out.println(
            "Value of readOnlyAccessUsers is " + rs.getString(1));

        // We would set the following property to TRUE only when we were
        // ready to deploy. Setting it to FALSE means that we can always
        // override using system properties if we accidentally paint
        // ourselves into a corner.
        s.executeUpdate(setProperty + propertiesOnly + ", 'false')");
        s.close();
    }

    /** 
     * Report exceptions, with special handling of SQLExceptions,
     * and exit.
     *
     * @param e an exception (Throwable)
     */
    static void errorPrintAndExit(Throwable e) {
        if (e instanceof SQLException)
            SQLExceptionPrint((SQLException)e);
        else {
            System.out.println("A non-SQL error occurred.");
            e.printStackTrace();
        }
        System.exit(1);
    }

    /**
     * Iterate through a stack of SQLExceptions.
     *
     * @param sqle a SQLException
     */
    static void SQLExceptionPrint(SQLException sqle) {
        while (sqle != null) {
            System.out.println("\n---SQLException Caught---\n");
            System.out.println("SQLState:   " + (sqle).getSQLState());
            System.out.println("Severity: " + (sqle).getErrorCode());
            System.out.println("Message:  " + (sqle).getMessage());
            sqle = sqle.getNextException();
        }
    }
}</div></pre></div></div></div></div></div><div><a name="N1D924"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcbabejdfj"></a><div></div>Running Derby under a security manager</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When running within an application or application server with a Java 2
Security Manager enabled, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> must be granted certain permissions
to execute and access database files.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about permissions and examples of creating permission
objects and granting permissions, see the Security Architecture specification
at <span><span style="font-style: italic;">http://java.sun.com/j2se/1.4.2/docs/guide/security/PolicyFiles.html</span></span>.</div></div><div><a name="N1DA26"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevbabejgjd"></a><div></div>Granting permissions to Derby</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section discusses which permissions should be granted to <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> (the code base
<span style="font-family: Courier;">derby.jar</span>).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">See Default Policy Implementation and Policy File Syntax at <span style="color: blue;"><a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/PolicyFiles.html">http://java.sun.com/j2se/1.4.2/docs/guide/security/PolicyFiles.html</a></span> for
more information about creating policy files.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DA64"></a><span></span><div style="font-weight: bold;">Mandatory permissions</div><div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.lang.RuntimePermission createClassLoader</span></div><div style="margin-left: 72pt + 16pt;">Mandatory. It allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
execute SQL queries and supports loading class files from jar files stored
in the database.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.util.PropertyPermission "derby.*", "read"</span></div><div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to read
individual <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> properties
set in the JVM machine's system set. If the action is denied, properties in the JVM machine's
system set are ignored.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.util.PropertyPermission "derby.storage.jvmInstanceId",
"write"</span></div><div style="margin-left: 72pt + 16pt;">This property is used by Derby to prevent the accidental boot of the database
by two class loaders. If the database is booted by two class loaders, database
corruption can occur. 
If write permission for this property is not granted, a message is printed
to the log file which indicates that the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is not protected from dual boot and possible corruption.</div></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DAB3"></a><span></span><div style="font-weight: bold;">Database access permissions</div><div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.io.FilePermission "directory${/}/-", "read,write,delete"</span></div><div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to manage
files within the database that maps to the directory specified. For read-only
databases, only the "read" action needs to be granted.</div></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DAD4"></a><span></span><div style="font-weight: bold;">Optional permissions</div><div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}", "read,write"</span></div><div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to determine
the system directory when set by <span style="font-style: italic;">derby.system.home </span>and create it if
needed. If the system directory already exists then only the "read" permission
needs to be granted.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.util.PropertyPermission "user.dir", "read"</span></div><div style="margin-left: 72pt + 16pt;">Permits access to the system directory value if <span style="font-style: italic;">derby.system.home</span> is
not set or no permission has been granted to read the <span style="font-style: italic;">derby.system.home</span> property.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.util.PropertyPermission "sun.arch.data.model", "read"</span></div><div style="margin-left: 72pt + 16pt;">If set by the JVM, this is the definite answer to whether the system is 32 or 64 bit.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.util.PropertyPermission "os.arch", "read"</span></div><div style="margin-left: 72pt + 16pt;">Used by <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to determine if the
system is 32 or 64 bit, if the system property <span style="font-style: italic;">sun.arch.data.model</span> isn't set by
the JVM. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> has to recognize the value of
<span style="font-style: italic;">os.arch</span> to determine if the system is 32 or 64 bit, and if the value isn't recognized
a heuristic will be used instead.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}${/}derby.properties",
"read"</span></div><div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to read
the system properties file from the system directory.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.io.FilePermission "${derby.system.home}${/}derby.log",
"read,write,delete"</span></div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.io.FilePermission "${user.dir}${/}derby.log", "read,write,delete";</span></div><div style="margin-left: 72pt + 16pt;">Only one of these permissions is needed. Permits the application to read,
write, and delete to the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> log
file, unless the log has been re-directed. (See the <span style="font-style: italic;">derby.stream.error</span> properties
in the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span> for more
information.) If one of the requested valid actions is denied, the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> log
will be <span style="font-family: Courier;">java.lang.System.err</span>.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.security.SecurityPermission "getPolicy"</span></div><div style="margin-left: 72pt + 16pt;">You need this permission if you want to change the security policy on
the fly and reload it into a running system. Given this permission, a DBA
can reload the policy file by calling the <span style="font-family: Courier;">SYSCS_UTIL.SYSCS_RELOAD_SECURITY_POLICY</span> system
procedure. For more information, see the section which describes this procedure
in the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>. </div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.lang.RuntimePermission "setContextClassLoader"</span></div><div style="margin-left: 72pt + 16pt;">Allows <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to set the context class loader for long running threads to null to avoid potential for class loader leaks in application server environments when the application server starts <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> in a custom class loader. </div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission java.lang.RuntimePermission "getClassLoader"</span></div><div style="margin-left: 72pt + 16pt;"> This permission is also needed when setting the context class loader to avoid class loader leaks. The class loader for the parent is saved and set to null before creation of the thread and restored afterwards. </div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission javax.management.MBeanServerPermission "createMBeanServer";</span></div><div style="margin-left: 72pt + 16pt;">Allows Derby to create an MBean server. If the JVM running Derby supports
the platform MBean server, Derby will automatically try to create such a
server if it does not already exist. For details, visit the wiki page 
<span style="color: blue;"><a href="http://wiki.apache.org/db-derby/DerbyJMX">http://wiki.apache.org/db-derby/DerbyJMX</a></span>.
</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission javax.management.MBeanPermission "org.apache.derby.*#[org.apache.derby:*]","registerMBean,unregisterMBean";</span></div><div style="margin-left: 72pt + 16pt;">Allows Derby to register and unregister its (JMX) MBeans. Such MBeans are
associated with the domain <span style="font-family: Courier;">org.apache.derby</span>, which is also the prefix of
the fully qualified class name of all Derby MBeans. For more information about
Derby's MBeans, refer to the public API (Javadoc) documentation of the package
<span style="font-family: Courier;">org.apache.derby.mbeans</span> and its subpackages. It is possible to fine-tune
this permission, for example in order to allow access only to certain MBeans.
To fine-tune this permission, see the API documentation for
<span style="font-family: Courier;">javax.management.MBeanPermission</span>
or the JMX Instrumentation and Agent Specification.
</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">permission javax.management.MBeanTrustPermission "register";</span></div><div style="margin-left: 72pt + 16pt;">Trusts Derby code to be the source of MBeans and to register these in 
the MBean server.</div></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DC1D"></a><span></span><div style="font-weight: bold;">Combining permissions</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">You might grant one <span style="font-style: italic;">FilePermission</span> that
encompasses several or all of the permissions instead of separately granting
a number of the more specific permissions. For example:<pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">permission java.io.FilePermission "${derby.system.home}/-", "read,write,delete";</div></pre>
This allows the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> engine
complete access to the system directory and any databases contained in the
system directory.</div></div></div></div><div><a name="N1DC6D"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevcsecure871387"></a><div></div>Examples of Java 2 security policy files for embedded Derby</div><div style="margin-left: 72pt; font-size: 10pt;"></div><div><a name="N1DCE8"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure871406"></a><div></div>Java 2 security policy file example 1</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DCF5"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access all      */
/* databases under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home              */
/* when it is specified by the system property             */
/* <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home                                        */

/* Note <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home must be an absolute pathname */</span>

grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {

  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";
  permission.java.io.FilePermission "${derby.system.home}","read";
  permission java.io.FilePermission "${derby.system.home}${/}
     -", "read,write,delete";
  permission java.util.PropertyPermission "derby.storage.jvmInstanceId", 
     "write"; 
};</div></pre></div></div></div><div><a name="N1DD60"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure871422"></a><div></div>Java 2 security policy file example 2</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DD6D"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access all      */
/* databases under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home              */
/* when it defaults to the current directory               */</span>


grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {
  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";
  permission java.util.PropertyPermission "user.dir", "read";
  permission java.io.FilePermission "${derby.system.home}","read";
  permission java.io.FilePermission "${user.dir}${/}-",
      "read,write,delete";
  permission java.util.PropertyPermission "derby.storage.jvmInstanceId", 
      "write"; 

};</div></pre></div></div></div><div><a name="N1DDD0"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevcsecure871439"></a><div></div>Java 2 security policy file example 3</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DDDD"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">/* Grants permission to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> and access a single */
/* database (salesdb) under the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system home     */

/* Note <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>.system.home must be an absolute pathname */</span>

grant codeBase "file://f:/<span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>/lib/derby.jar" {

  permission java.lang.RuntimePermission "createClassLoader";
  permission java.util.PropertyPermission "derby.*", "read";
  permission java.io.FilePermission "${derby.system.home}","read";
  permission java.io.FilePermission "${derby.system.home}${/}*", 
      "read,write,delete";
  permission java.io.FilePermission "${derby.system.home}${/}
      salesdb${/}-", "read,write,delete";
  permission java.util.PropertyPermission "derby.storage.jvmInstanceId", 
      "write"; 


}; </div></pre></div></div></div></div></div></div><div><a name="N1DE46"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevadvjdbc35053"></a><div></div>Developing tools and using Derby with an IDE</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Applications such as database tools are designed to work with databases
whose schemas and contents are unknown in advance. This section discusses
a few topics useful for such applications.</div></div><div><a name="N1DE82"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevadvjdbc41138"></a><div></div>Offering connection choices to the user</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">JDBC's <span style="font-style: italic;">java.sql.Driver.getPropertyInfo</span> method allows a generic
GUI tool to determine the properties for which it should prompt a user in
order to get enough information to connect to a database. Depending on the
values the user has supplied so far, additional values might become necessary.
It might be necessary to iterate though several calls to <span style="font-style: italic;">getPropertyInfo</span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If no more properties are necessary, the call returns an array of zero
length.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, do
not use the method against an instance of <span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>.
Instead, request the JDBC driver from the driver manager:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">java.sql.DriverManager.getDriver(
    "jdbc:derby:").getPropertyInfo(<span style="font-style: italic;">URL</span>, <span style="font-style: italic;">Prop</span>)</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">In a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> system, the
properties returned in the <span style="font-style: italic;">DriverPropertyInfo</span> object are connection
URL attributes, including a list of booted databases in a system (the <span style="font-style: italic;">databaseName</span> attribute).</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Databases in a system are not automatically booted until you connect with
them. You can configure your system to retain the former behavior, in which
case the steps described in this section will continue to work. See "<span style="font-style: italic;">derby.system.bootAll</span>" in
the <span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="font-style: italic;">getPropertyInfo</span> requires a connection URL and a <span style="font-style: italic;">Properties</span> object
as parameters. Typically, what you pass are values that you will use in a
future call to <span style="font-style: italic;">java.sql.DriverManager.getConnection</span> when
you actually connect to the database.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A call to <span style="font-style: italic;">getPropertyInfo</span> with parameters that contain sufficient
information to connect successfully returns an array of zero length. (Receiving
this zero-length array does not <span style="font-style: italic;">guarantee</span> that the <span style="font-style: italic;">getConnection</span> call
will succeed, because something else could go wrong.)</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Repeat calls to <span style="font-style: italic;">getPropertyInfo</span> until it returns a zero-length array
or none of the properties remaining are desired.</div></div><div><a name="N1DFA0"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="rdevadvjdbc034"></a><div></div>The DriverPropertyInfo Array</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When a non-zero-length array is returned by <span style="font-style: italic;">getPropertyInfo</span>,
each element is a <span style="font-family: Courier;"><span style="font-style: italic;">DriverPropertyInfo</span></span> object representing
a connection URL attribute that has not already been specified. Only those
that make sense in the current context are returned.</div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DFCF"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This <span style="font-style: italic;">DriverPropertyInfo</span> object contains:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1DFDE"></a><span></span><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">name of the attribute</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">description</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">current value</span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If an attribute has a default value, this is
set in the value field of <span style="font-style: italic;">DriverPropertyInfo</span>, even if the attribute
has not been set in the connection URL or the <span style="font-family: Courier;"><span style="font-style: italic;">Properties</span></span> object.
If the attribute does not have a default value and it is not set in the URL
or the <span style="font-family: Courier;"><span style="font-style: italic;">Properties</span></span> object, its value will be null.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">list of choices</span></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="font-style: italic;">whether required for a connection request</span></div></td></tr></table></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E032"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Several fields in a <span style="font-style: italic;">DriverPropertyInfo</span> object are allowed
to be null.</div></div></div><div><a name="N1E070"></a><div style="font-size: 9pt; font-weight: bold; margin-left: 72pt;"><a name="rdevadvjdbc965"></a><div></div>DriverPropertyInfo array example</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E08F"></a><span></span><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Here is some example code:</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E098"></a><span></span><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">import java.sql.*;
import java.util.Properties;
<span style="font-weight: bold;">// start with the least amount of information
// to see the full list of choices
// we could also enter with a URL and Properties
// provided by a user.</span>
String url = "jdbc:derby:";
Properties info = new Properties();
Driver cDriver = DriverManager.getDriver(url);
for (;;)
        {
        DriverPropertyInfo[] attributes = cDriver.getPropertyInfo(
            url, info);
        <span style="font-weight: bold;"> // zero length means a connection attempt can be made</span>
        if (attributes.length == 0)
        break;
<span style="font-weight: bold;">        // insert code here to process the array, e.g.,
        // display all options in a GUI and allow the user to
        // pick and then set the attributes in info or URL.</span>
        }
<span style="font-weight: bold;">// try the connection</span>
Connection conn = DriverManager.getConnection(url, info);</div></pre></div></div></div></div></div><div><a name="N1E0D7"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevadvjdbc32436"></a><div></div>Using Derby with IDEs</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you use an integrated development environment (IDE) to develop
an embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application,
you might need to run <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> within
a server framework.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This is because an IDE might try connecting to the database from two different
JVMs, whereas only a single JVM instance should connect to a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
at one time (multiple connections from the same JVM are allowed). </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">An "embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> application"
is one which runs in the same JVM as the application. Such an application
uses the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> driver
(<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>) and connection URL (<span style="font-family: Courier;"><span style="font-style: italic;">jdbc:derby:databaseName</span></span>).
If you use this driver name or connection URL from the IDE, when the IDE tries
to open a second connection to the same database with the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>,
the attempt fails. Two JVMs cannot connect to the same database in embedded
mode.</div></div><div><a name="N1E1A8"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevadvjdbc18939"></a><div></div>IDEs and multiple JVMs</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">When you use an integrated development environment (IDE) to build
a Java application, you can launch the application from within the IDE at
any point in the development process. Typically, the IDE launches a JVM dedicated
to the application. When the application completes, the JVM exits. Any database
connections established by the application are closed.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">During the development of a database application, most IDEs allow you to
test individual database connections and queries without running the entire
application. When you test an individual database connection or query (which
requires a database connection), the IDE might launch a JVM that runs in a
specialized testing environment. In this case, when a test completes, the
JVM remains active and available for further testing, and the database connection
established during the test remains open.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Because of the behaviors of the IDE described above, if you use the embedded <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> JDBC driver, you may
encounter errors connecting in the following situations:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You test an individual query or database connection and then try to run
an application that uses the same database as the tested feature.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The
database connection established by testing the connection or query stays open,
and prevents the application from establishing a connection to the same database.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You run an application, and before it completes (for example, while it
waits for user input), you attempt to run a second application or to test
a connection or query that uses the same database as the first application.</div></td></tr></table></div></div></div></div></div><div><a name="N1E1FA"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevtricks32436"></a><div></div>SQL tips</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section provides some examples of interesting SQL features.
It also includes a few non-SQL tips.</div></div><div><a name="N1E261"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevtricks19707"></a><div></div>Retrieving the database connection URL</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not
have a built-in function that returns the name of the database. However, you
can use <span style="font-family: Courier;">DatabaseMetaData</span> to return the connection URL of
any local <span style="font-family: Courier;">Connection</span>.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">/* in java */</span>
String myURL = conn.getMetaData().getURL();
</div></pre></div></div><div><a name="N1E2F6"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevtricks39584"></a><div></div>Supplying a parameter only once</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">If you want to supply a parameter value once and use it multiple
times within a query, put it in the FROM clause with an appropriate CAST.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">SELECT  phonebook.* 
	FROM phonebook, (VALUES (CAST(? AS INT), CAST(? AS VARCHAR(255))))  
						AS Choice(choice, search_string)
	WHERE search_string = (case when choice = 1 then firstnme 
                 when choice=2 then lastname 
						when choice=3 then phonenumber end);</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This query selects what the second parameter will be compared to based
on the value in the first parameter. Putting the parameters in the FROM clause
means that they need to be applied only once to the query, and you can give
them names so that you can refer to them elsewhere in the query. In the example
above, the first parameter is given the name <span style="font-style: italic;">choice</span>, and the second
parameter is given the name <span style="font-style: italic;">search_string</span>.</div></div></div><div><a name="N1E38F"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevtricks21248"></a><div></div>Defining an identity column</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">An identity column is a column that stores numbers that increment
by one with each insertion. Identity columns are sometimes called autoincrement
columns.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides autoincrement
as a built-in feature; see CREATE TABLE statement in the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Below is an example that shows how to use an identity column to create
the MAP_ID column of the MAPS table in the <span style="font-style: italic;">toursDB database</span>.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">CREATE TABLE MAPS
(
MAP_ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
MAP_NAME VARCHAR(24) NOT NULL,
REGION VARCHAR(26),
AREA DECIMAL(8,4) NOT NULL,
PHOTO_FORMAT VARCHAR(26) NOT NULL,
PICTURE BLOB(102400),
UNIQUE (MAP_ID, MAP_NAME)
)</div></pre></div></div><div><a name="N1E443"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevtricks23426"></a><div></div>Using third-party tools</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You can hook into any JDBC tool with just our JDBC Driver class
name (<span style="font-style: italic;">org.apache.derby.jdbc.EmbeddedDriver</span>) and <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
JDBC connection URL.</div></div></div><div><a name="N1E4C2"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevtricks13019"></a><div></div>Tricks of the VALUES clause</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">This section contains some tips to use with the VALUES clause.</div></div><div><a name="N1E572"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevtricks807337"></a><div></div>Multiple rows</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
the complete SQL-92 VALUES clause; this is very handy in several cases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The first useful case is that it can be used to insert multiple rows:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">INSERT INTO OneColumnTable VALUES 1,2,3,4,5,6,7,8

INSERT INTO TwoColumnTable VALUES
    (1, 'first row'),
    (2, 'second row'),
    (3, 'third row')</span></div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Dynamic parameters reduce the number of times execute requests are sent
across:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;">ij&gt; -- send 5 rows at a time:
ij&gt; <span style="font-weight: bold;">PREPARE p1 AS 'INSERT INTO ThreeColumnTable VALUES 
(?,?,?), (?,?,?), (?,?,?), (?,?,?), (?,?,?)';</span>
ij&gt; <span style="font-weight: bold;">EXECUTE p1 USING 'VALUES (''1st'',1,1,''2nd'',2,2,''3rd'',
3,3,''4th'',4,4,''5th'',5,5)';</span></div></pre></div></div><div><a name="N1E5F6"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevtricks807365"></a><div></div>Mapping column values to return values</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">Multiple-row VALUES tables are useful in mapping column values
to desired return values in queries.</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">-- get the names of all departments in Ohio</span>SELECT DeptName
FROM Depts,
(VALUES (1, 'Shoe'),
    (2, 'Laces'),
    (4, 'Polish'))
AS DeptMap(DeptCode,DeptDesc)
WHERE Depts.DeptCode = DeptMap.DeptCode
AND Depts.DeptLocn LIKE '%Ohio%'</div></pre><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You might also find it useful to store values used often for mapping in
a persistent table and then using that table in the query.</div></div></div><div><a name="N1E664"></a><div style="padding-top: 1pc; margin-bottom: 2pt; font-size: 12pt; font-weight: bold;"><a name="cdevtricks807400"></a><div></div>Creating empty queries</div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">You may need <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to
create "empty" queries in existing applications for filling in bits of functionality
that <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not supply.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Empty queries of the right size and shape can be formed off a single values
table and a "WHERE FALSE" condition:</div><pre><div style="margin-top: 1.2em; margin-bottom: 0.8em; background-color: #f0f0f0; font-family: Courier; line-height: 106%; font-size: 9pt;"><span style="font-weight: bold;">SELECT *
FROM (VALUES ('',1,"TRUE")) AS ProcedureInfo(ProcedureName,NumParameters, 
ProcedureValid)
WHERE 1=0</span></div></pre></div></div></div></div><div><a name="N1E6DD"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevin10613"></a><div></div>Localizing Derby</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> offers
support for locales.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The word <span style="font-style: italic;">locale</span> in the Java platform refers to an instance of a
class that identifies a particular combination of language and region. If
a Java class varies its behavior according to <span style="font-style: italic;">locale</span>, it is said to
be locale-sensitive. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides
some support for locales for databases and other components such as the tools
and the installer.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">It also provides a feature to support databases in many different languages,
a feature which is independent of a particular territory.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">When you create or upgrade a database, you can use the territory attribute
to associate a non-default territory with the database. For information about
how to use the territory attribute, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Reference Manual</span></span></span>.</div></div><div><a name="N1E787"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevin71274"></a><div></div>SQL parser support for Unicode</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">To support users in many different languages, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
SQL parser understands all Unicode characters and allows any Unicode character
or number to be used in an identifier.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not attempt
to ensure that the characters in identifiers are valid in the database's locale.</div></div></div><div><a name="N1E7F1"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevcollation"></a><div></div>Character-based collation in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span></div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">A character set is a set of symbols and encodings. Character data
types are represented as Unicode 2.0 sequences in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>. </div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E824"></a><span></span><div style="font-weight: bold;">How collation works in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports a wide range
of character sets and encodes all of the character sets by using the Unicode
support provided by the java.lang.Character  class in the Java Virtual Machine
(JVM) in which the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
runs. See the Java API documentation for the java.lang.Character class for
the exact level of Unicode Standard that is supported.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">A collation is
a set of rules for comparing characters in a character set.  In <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> the
collation rules affect comparisons of the CHAR and VARCHAR data  types. Collation
rules also affect how the LIKE Boolean operator processes the CHAR, VARCHAR,
CLOB, and LONG VARCHAR data types.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The default <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> collation
rule is based on the binary Unicode values of the characters. So a character
is greater than (&lt;), equal to (=), or less than (&gt;) another character based
on the numeric comparison of the Unicode values. This rule allows for very
efficient comparisons of character strings.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  When LIKE comparisons
are used, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> compares
one character at a time for non-metacharacters. This is different than the
way <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> processes = comparisons.
The comparisons with the = operator compare the entire character string on
left side of the = operator with the entire character string on the right
side of the = operator. See the <span style="color: blue;"><a href="#cdevcollation">Differences between LIKE and equal (=) comparisons</a></span> section
below.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E871"></a><span></span><div style="font-weight: bold;">Territory-based collation</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> also
supports the ability to define collation rules that are appropriate to a territory,
and is referred to as <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;">territory-based collation</span></span>.  <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the territories
that Java supports.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">You can specifically set the territory of a database
when you create the database. If you do not specify a territory, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses
the default territory of the JVM in which the database is created. Each JVM
can support many territories that are independent from the default territory
for the JVM. Collation support for these additional territories is provided
through the <span style="font-family: Courier;">java.text.RuleBasedCollator</span> class and the set
of rules for these territories. Refer to the JVM specification for details
of how these rules are used to provide territory specific collation. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> currently
supports only running those rules that can be loaded dynamically from the
running JVM based on the territory attribute. Overrides to these rules by
the user are not supported. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The territory-based collation in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> affects
how the CHAR and VARCHAR data types are compared. Specifying territory-based
collation also impacts how the LIKE Boolean operator processes CHAR, VARCHAR,
CLOB, and LONG VARCHAR data. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Territory-based collation does add extra
processing overhead to all character-based comparison operations.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E8BB"></a><span></span><div style="font-weight: bold;">Database attributes that control collation</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">When
you create a <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database,
the attributes that you set determine the collation that is used with all
of character data in the database. For example: <div><div style="font-weight: bold;"><span style="color: red;">Table 13. </span>The create database
attributes that control collation</div><table style="margin-top: 12pt; margin-bottom: 10pt; background-color: white; border-style: solid; border-width: 1pt; border-color: black;" valign="top"><thead><tr><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>Example create commands</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; font-weight: bold; text-align: center; padding: 2pt; background-color: silver; margin-left: 2pt;" valign="top"><div>Collation is driven by</div></td></tr></thead><tbody><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>jdbc:derby:abcDB;create=true</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Unicode codepoint collation (UCS_BASIC), which is the
default collation for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> databases. </div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>jdbc:derby:abcDB;create=true;territory=es_MX</div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>Unicode codepoint collation (UCS_BASIC). The <span style="font-family: Courier;">collation</span> attribute
is not set.</div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>jdbc:derby:abcDB;create=true;collation=TERRITORY_BASED </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>The territory of the JVM, since the <span style="font-family: Courier;">territory</span> attribute
is not set. <div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Tip: </span>  To determine the territory of the JVM, run <span style="font-family: Courier;">Locale.getDefault()</span>.</div></div></td></tr><tr><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>jdbc:derby:abcDB;create=true;territory=es_MX;collation=TERRITORY_BASED </div></td><td style="border-style: solid; border-width: 1pt; border-color: black; padding: 2pt; background-color: #faf4fa; margin-left: 2pt;" valign="top"><div>The <span style="font-family: Courier;">territory</span> attribute.</div></td></tr></tbody></table></div></div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E964"></a><span></span><div style="font-weight: bold;">Collation examples</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">With Unicode codepoint collation
(UCS_BASIC), the numerical values of the Unicode encoding of the characters
are used directly for ordering. For example, the FRUIT table contains the NAME
column that uses the VARCHAR(20) data type. The contents of the NAME column
are:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>orange</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>apple</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Banana</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Pineapple</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Grape</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">UCS_BASIC collation sorts all lower case letters before upper
case letters. The statement <span style="font-family: Courier;">SELECT * FROM FRUIT ORDER BY NAME</span> returns: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>apple</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>orange</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Banana</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Grape</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Pineapple</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">If the database is created with the territory attribute set to
en_US (English language, United States country code), and the collation attribute
set to TERRITORY_BASED, the results of the statement <span style="font-family: Courier;">SELECT * FROM
FRUIT ORDER BY NAME</span> returns: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>apple</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Banana</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Grape</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>orange</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span> </span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Pineapple</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">The collation set for the database also impacts comparison operators
on character data types. For example, the statement <span style="font-family: Courier;">SELECT * FROM
FRUIT WHERE NAME &gt; 'Banana' ORDER BY NAME</span> returns: 
<pre><div style="font-size: 10pt; margin-top: 0.8em; margin-bottom: 0.8em;">      UCS_BASIC collation       Territory-based collation
                Grape                                Grape
                Pineapple                           orange
                                                          Pineapple</div></pre></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For information on creating case-insensitive databases, see
<span style="color: blue;"><a href="#tdevdvlpcollation">Creating a database with territory-based collation</a></span>.</div></div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1E9FD"></a><span></span><div style="font-weight: bold;">Differences between LIKE and equal (=)
comparisons</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">When you use territory-based collation, the comparisons
can return different results when you use the LIKE and equal
(=) operators. For example, suppose that the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> database
is set to use a territory where the character 'z' has same collation elements
as 'xy'. Consider the following two WHERE clauses: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div>1. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>WHERE 'zcb' = 'xycb'</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div>2. 
          </div></td><td width="8">&nbsp;</td><td valign="top"><div>WHERE 'zcb' LIKE 'xy_b'</div></td></tr></table></div></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For WHERE clause 1, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> returns
TRUE because the collation elements for the entire string 'zcb' will match
the collation elements of the entire string 'xycb'.  </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For WHERE clause
2, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> returns FALSE
because collation element for character 'z' does not match the collation element
for character 'x'. In addition, when metacharacter such as an underscore is
used with the LIKE operator, the metacharacter counts for one character in
the string value. A clause like WHERE 'xycb' LIKE '_cb' returns FALSE because
'x' is compared to the metacharacter _ and 'y' does not match 'c'.</div></div></div></div><div><a name="N1EA53"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevin55108"></a><div></div>Other components with locale support</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> also provides
locale support for the following components:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Database error messages are in the language of the locale, if support
is explicitly provided for that locale with a special library.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For example, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> explicitly supports Spanish-language
error messages. If a database's locale is set to one of the Spanish-language
locales, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> returns
error messages in the Spanish language.</div></div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools. In
the case of the tools, locale support includes locale-specific interface and
error messages and localized data display.   <div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For more information about
localization of the <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> tools,
see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Tools and Utilities Guide</span></span></span>. </div></div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Localized messages require special libraries.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The locale of the database is set by the <span style="font-style: italic;">territory=ll_CC</span> attribute
when the database is created. However, the locale of the error messages and
tools is not determined by the locale of the database. The locale of the error
messages and tools is determined by the default system locale. This means
that it is possible to create a database with a non-default locale. In such
a case, error messages are not returned in the language of the locale of the
database but are returned in the language of the default locale instead.</div><div><span style="font-weight: bold; border-right-width: 0pt; border-left-width: 0pt;">Note: </span>  You can override the default locale for ij with a property on the JVM.
For more information, see the <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;"><span style="font-style: italic;">Java DB Tools and Utilities Guide</span></span></span>.</div></div></div><div><a name="N1EB1C"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevin38113"></a><div></div>Messages libraries</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;">The following list describes the items required in order for <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> to provide localized
messages.</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>You must have the locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
file. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> provides such
jars for only some locales. You will find the locale jar files in the <span style="font-style: italic;">/lib</span>
directory in your <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> installation.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>The locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
file must be in the classpath.</div></td></tr></table></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The locale-specific <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> jar
file is named <span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ll_CC.jar</span>,
where<span style="font-style: italic;"> ll</span> is the two-letter code for language, and <span style="font-style: italic;">CC</span> is the
two-letter code for country. For example, the name of the jar file for error
messages for the German locale is <span style="font-family: Courier;"><span style="font-style: italic;"><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_de_DE.jar.</span></span></div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the following
locales: <div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_cs.jar -
Czech </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_de_DE.jar -
German </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_es.jar
- Spanish </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_fr.jar
- French </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_hu.jar
- Hungarian </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_it.jar
- Italian </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ja_JP.jar
- Japanese </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ko_KR.jar
- Korean </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_pl.jar
- Polish </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_pt_BR.jar
- Brazilian Portuguese </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_ru.jar
- Russian </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_zh_CN.jar
- Simplified Chinese </div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div><span style="border-right-width: 0pt; border-left-width: 0pt;">derby</span>Locale_zh_TW.jar
- Traditional Chinese</div></td></tr></table></div></div></div></div></div><div><a name="N1EC71"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="cdevstandards806118"></a><div></div>Derby and standards</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> adheres
to SQL99 or newer standards wherever possible. This section describes those
features currently in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that
are not standard; these features are currently being evaluated and might be
removed in future releases.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">This section describes those parts of <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> that
are non-standard or not typical for a database system.</div><div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">ALTER TABLE syntax</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses a
slightly different ALTER TABLE syntax for altering column defaults. While
SQL99 uses DROP and SET, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
uses DEFAULT.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Calling functions and procedures</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
the CALL (procedure) statement for calling external procedures declared by
the CREATE PROCEDURE statement. Built-in functions and user-defined functions
declared with the CREATE FUNCTION command can be called as part of an SQL
select statement or by using either a VALUES clause or VALUES expression.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">CLOB and BLOB data types</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports the
standard CLOB and BLOB data types. BLOB and CLOB values are limited to a
maximum of 2,147,483,647 characters.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Cursors</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses JDBC's result
sets, and does not provide SQL for manipulating cursors except for positioned
update and delete. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>'s
scrollable insensitive cursors are provided through JDBC, not through SQL
commands.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">DECIMAL max precision</span></div><div style="margin-left: 72pt + 16pt;">For <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>, the maximum
precision for DECIMAL columns is 31 digits. SQL99 does not require a specific
maximum precision for decimals, but most products have a maximum precision of
15-32 digits.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Dynamic SQL</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses JDBC's
Prepared Statement, and does not provide SQL commands for dynamic SQL.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Expressions on LONGs</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> permits
expressions on LONG VARCHAR; however, LONG VARCHAR data types are not allowed
in the following clauses, operations, constraints, functions, and predicates:
<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>GROUP BY clauses</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>ORDER BY clauses</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>JOIN operations</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>PRIMARY KEY constraints</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Foreign KEY constraints</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>UNIQUE key constraints</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>MIN aggregate function</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>MAX aggregate function</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>[NOT] IN predicate</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>UNION, INTERSECT, and EXCEPT operators</div></td></tr></table></div>
SQL99 also places some restrictions on expressions on LONG types.
</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Information schema</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> uses its own system
catalog that can be accessed using standard JDBC DatabaseMetadata calls.
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide the
standard Information Schema views.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">NOT NULL characteristic</span></div><div style="margin-left: 72pt + 16pt;">The SQL standard says NOT NULL is a constraint, and can be named and viewed
in the information schema as such.
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> does not provide naming
for NOT NULL, nor does it present it as a constraint in the information schema,
only as a characteristic of the column.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Stored routines and PSM</span></div><div style="margin-left: 72pt + 16pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports external
procedures using the Java programming language. Procedures are managed using the
CREATE PROCEDURE and DROP PROCEDURE statements.</div></div><div><div style="font-size: 10pt; font-weight: bold; text-indent: 0em; margin-right: 24pt;"><span style="font-weight: bold;">Transactions</span></div><div style="margin-left: 72pt + 16pt;">All operations in <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
are transactional. <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span>
supports transaction control using JDBC Connection methods. This includes
support for savepoints and for the four JDBC transaction isolation levels. The
only SQL command provided for transaction control is SET TRANSACTION ISOLATION.
</div></div></div></div><div><a name="N1EE07"></a><div style="padding-top: 1pc; margin-bottom: 5pt; font-size: 14pt; font-weight: bold;"><div style="border-right-width: 0pt; border-left-width: 0pt; border-top-width: 1pt; border-top-color: black;"><a name="cdevstandardsxml"></a><div></div>XML data types and operators</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em; margin-left: 72pt;"><span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> supports
the XML data type and a set of operators that work with the XML data type,
but does not provide JDBC support for the XML data type.
The XML data type and operators are based on a small subset of the SQL/XML
specification. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The XML data type and operators are defined only in the SQL layer.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0em; margin-bottom: 0.6em;">There is no JDBC-side support for XML data types. It is not possible to
bind directly into an XML value or to retrieve an XML value directly from
a result set.  Instead, you must bind and retrieve the XML data as Java strings
or character streams by explicitly specifying the appropriate XML operator
as part of the SQL statements:<div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use the XMLPARSE operator for binding data into XML values.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>Use the XMLSERIALIZE operator to retrieve XML values from a result set.</div></td></tr></table></div> Additionally, there is no JDBC metadata support for the XML data type.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The XML data type is not allowed in any of the clauses or operations that
are described in the section on expressions on LONG data types in 
<span style="color: blue;"><a href="#cdevstandards806118">Derby and standards</a></span>.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">For the XML operators to work properly, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> requires
that a JAXP parser, such as Apache Xerces, and Apache Xalan are included in
the Java classpath. If either the parser or Xalan are missing from the classpath, <span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> disallows any XML-related
operations.  </div><div style="line-height: 12pt; margin-top: 0.6em; font-size: 10pt;"><a name="N1EE7B"></a><span></span><div style="font-weight: bold;">Classpath and version issues</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Most Java Virtual Machines (JVMs) that are version 1.4 or later have
a JAXP parser embedded in the JVM. If you are using one of these JVMs, you
may not need to add any classes to your classpath. Some exceptions exist:</div><div><table width="100%"><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>In most version 1.4.2 JVMs, the version of Xalan that comes with the JVM is 
not new enough, so you must override the version of Xalan in the JVM with a
newer version by using the Endorsed Standards Override Mechanism described at
<span style="color: blue;"><a href="http://java.sun.com/j2se/1.4.2/docs/guide/standards/">http://java.sun.com/j2se/1.4.2/docs/guide/standards/</a></span>. To
use this mechanism, download and install a binary distribution of Xalan from
Apache and set the system property <span style="font-family: Courier;">java.endorsed.dirs</span> to point
to the Xalan installation directory.</div></td></tr><tr><td valign="top" style="text-align: right;" width="24"><div><span>&bull;</span></div></td><td width="8">&nbsp;</td><td valign="top"><div>After JVM version 1.4, Sun renamed the JAXP packages. 
<span style="border-right-width: 0pt; border-left-width: 0pt;">Derby</span> cannot find these
renamed packages. If you are using a Sun JVM later than version 1.4, download
and install a binary
distribution of Xalan from Apache and place the <span style="font-family: Courier;">xalan.jar</span> file
in your classpath. The <span style="font-family: Courier;">xalan.jar</span> file automatically puts into
the classpath the other required jars that are in the same directory.</div></td></tr></table></div></div></div></div></div><div><a name="N1EED5"></a><div style="margin-top: 0pc; margin-bottom: 1.4pc; font-size: 16pt; font-weight: bold; padding-top: 1.4pc;"><div style="border-right-width: 0pt; border-left-width: 0pt; line-height: 100%; border-top-width: 3pt; border-top-color: black;"><a name="rdevtrademderby"></a><div></div>Trademarks</div></div><div style="margin-left: 72pt; font-size: 10pt;"><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">The following terms are trademarks or registered trademarks of other companies
and have been used in at least one of the documents in the <span style="border-right-width: 0pt; border-left-width: 0pt;">Apache Derby</span> documentation
library:</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Cloudscape, DB2, DB2 Universal Database, DRDA, and IBM are trademarks of
International Business Machines Corporation in the United States, other countries,
or both.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Microsoft, Windows, Windows NT, and the Windows logo are trademarks of
Microsoft Corporation in the United States, other countries, or both. </div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Oracle and Java are registered trademarks of Oracle and/or its affiliates.
Other names may be trademarks of their respective owners.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">UNIX is a registered trademark of The Open Group in the United States and
other countries.</div><div style="font-size: 10pt; text-indent: 0em; margin-top: 0.6em; margin-bottom: 0.6em;">Other company, product, or service names may be trademarks or service marks
of others.</div></div></div></div></div><div valign="top"><div style="font-family: Helvetica; font-weight: bold; font-size: 10pt; text-align: center;"><span>&bull;</span></div></div><br></body></html>